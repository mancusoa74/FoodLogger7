!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,(function(t){"use strict";try{(function(){var e,n,r,i=function(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}(t),o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function u(t,e,n,r){return new(n=n||Promise)((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function c(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function h(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function f(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=d[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,h(["["+i+"]  "+t.name+":"],n))}}(r=n=n||{})[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT";var l={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},p=n.INFO,d=((e={})[n.DEBUG]="log",e[n.VERBOSE]="log",e[n.INFO]="info",e[n.WARN]="warn",e[n.ERROR]="error",e),v=(Object.defineProperty(y.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in n))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),y.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?l[t]:t},Object.defineProperty(y.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),y.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,n.DEBUG],t)),this._logHandler.apply(this,h([this,n.DEBUG],t))},y.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,n.VERBOSE],t)),this._logHandler.apply(this,h([this,n.VERBOSE],t))},y.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,n.INFO],t)),this._logHandler.apply(this,h([this,n.INFO],t))},y.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,n.WARN],t)),this._logHandler.apply(this,h([this,n.WARN],t))},y.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,n.ERROR],t)),this._logHandler.apply(this,h([this,n.ERROR],t))},y);function y(t){this.name=t,this._logLevel=p,this._logHandler=f,this._userLogHandler=null}function g(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var m,w=(s(b,m=Error),b);function b(t,e){var n=m.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,I.prototype.create),n}var I=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(T,(function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"}))):"Error",a=this.serviceName+": "+u+" ("+o+").",c=new w(o,a),h=0,f=Object.keys(i);h<f.length;h++){var l=f[h];"_"!==l.slice(-1)&&(l in c&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),c[l]=i[l])}return c},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var T=/\{\$([^}]+)}/g,_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D={},x=S||self;function O(){}function R(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function k(t){var e=R(t);return"array"==e||"object"==e&&"number"==typeof t.length}function L(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var C="closure_uid_"+(1e9*Math.random()>>>0),P=0;function U(t,e,n){return t.call.apply(t.bind,arguments)}function V(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function M(t,e,n){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?U:V).apply(null,arguments)}function F(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var q=Date.now;function j(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function G(){this.j=this.j,this.i=this.i}G.prototype.j=!1,G.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,C)&&t[C]||(t[C]=++P))},G.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function H(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var W,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:e<t?1:0}t:{var J=x.navigator;if(J){var Z=J.userAgent;if(Z){W=Z;break t}}W=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e,n={};for(e in t)n[e]=t[e];return n}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=O;var ot,st,ut=X(W,"Opera"),at=X(W,"Trident")||X(W,"MSIE"),ct=X(W,"Edge"),ht=ct||at,ft=X(W,"Gecko")&&!(X(W.toLowerCase(),"webkit")&&!X(W,"Edge"))&&!(X(W,"Trident")||X(W,"MSIE"))&&!X(W,"Edge"),lt=X(W.toLowerCase(),"webkit")&&!X(W,"Edge");function pt(){var t=x.document;return t?t.documentMode:void 0}t:{var dt="",vt=(st=W,ft?/rv:([^\);]+)(\)|;)/.exec(st):ct?/Edge\/([\d\.]+)/.exec(st):at?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):ut?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(vt&&(dt=vt?vt[1]:""),at){var yt=pt();if(null!=yt&&yt>parseFloat(dt)){ot=String(yt);break t}}ot=dt}var gt={};function mt(t){return e=t,n=function(){for(var e=0,n=Y(String(ot)).split("."),r=Y(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",u=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==s[0].length&&0==u[0].length)break;e=$(0==s[1].length?0:parseInt(s[1],10),0==u[1].length?0:parseInt(u[1],10))||$(0==s[2].length,0==u[2].length)||$(s[2],u[2]),s=s[3],u=u[3]}while(0==e)}return 0<=e},r=gt,Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=n();var e,n,r}var wt=x.document&&at&&(pt()||parseInt(ot,10))||void 0,bt=!at||9<=Number(wt),It=at&&!mt("9"),Et=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{x.addEventListener("test",O,e),x.removeEventListener("test",O,e)}catch(t){}return t}();function Tt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function _t(t,e){if(Tt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:At[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Tt.prototype.b=function(){this.defaultPrevented=!0},j(_t,Tt);var At={2:"touch",3:"pen",4:"mouse"};_t.prototype.b=function(){_t.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nt="closure_listenable_"+(1e6*Math.random()|0),St=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++St,this.Y=this.Z=!1}function xt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Ot(t){this.src=t,this.a={},this.b=0}function Rt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=B(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(xt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function kt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Ot.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=kt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Dt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Lt="closure_lm_"+(1e6*Math.random()|0),Ct={};function Pt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Bt(r),e&&e[Nt]?e.wa(n,r,L(i)?!!i.capture:!!i,o):Ut(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Pt(t,e[o],n,r,i);return null}return n=Bt(n),t&&t[Nt]?t.va(e,n,L(r)?!!r.capture:!!r,i):Ut(t,e,n,!1,r,i)}function Ut(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=L(i)?!!i.capture:!!i;if(s&&!bt)return null;var u,a,c=jt(t);if(c||(t[Lt]=c=new Ot(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=qt,r=a=bt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Et||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Mt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[Nt]?Rt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Mt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(Rt(n,t),0==n.b&&(n.src=null,e[Lt]=null)):xt(t)))}function Mt(t){return t in Ct?Ct[t]:Ct[t]="on"+t}function Ft(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Vt(t),n.call(r,e)}function qt(t,e){if(t.Y)return!0;if(bt)return Ft(t,new _t(e,this));if(!e)t:{e=["window","event"];for(var n=x,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ft(t,e=new _t(e,this))}function jt(t){return(t=t[Lt])instanceof Ot?t:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bt(t){return"function"==R(t)?t:(t[Gt]||(t[Gt]=function(e){return t.handleEvent(e)}),t[Gt])}function zt(){G.call(this),this.c=new Ot(this),(this.J=this).C=null}function Ht(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&Rt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}j(zt,G),zt.prototype[Nt]=!0,(N=zt.prototype).addEventListener=function(t,e,n,r){Pt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=L(i)?!!i.capture:!!i,r=Bt(r),e&&e[Nt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=kt(s=e.a[n],r,i,o))&&(xt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=kt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new Tt(t,n):t instanceof Tt?t.target=t.target||n:(s=t,rt(t=new Tt(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Ht(o,r,!0,t)&&s;if(s=Ht(o=t.a=n,r,!0,t)&&s,s=Ht(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Ht(o=t.a=e[i],r,!1,t)&&s;return s},N.G=function(){if(zt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)xt(n[r]);delete e.a[t],e.b--}}this.C=null},N.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Qt=x.JSON.stringify;function Kt(){this.b=this.a=null}var Wt,Yt=(Xt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Xt((function(){return new $t}),(function(t){t.reset()}),100));function Xt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function $t(){this.next=this.b=this.a=null}function Jt(t,e){var n;Wt||(n=x.Promise.resolve(void 0),Wt=function(){n.then(ee)}),Zt||(Wt(),Zt=!0),te.add(t,e)}Kt.prototype.add=function(t,e){var n=Yt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Zt=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),te=new Kt;function ee(){for(var t,e,n;n=e=void 0,n=null,(e=te).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){x.setTimeout((function(){throw t}),0)}(t)}var r=Yt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}Zt=!1}function ne(t,e){zt.call(this),this.b=t||1,this.a=e||x,this.f=M(this.Ya,this),this.g=q()}function re(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ie(t,e,n){if("function"==R(t))n&&(t=M(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=M(t.handleEvent,t)}return 2147483647<Number(e)?-1:x.setTimeout(t,e||0)}j(ne,zt),(N=ne.prototype).aa=!1,N.M=null,N.Ya=function(){var t;this.aa&&(0<(t=q()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(re(this),this.start())))},N.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},N.G=function(){ne.S.G.call(this),re(this),delete this.a};var oe,se,ue,ae=(_(se=he,ue=oe=G),se.prototype=null===ue?Object.create(ue):(ce.prototype=ue.prototype,new ce),he.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=ie((function(){e.a=null,e.c&&(e.c=!1,t(e))}),e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},he.prototype.G=function(){oe.prototype.G.call(this),this.a&&(x.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},he);function ce(){this.constructor=se}function he(t,e,n){var r=oe.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function fe(t){G.call(this),this.b=t,this.a={}}j(fe,G);var le=[];function pe(t,e,n,r){Array.isArray(n)||(n&&(le[0]=n.toString()),n=le);for(var i=0;i<n.length;i++){var o=Pt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function de(t){tt(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Vt(t)}),t),t.a={}}function ve(){this.a=!0}function ye(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Qt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}fe.prototype.G=function(){fe.S.G.call(this),de(this)},fe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ve.prototype.info=function(){};var ge=null;function me(){return ge=ge||new zt}function we(t){Tt.call(this,"serverreachability",t)}function be(t){var e=me();e.dispatchEvent(new we(e))}function Ie(t){Tt.call(this,"statevent",t)}function Ee(t){var e=me();e.dispatchEvent(new Ie(e))}function Te(t){Tt.call(this,"timingevent",t)}function _e(t,e){if("function"!=R(t))throw Error("Fn must not be null and must be a function");return x.setTimeout((function(){t()}),e)}j(we,Tt),j(Ie,Tt),j(Te,Tt);var Ae={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},Ne={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function Se(){}function De(t){var e;return(e=t.a)||(e=t.a={}),e}function xe(){}Se.prototype.a=null;var Oe,Re={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function ke(){Tt.call(this,"d")}function Le(){Tt.call(this,"c")}function Ce(){}function Pe(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new fe(this),this.P=Ue,t=ht?125:void 0,this.R=new ne(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}j(ke,Tt),j(Le,Tt),j(Ce,Se),Oe=new Ce;var Ue=45e3,Ve={},Me={};function Fe(t,e,n){t.H=1,t.i=un(tn(e)),t.j=n,t.I=!0,qe(t,null)}function qe(t,e){t.u=q(),Ge(t),t.l=tn(t.i);var n,r,i,o,s,u,a=t.l,c=t.T;Array.isArray(c)||(c=[String(c)]),bn(a.b,"t",c),t.D=0,t.a=pr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ae(M(t.Ca,t,t.a),t.O)),pe(t.J,t.a,"readystatechange",t.Wa),e=t.B?et(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),be(),n=t.c,r=t.m,i=t.l,o=t.f,s=t.T,u=t.j,n.info((function(){if(n.a)if(u)for(var t="",e=u.split("&"),a=0;a<e.length;a++){var c,h,f=e[a].split("=");1<f.length&&(c=f[0],f=f[1],t=2<=(h=c.split("_")).length&&"type"==h[1]?t+(c+"=")+f+"&":t+(c+"=redacted&"))}else t=null;else t=u;return"XMLHTTP REQ ("+o+") [attempt "+s+"]: "+r+"\n"+i+"\n"+t}))}function je(t,e,n){for(var r,i,o,s,u=!0;!t.A&&t.D<n.length;){var a=(i=n,s=o=void 0,o=(r=t).D,-1==(s=i.indexOf("\n",o))?Me:(o=Number(i.substring(o,s)),isNaN(o)?Ve:(s+=1)+o>i.length?Me:(i=i.substr(s,o),r.D=s+o,i)));if(a==Me){4==e&&(t.h=4,Ee(),u=!1),ye(t.c,t.f,null,"[Incomplete Response]");break}if(a==Ve){t.h=4,Ee(),ye(t.c,t.f,n,"[Invalid Chunk]"),u=!1;break}ye(t.c,t.f,a,null),Ke(t,a)}4==e&&0==n.length&&(t.h=1,Ee(),u=!1),t.b=t.b&&u,u?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),or(e),e.F=!0)):(ye(t.c,t.f,n,"[Invalid Chunked Response]"),Qe(t),He(t))}function Ge(t){t.U=q()+t.P,Be(t,t.P)}function Be(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=_e(M(t.Ua,t),e)}function ze(t){t.o&&(x.clearTimeout(t.o),t.o=null)}function He(t){0==t.g.v||t.A||ar(t.g,t)}function Qe(t){ze(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,re(t.R),de(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Ke(t,e){try{var n,r,i,o,s,u,a,c,h,f,l,p=t.g;if(0!=p.v&&(p.a==t||Sn(p.b,t)))if(p.I=t.N,!t.C&&Sn(p.b,t)&&3==p.v){try{var d=p.ka.a.parse(e)}catch(t){d=null}if(Array.isArray(d)&&3==d.length){var v=d;if(0==v[0]){t:if(!p.j){if(p.a){if(!(p.a.u+3e3<t.u))break t;ur(p),Xn(p)}ir(p),Ee()}}else p.oa=v[1],0<p.oa-p.P&&v[2]<37500&&p.H&&0==p.o&&!p.m&&(p.m=_e(M(p.Ra,p),6e3));if(Nn(p.b)<=1&&p.ea){try{p.ea()}catch(t){}p.ea=void 0}}else hr(p,11)}else if(!t.C&&p.a!=t||ur(p),!K(e))for(e=d=p.ka.a.parse(e),d=0;d<e.length;d++)v=e[d],p.P=v[0],v=v[1],2==p.v?"c"==v[0]?(p.J=v[1],p.ga=v[2],null!=(n=v[3])&&(p.ha=n,p.c.info("VER="+p.ha)),null!=(r=v[4])&&(p.pa=r,p.c.info("SVER="+p.pa)),null!=(i=v[5])&&"number"==typeof i&&0<i&&(o=1.5*i,p.D=o,p.c.info("backChannelRequestTimeoutMs_="+o)),o=p,(s=t.a)&&(!(u=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(a=o.b).a&&(X(u,"spdy")||X(u,"quic")||X(u,"h2"))&&(a.f=a.g,a.a=new Set,a.b&&(Dn(a,a.b),a.b=null)),!o.A||(c=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(o.na=c,sn(o.B,o.A,c))),p.v=3,p.f&&p.f.ta(),p.V&&(p.N=q()-t.u,p.c.info("Handshake RTT: "+p.N+"ms")),h=t,(o=p).la=lr(o,o.C?o.ga:null,o.fa),h.C?(xn(o.b,h),f=h,(l=o.D)&&f.setTimeout(l),f.o&&(ze(f),Ge(f)),o.a=h):rr(o),0<p.g.length&&Zn(p)):"stop"!=v[0]&&"close"!=v[0]||hr(p,7):3==p.v&&("stop"==v[0]||"close"==v[0]?"stop"==v[0]?hr(p,7):Yn(p):"noop"!=v[0]&&p.f&&p.f.sa(v),p.o=0);be()}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(k(t)||"string"==typeof t)z(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(k(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(k(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ye(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ye)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Xe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];$e(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)$e(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=Pe.prototype).setTimeout=function(t){this.P=t},N.Wa=function(t){t=t.target;var e=this.F;e&&3==Hn(t)?e.f():this.Ca(t)},N.Ca=function(t){try{if(t==this.a)t:{var e=Hn(this.a),n=this.a.ua();this.a.X();if(!(e<3||3==e&&!ht&&!this.a.$())){this.A||4!=e||7==n||be(),ze(this);var r=this.a.X();this.N=r;var i=this.a.$();if(this.b=200==r,a=this.c,c=this.m,h=this.l,f=this.f,l=this.T,p=e,d=r,a.info((function(){return"XMLHTTP RESP ("+f+") [ attempt "+l+"]: "+c+"\n"+h+"\n"+p+" "+d})),this.b){if(this.V&&!this.C){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.h=3,Ee(),Qe(this),He(this);break t}ye(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Ke(this,u)}this.I?(je(this,e,i),ht&&this.b&&3==e&&(pe(this.J,this.R,"tick",this.Va),this.R.start())):(ye(this.c,this.f,i,null),Ke(this,i)),4==e&&Qe(this),this.b&&!this.A&&(4==e?ar(this.g,this):(this.b=!1,Ge(this)))}else 400==r&&0<i.indexOf("Unknown SID")?(this.h=3,Ee()):(this.h=0,Ee()),Qe(this),He(this)}}}catch(t){}var a,c,h,f,l,p,d},N.Va=function(){var t,e;this.a&&(t=Hn(this.a),e=this.a.$(),this.D<e.length&&(ze(this),je(this,t,e),this.b&&4!=t&&Ge(this)))},N.cancel=function(){this.A=!0,Qe(this)},N.Ua=function(){this.o=null;var t,e,n=q();0<=n-this.U?(t=this.c,e=this.l,t.info((function(){return"TIMEOUT: "+e})),2!=this.H&&(be(),Ee()),Qe(this),this.h=2,He(this)):Be(this,this.U-n)},(N=Ye.prototype).K=function(){Xe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.L=function(){return Xe(this),this.a.concat()},N.get=function(t,e){return $e(this.b,t)?this.b[t]:e},N.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ze(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ze?(this.a=void 0!==e?e:t.a,en(this,t.f),this.j=t.j,nn(this,t.c),rn(this,t.h),this.g=t.g,e=t.b,(n=new yn).c=e.c,e.a&&(n.a=new Ye(e.a),n.b=e.b),on(this,n),this.i=t.i):t&&(n=String(t).match(Je))?(this.a=!!e,en(this,n[1]||"",!0),this.j=an(n[2]||""),nn(this,n[3]||"",!0),rn(this,n[4]),this.g=an(n[5]||"",!0),on(this,n[6]||"",!0),this.i=an(n[7]||"")):(this.a=!!e,this.b=new yn(null,this.a))}function tn(t){return new Ze(t)}function en(t,e,n){t.f=n?an(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function nn(t,e,n){t.c=n?an(e,!0):e}function rn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function on(t,e,n){var r,i;e instanceof yn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(gn(r),r.c=null,r.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(mn(this,e),bn(this,n,t))}),r)),r.f=i):(n||(e=cn(e,dn)),t.b=new yn(e,t.a))}function sn(t,e,n){t.b.set(e,n)}function un(t){return sn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function an(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function cn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,hn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function hn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push(cn(e,fn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(cn(e,fn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(cn(n,"/"==n.charAt(0)?pn:ln,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",cn(n,vn)),t.join("")};var fn=/[#\/\?@]/g,ln=/[#\?:]/g,pn=/[#\?]/g,dn=/[#\?@]/g,vn=/#/g;function yn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function gn(t){t.a||(t.a=new Ye,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function mn(t,e){gn(t),e=In(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Xe(t)))}function wn(t,e){return gn(t),e=In(t,e),$e(t.a.b,e)}function bn(t,e,n){mn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),Q(n)),t.b+=n.length)}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function En(t,e){this.b=t,this.a=e}function Tn(t){this.g=t||_n,t=x.PerformanceNavigationTiming?0<(t=x.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(x.ia&&x.ia.ya&&x.ia.ya()&&x.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=yn.prototype).add=function(t,e){gn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(t,e){gn(this),this.a.forEach((function(n,r){z(n,(function(n){t.call(e,n,r,this)}),this)}),this)},N.L=function(){gn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.K=function(t){gn(this);var e=[];if("string"==typeof t)wn(this,t)&&(e=H(e,this.a.get(In(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=H(e,t[n])}return e},N.set=function(t,e){return gn(this),this.c=null,wn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),o=(r=this.K(r),0);o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var _n=10;function An(t){return t.b||t.a&&t.a.size>=t.f}function Nn(t){return t.b?1:t.a?t.a.size:0}function Sn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Dn(t,e){t.a?t.a.add(e):t.b=e}function xn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function On(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return Q(t.c);var r=t.c;try{for(var i=A(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Rn(){}function kn(){this.a=new Rn}function Ln(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Tn.prototype.cancel=function(){var t,e;if(this.c=On(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=A(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Rn.prototype.stringify=function(t){return x.JSON.stringify(t,void 0)},Rn.prototype.parse=function(t){return x.JSON.parse(t,void 0)};var Cn=x.JSON.parse;function Pn(t){zt.call(this),this.headers=new Ye,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Un,this.D=this.F=!1}j(Pn,zt);var Un="",Vn=/^https?$/i,Mn=["POST","PUT"];function Fn(t){return"content-type"==t.toLowerCase()}function qn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,jn(t),Bn(t)}function jn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Gn(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=Hn(t)||2!=t.X()))if(t.l&&4==Hn(t))ie(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Hn(t)){t.b=!1;try{var e,n,r,i,o=t.X();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(Je)[1]||null)&&x.self&&x.self.location&&(i=(r=x.self.location.protocol).substr(0,r.length-1)),n=!Vn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Hn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",jn(t)}}finally{Bn(t)}}}function Bn(t,e){if(t.a){zn(t);var n=t.a,r=t.s[0]?O:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function zn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(x.clearTimeout(t.m),t.m=null)}function Hn(t){return t.a?t.a.readyState:0}function Qn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",tt(n,(function(t,e){i+=e,i+=":",i+=t,i+="\r\n"})),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):sn(t,e,n))}function Kn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Wn(t){this.pa=0,this.g=[],this.c=new ve,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Kn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Kn("baseRetryDelayMs",5e3,t),this.Ma=Kn("retryDelaySeedMs",1e4,t),this.Ja=Kn("forwardChannelMaxRetries",2,t),this.ma=Kn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new Tn(t&&t.concurrentRequestLimit),this.ka=new kn,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Yn(t){var e,n;$n(t),3==t.v&&(e=t.R++,sn(n=tn(t.B),"SID",t.J),sn(n,"RID",e),sn(n,"TYPE","terminate"),er(t,n),(e=new Pe(t,t.c,e,void 0)).H=2,e.i=un(tn(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(e.i.toString(),"")),!n&&x.Image&&((new Image).src=e.i,n=!0),n||(e.a=pr(e.g,null),e.a.ba(e.i)),e.u=q(),Ge(e)),fr(t)}function Xn(t){t.a&&(or(t),t.a.cancel(),t.a=null)}function $n(t){Xn(t),t.j&&(x.clearTimeout(t.j),t.j=null),ur(t),t.b.cancel(),t.h&&("number"==typeof t.h&&x.clearTimeout(t.h),t.h=null)}function Jn(t,e){t.g.push(new En(t.La++,e)),3==t.v&&Zn(t)}function Zn(t){An(t.b)||t.h||(t.h=!0,Jt(t.Ba,t),t.u=0)}function tr(t,e){var n=e?e.f:t.R++,r=tn(t.B);sn(r,"SID",t.J),sn(r,"RID",n),sn(r,"AID",t.P),er(t,r),t.i&&t.l&&Qn(r,t.i,t.l),n=new Pe(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=nr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Dn(t.b,n),Fe(n,r,e)}function er(t,e){t.f&&We({},(function(t,n){sn(e,n,t)}))}function nr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?M(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,e,n){var r=n||"";try{We(t,(function(t,n){var i=t;L(t)&&(i=Qt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function rr(t){t.a||t.j||(t.U=1,Jt(t.Aa,t),t.o=0)}function ir(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=_e(M(t.Aa,t),cr(t,t.o)),t.o++,1)}function or(t){null!=t.s&&(x.clearTimeout(t.s),t.s=null)}function sr(t){t.a=new Pe(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=tn(t.la);sn(e,"RID","rpc"),sn(e,"SID",t.J),sn(e,"CI",t.H?"0":"1"),sn(e,"AID",t.P),er(t,e),sn(e,"TYPE","xmlhttp"),t.i&&t.l&&Qn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=un(tn(e)),n.j=null,n.I=!0,qe(n,t)}function ur(t){null!=t.m&&(x.clearTimeout(t.m),t.m=null)}function ar(t,e){var n,r=null;if(t.a==e){ur(t),or(t),t.a=null;var i=2}else{if(!Sn(t.b,e))return;r=e.s,xn(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b)1==i?(r=e.j?e.j.length:0,e=q()-e.u,n=t.u,(i=me()).dispatchEvent(new Te(i)),Zn(t)):rr(t);else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(Nn(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)))return t.h=_e(M(t.Ba,t,e),cr(t,t.u)),t.u++,1}}(t,e)||2==i&&ir(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:hr(t,5);break;case 4:hr(t,10);break;case 3:hr(t,6);break;default:hr(t,2)}}function cr(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function hr(t,e){var n,r,i,o,s,u;t.c.info("Error code "+e),2==e?(n=null,t.f&&(n=null),r=M(t.Xa,t),n||(n=new Ze("//www.google.com/images/cleardot.gif"),x.location&&"http"==x.location.protocol||en(n,"https"),un(n)),i=n.toString(),o=r,u=new ve,x.Image?((s=new Image).onload=F(Ln,u,s,"TestLoadImage: loaded",!0,o),s.onerror=F(Ln,u,s,"TestLoadImage: error",!1,o),s.onabort=F(Ln,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=F(Ln,u,s,"TestLoadImage: timeout",!1,o),x.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=i):o(!1)):Ee(),t.v=0,t.f&&t.f.ra(e),fr(t),$n(t)}function fr(t){t.v=0,t.I=-1,t.f&&(0==On(t.b).length&&0==t.g.length||(t.b.c.length=0,Q(t.g),t.g.length=0),t.f.qa())}function lr(t,e,n){var r,i,o,s,u,a,c,h=(r=n)instanceof Ze?tn(r):new Ze(r,void 0);return""!=h.c?(e&&nn(h,e+"."+h.c),rn(h,h.h)):(o=(i=x.location).protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,c=new Ze(null,void 0),o&&en(c,o),s&&nn(c,s),u&&rn(c,u),a&&(c.g=a),h=c),t.W&&tt(t.W,(function(t,e){sn(h,e,t)})),e=t.A,n=t.na,e&&n&&sn(h,e,n),sn(h,"VER",t.ha),er(t,h),h}function pr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Pn(t.Ka)).F=t.C,e}function dr(){}function vr(){if(at&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function yr(t,e){zt.call(this),this.a=new Wn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new wr(this)}function gr(t){ke.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function mr(){Le.call(this),this.status=1}function wr(t){this.a=t}(N=Pn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?De(this.H):De(Oe),this.a.onreadystatechange=M(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void qn(this,t)}t=n||"";var i,o=new Ye(this.headers);r&&We(r,(function(t,e){o.set(e,t)})),r=function(t){t:{for(var e=Fn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=x.FormData&&t instanceof x.FormData,0<=B(Mn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{zn(this),0<this.o&&((this.D=(i=this.a,at&&mt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=M(this.xa,this)):this.m=ie(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){qn(this,t)}},N.xa=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Bn(this))},N.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Bn(this,!0)),Pn.S.G.call(this)},N.za=function(){this.j||(this.A||this.l||this.g?Gn(this):this.Ta())},N.Ta=function(){Gn(this)},N.X=function(){try{return 2<Hn(this)?this.a.status:-1}catch(t){return-1}},N.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Cn(e)}},N.ua=function(){return this.h},N.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Wn.prototype).ha=8,N.v=1,N.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Pe(this,this.c,t,void 0),r=this.l;if(this.O&&(r?rt(r=et(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=nr(this,n,e),sn(i=tn(this.B),"RID",t),sn(i,"CVER",22),this.A&&sn(i,"X-HTTP-Session-Id",this.A),er(this,i),this.i&&r&&Qn(i,this.i,r),Dn(this.b,n),this.Ga&&sn(i,"TYPE","init"),this.da?(sn(i,"$req",e),sn(i,"SID","null"),n.V=!0,Fe(n,i,null)):Fe(n,i,e),this.v=2}}else 3==this.v&&(t?tr(this,t):0==this.g.length||An(this.b)||tr(this))},N.Aa=function(){var t;this.j=null,sr(this),this.V&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=_e(M(this.Sa,this),t))},N.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Xn(this),sr(this))},N.Ra=function(){null!=this.m&&(this.m=null,Xn(this),ir(this),Ee())},N.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),Ee()):(this.c.info("Failed to ping google.com"),Ee())},(N=dr.prototype).ta=function(){},N.sa=function(){},N.ra=function(){},N.qa=function(){},N.Ha=function(){},vr.prototype.a=function(t,e){return new yr(t,e)},j(yr,zt),(N=yr.prototype).addEventListener=function(t,e,n,r){yr.S.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){yr.S.removeEventListener.call(this,t,e,n,r)},N.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;Ee(),t.fa=e,t.W=n||{},t.H=t.T,t.B=lr(t,null,t.fa),Zn(t)},N.close=function(){Yn(this.a)},N.Pa=function(t){var e;"string"==typeof t?((e={}).__data__=t,Jn(this.a,e)):this.g?((e={}).__data__=Qt(t),Jn(this.a,e)):Jn(this.a,t)},N.G=function(){this.a.f=null,delete this.f,Yn(this.a),delete this.a,yr.S.G.call(this)},j(gr,ke),j(mr,Le),j(wr,dr),wr.prototype.ta=function(){this.a.dispatchEvent("a")},wr.prototype.sa=function(t){this.a.dispatchEvent(new gr(t))},wr.prototype.ra=function(t){this.a.dispatchEvent(new mr)},wr.prototype.qa=function(){this.a.dispatchEvent("b")},vr.prototype.createWebChannel=vr.prototype.a,yr.prototype.send=yr.prototype.Pa,yr.prototype.open=yr.prototype.Oa,Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,Ne.COMPLETE="complete",(xe.EventType=Re).OPEN="a",Re.CLOSE="b",Re.ERROR="c",Re.MESSAGE="d",zt.prototype.listen=zt.prototype.va,Pn.prototype.listenOnce=Pn.prototype.wa,Pn.prototype.getLastError=Pn.prototype.Qa,Pn.prototype.getLastErrorCode=Pn.prototype.ua,Pn.prototype.getStatus=Pn.prototype.X,Pn.prototype.getResponseJson=Pn.prototype.Na,Pn.prototype.getResponseText=Pn.prototype.$,Pn.prototype.send=Pn.prototype.ba;var br={createWebChannelTransport:function(){return new vr},ErrorCode:Ae,EventType:Ne,WebChannel:xe,XhrIo:Pn},Ir=br.createWebChannelTransport,Er=br.ErrorCode,Tr=br.EventType,_r=br.WebChannel,Ar=br.XhrIo,Nr=(Sr.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Sr.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Sr.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Sr);function Sr(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Dr,xr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Or=(s(kr,Dr=Error),kr),Rr=new v("@firebase/firestore");function kr(t,e){var n=this;return(n=Dr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Lr(){return Rr.logLevel}function Cr(t){for(var e,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];Rr.logLevel<=n.DEBUG&&(e=r.map(Vr),Rr.debug.apply(Rr,c(["Firestore (7.22.1): "+t],e)))}function Pr(t){for(var e,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];Rr.logLevel<=n.ERROR&&(e=r.map(Vr),Rr.error.apply(Rr,c(["Firestore (7.22.1): "+t],e)))}function Ur(t){for(var e,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];Rr.logLevel<=n.WARN&&(e=r.map(Vr),Rr.warn.apply(Rr,c(["Firestore (7.22.1): "+t],e)))}function Vr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Mr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.22.1) INTERNAL ASSERTION FAILED: "+t;throw Pr(e),new Error(e)}function Fr(t){t||Mr()}function qr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function jr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Gr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Br,zr,Hr=(Object.defineProperty(Zr.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),Zr.prototype.isEqual=function(t){return 0===Zr.i(this,t)},Zr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Zr?t.forEach((function(t){e.push(t)})):e.push(t),this.o(e)},Zr.prototype.limit=function(){return this.offset+this.length},Zr.prototype.u=function(t){return t=void 0===t?1:t,this.o(this.segments,this.offset+t,this.length-t)},Zr.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},Zr.prototype.l=function(){return this.segments[this.offset]},Zr.prototype._=function(){return this.get(this.length-1)},Zr.prototype.get=function(t){return this.segments[this.offset+t]},Zr.prototype.m=function(){return 0===this.length},Zr.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Zr.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Zr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Zr.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},Zr.i=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Zr),Qr=(s(Jr,zr=Hr),Jr.prototype.o=function(t,e,n){return new Jr(t,e,n)},Jr.prototype.R=function(){return this.A().join("/")},Jr.prototype.toString=function(){return this.R()},Jr.P=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Or(xr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter((function(t){return 0<t.length})))}return new Jr(n)},Jr.g=function(){return new Jr([])},Jr),Kr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Wr=(s($r,Br=Hr),$r.prototype.o=function(t,e,n){return new $r(t,e,n)},$r.V=function(t){return Kr.test(t)},$r.prototype.R=function(){return this.A().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),$r.V(t)||(t="`"+t+"`"),t})).join(".")},$r.prototype.toString=function(){return this.R()},$r.prototype.p=function(){return 1===this.length&&"__name__"===this.get(0)},$r.v=function(){return new $r(["__name__"])},$r.S=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Or(xr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Or(xr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Or(xr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Or(xr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new $r(e)},$r.g=function(){return new $r([])},$r),Yr=(Xr.D=function(t){return new Xr(Qr.P(t))},Xr.C=function(t){return new Xr(Qr.P(t).u(5))},Xr.prototype.N=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Xr.prototype.isEqual=function(t){return null!==t&&0===Qr.i(this.path,t.path)},Xr.prototype.toString=function(){return this.path.toString()},Xr.i=function(t,e){return Qr.i(t.path,e.path)},Xr.F=function(t){return t.length%2==0},Xr.$=function(t){return new Xr(new Qr(t.slice()))},Xr);function Xr(t){this.path=t}function $r(){return null!==Br&&Br.apply(this,arguments)||this}function Jr(){return null!==zr&&zr.apply(this,arguments)||this}function Zr(t,e,n){void 0===e?e=0:e>t.length&&Mr(),void 0===n?n=t.length-e:n>t.length-e&&Mr(),this.segments=t,this.offset=e,this.t=n}function ti(t,e){if(0!==e.length)throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+mi(e.length,"argument")+".")}function ei(t,e,n){if(e.length!==n)throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires "+mi(n,"argument")+", but was called with "+mi(e.length,"argument")+".")}function ni(t,e,n){if(e.length<n)throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+mi(n,"argument")+", but was called with "+mi(e.length,"argument")+".")}function ri(t,e,n,r){if(e.length<n||e.length>r)throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+mi(e.length,"argument")+".")}function ii(t,e,n,r){hi(t,e,gi(n)+" argument",r)}function oi(t,e,n,r){void 0!==r&&ii(t,e,n,r)}function si(t,e,n,r){hi(t,e,n+" option",r)}function ui(t,e,n,r){void 0!==r&&si(t,e,n,r)}function ai(t,e,n,r,i){void 0!==r&&function(t,e,n){for(var r=[],o=0,s=i;o<s.length;o++){var u=s[o];if(u===n)return;r.push(li(u))}var a=li(n);throw new Or(xr.INVALID_ARGUMENT,"Invalid value "+a+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function ci(t,e,n,r){if(!e.some((function(t){return t===r})))throw new Or(xr.INVALID_ARGUMENT,"Invalid value "+li(r)+" provided to function "+t+"() for its "+gi(n)+" argument. Acceptable values: "+e.join(", "));return r}function hi(t,e,n,r){if(!("object"===e?fi(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=li(r);throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function fi(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function li(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Mr();if(t instanceof Array)return"an array";var e=function(){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}();return e?"a custom "+e+" object":"an object"}function pi(t,e,n){if(void 0===n)throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+gi(e)+" argument, but it was undefined.")}function di(t,e,n){jr(e,(function(e,r){if(n.indexOf(e)<0)throw new Or(xr.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function vi(t,e,n,r){var i=li(r);return new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires its "+gi(n)+" argument to be a "+e+", but it was: "+i)}function yi(t,e,n){if(n<=0)throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires its "+gi(e)+" argument to be a positive number, but it was: "+n+".")}function gi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function mi(t,e){return t+" "+e+(1===t?"":"s")}var wi=(bi.k=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<40;r++)n[r]=Math.floor(256*Math.random());return n}(),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},bi);function bi(){}function Ii(t,e){return t<e?-1:e<t?1:0}function Ei(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Ti(t){return t+"\0"}var _i=(Ai.fromBase64String=function(t){return new Ai(atob(t))},Ai.fromUint8Array=function(t){return new Ai(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Ai.prototype.toBase64=function(){return t=this.M,btoa(t);var t},Ai.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.M)},Ai.prototype.O=function(){return 2*this.M.length},Ai.prototype.L=function(t){return Ii(this.M,t.M)},Ai.prototype.isEqual=function(t){return this.M===t.M},Ai);function Ai(t){this.M=t}_i.B=new _i("");var Ni=(Si.fromBase64String=function(t){try{return new Si(_i.fromBase64String(t))}catch(t){throw new Or(xr.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},Si.fromUint8Array=function(t){return new Si(_i.fromUint8Array(t))},Si.prototype.toBase64=function(){return this.q.toBase64()},Si.prototype.toUint8Array=function(){return this.q.toUint8Array()},Si.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Si.prototype.isEqual=function(t){return this.q.isEqual(t.q)},Si);function Si(t){this.q=t}function Di(){if("undefined"==typeof Uint8Array)throw new Or(xr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function xi(){if("undefined"==typeof atob)throw new Or(xr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function Oi(t,e,n,r,i){this.U=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Ri,ki=(s(ji,Ri=Ni),ji.fromBase64String=function(t){ei("Blob.fromBase64String",arguments,1),ii("Blob.fromBase64String","string",1,t),xi();try{return new ji(_i.fromBase64String(t))}catch(t){throw new Or(xr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},ji.fromUint8Array=function(t){if(ei("Blob.fromUint8Array",arguments,1),Di(),!(t instanceof Uint8Array))throw vi("Blob.fromUint8Array","Uint8Array",1,t);return new ji(_i.fromUint8Array(t))},ji.prototype.toBase64=function(){return ei("Blob.toBase64",arguments,0),xi(),Ri.prototype.toBase64.call(this)},ji.prototype.toUint8Array=function(){return ei("Blob.toUint8Array",arguments,0),Di(),Ri.prototype.toUint8Array.call(this)},ji.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},ji),Li=(Object.defineProperty(qi.prototype,"W",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),qi.prototype.isEqual=function(t){return t instanceof qi&&t.projectId===this.projectId&&t.database===this.database},qi.prototype.L=function(t){return Ii(this.projectId,t.projectId)||Ii(this.database,t.database)},qi),Ci=(Fi.prototype.get=function(t){var e=this.j(t),n=this.G[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.K(s,t))return u}},Fi.prototype.has=function(t){return void 0!==this.get(t)},Fi.prototype.set=function(t,e){var n=this.j(t),r=this.G[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.K(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.G[n]=[[t,e]]},Fi.prototype.delete=function(t){var e=this.j(t),n=this.G[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.K(n[r][0],t))return 1===n.length?delete this.G[e]:n.splice(r,1),!0;return!1},Fi.prototype.forEach=function(t){jr(this.G,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},Fi.prototype.m=function(){return Gr(this.G)},Fi),Pi=(Mi.now=function(){return Mi.fromMillis(Date.now())},Mi.fromDate=function(t){return Mi.fromMillis(t.getTime())},Mi.fromMillis=function(t){var e=Math.floor(t/1e3);return new Mi(e,1e6*(t-1e3*e))},Mi.prototype.toDate=function(){return new Date(this.toMillis())},Mi.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Mi.prototype.H=function(t){return this.seconds===t.seconds?Ii(this.nanoseconds,t.nanoseconds):Ii(this.seconds,t.seconds)},Mi.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Mi.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Mi.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Mi.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Mi),Ui=(Vi.Y=function(t){return new Vi(t)},Vi.min=function(){return new Vi(new Pi(0,0))},Vi.prototype.L=function(t){return this.timestamp.H(t.timestamp)},Vi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Vi.prototype.J=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Vi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Vi.prototype.X=function(){return this.timestamp},Vi);function Vi(t){this.timestamp=t}function Mi(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Or(xr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Or(xr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Or(xr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Or(xr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Fi(t,e){this.j=t,this.K=e,this.G={}}function qi(t,e){this.projectId=t,this.database=e||"(default)"}function ji(){return null!==Ri&&Ri.apply(this,arguments)||this}function Gi(t){return null==t}function Bi(t){return 0===t&&1/t==-1/0}function zi(t){return"number"==typeof t&&Number.isInteger(t)&&!Bi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Hi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Z=null};function Qi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Hi(t,e,n,r,i,o,s)}function Ki(t){var e,n=t;return null===n.Z&&(e=n.path.R(),null!==n.collectionGroup&&(e+="|cg:"+n.collectionGroup),e+="|f:",e+=n.filters.map((function(t){return(e=t).field.R()+e.op.toString()+Wo(e.value);var e})).join(","),e+="|ob:",e+=n.orderBy.map((function(t){return(e=t).field.R()+e.dir;var e})).join(","),Gi(n.limit)||(e+="|l:",e+=n.limit),n.startAt&&(e+="|lb:",e+=Da(n.startAt)),n.endAt&&(e+="|ub:",e+=Da(n.endAt)),n.Z=e),n.Z}function Wi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!zo(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Oa(t.startAt,e.startAt)&&Oa(t.endAt,e.endAt)}function Yi(t){return Yr.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Xi(t){this.count=t}var $i,Ji,Zi=(to.prototype.nt=function(t){return new to(this.target,this.targetId,this.tt,t,this.et,this.lastLimboFreeSnapshotVersion,this.resumeToken)},to.prototype.st=function(t,e){return new to(this.target,this.targetId,this.tt,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},to.prototype.it=function(t){return new to(this.target,this.targetId,this.tt,this.sequenceNumber,this.et,t,this.resumeToken)},to);function to(t,e,n,r,i,o,s){void 0===i&&(i=Ui.min()),void 0===o&&(o=Ui.min()),void 0===s&&(s=_i.B),this.target=t,this.targetId=e,this.tt=n,this.sequenceNumber=r,this.et=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function eo(t){switch(t){case xr.OK:return Mr(),0;case xr.CANCELLED:case xr.UNKNOWN:case xr.DEADLINE_EXCEEDED:case xr.RESOURCE_EXHAUSTED:case xr.INTERNAL:case xr.UNAVAILABLE:case xr.UNAUTHENTICATED:return;case xr.INVALID_ARGUMENT:case xr.NOT_FOUND:case xr.ALREADY_EXISTS:case xr.PERMISSION_DENIED:case xr.FAILED_PRECONDITION:case xr.ABORTED:case xr.OUT_OF_RANGE:case xr.UNIMPLEMENTED:case xr.DATA_LOSS:return 1;default:return Mr(),0}}function no(t){if(void 0===t)return Pr("GRPC error has no .code"),xr.UNKNOWN;switch(t){case $i.OK:return xr.OK;case $i.CANCELLED:return xr.CANCELLED;case $i.UNKNOWN:return xr.UNKNOWN;case $i.DEADLINE_EXCEEDED:return xr.DEADLINE_EXCEEDED;case $i.RESOURCE_EXHAUSTED:return xr.RESOURCE_EXHAUSTED;case $i.INTERNAL:return xr.INTERNAL;case $i.UNAVAILABLE:return xr.UNAVAILABLE;case $i.UNAUTHENTICATED:return xr.UNAUTHENTICATED;case $i.INVALID_ARGUMENT:return xr.INVALID_ARGUMENT;case $i.NOT_FOUND:return xr.NOT_FOUND;case $i.ALREADY_EXISTS:return xr.ALREADY_EXISTS;case $i.PERMISSION_DENIED:return xr.PERMISSION_DENIED;case $i.FAILED_PRECONDITION:return xr.FAILED_PRECONDITION;case $i.ABORTED:return xr.ABORTED;case $i.OUT_OF_RANGE:return xr.OUT_OF_RANGE;case $i.UNIMPLEMENTED:return xr.UNIMPLEMENTED;case $i.DATA_LOSS:return xr.DATA_LOSS;default:return Mr()}}(Ji=$i=$i||{})[Ji.OK=0]="OK",Ji[Ji.CANCELLED=1]="CANCELLED",Ji[Ji.UNKNOWN=2]="UNKNOWN",Ji[Ji.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ji[Ji.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ji[Ji.NOT_FOUND=5]="NOT_FOUND",Ji[Ji.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ji[Ji.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ji[Ji.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ji[Ji.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ji[Ji.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ji[Ji.ABORTED=10]="ABORTED",Ji[Ji.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ji[Ji.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ji[Ji.INTERNAL=13]="INTERNAL",Ji[Ji.UNAVAILABLE=14]="UNAVAILABLE",Ji[Ji.DATA_LOSS=15]="DATA_LOSS";var ro=(ao.prototype.rt=function(t,e){return new ao(this.i,this.root.rt(t,e,this.i).copy(null,null,oo.ot,null,null))},ao.prototype.remove=function(t){return new ao(this.i,this.root.remove(t,this.i).copy(null,null,oo.ot,null,null))},ao.prototype.get=function(t){for(var e=this.root;!e.m();){var n=this.i(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ao.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.m();){var r=this.i(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ao.prototype.m=function(){return this.root.m()},Object.defineProperty(ao.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),ao.prototype.at=function(){return this.root.at()},ao.prototype.ct=function(){return this.root.ct()},ao.prototype.ut=function(t){return this.root.ut(t)},ao.prototype.forEach=function(t){this.ut((function(e,n){return t(e,n),!1}))},ao.prototype.toString=function(){var t=[];return this.ut((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},ao.prototype.ht=function(t){return this.root.ht(t)},ao.prototype.lt=function(){return new io(this.root,null,this.i,!1)},ao.prototype._t=function(t){return new io(this.root,t,this.i,!1)},ao.prototype.ft=function(){return new io(this.root,null,this.i,!0)},ao.prototype.dt=function(t){return new io(this.root,t,this.i,!0)},ao),io=(uo.prototype.Et=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.m();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.m();)this.Tt.push(t),t=t.left;return e},uo.prototype.It=function(){return 0<this.Tt.length},uo.prototype.At=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},uo),oo=(so.prototype.copy=function(t,e,n,r,i){return new so(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},so.prototype.m=function(){return!1},so.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},so.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},so.prototype.min=function(){return this.left.m()?this:this.left.min()},so.prototype.at=function(){return this.min().key},so.prototype.ct=function(){return this.right.m()?this.key:this.right.ct()},so.prototype.rt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.rt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.rt(t,e,n))).Rt()},so.prototype.Pt=function(){if(this.left.m())return so.EMPTY;var t=this;return t.left.gt()||t.left.left.gt()||(t=t.yt()),(t=t.copy(null,null,null,t.left.Pt(),null)).Rt()},so.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.m()||r.left.gt()||r.left.left.gt()||(r=r.yt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.gt()&&(r=r.Vt()),r.right.m()||r.right.gt()||r.right.left.gt()||(r=r.bt()),0===e(t,r.key)){if(r.right.m())return so.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Pt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Rt()},so.prototype.gt=function(){return this.color},so.prototype.Rt=function(){var t=this;return t.right.gt()&&!t.left.gt()&&(t=t.vt()),t.left.gt()&&t.left.left.gt()&&(t=t.Vt()),t.left.gt()&&t.right.gt()&&(t=t.St()),t},so.prototype.yt=function(){var t=this.St();return t.right.left.gt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).vt()).St()),t},so.prototype.bt=function(){var t=this.St();return t.left.left.gt()&&(t=(t=t.Vt()).St()),t},so.prototype.vt=function(){var t=this.copy(null,null,so.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},so.prototype.Vt=function(){var t=this.copy(null,null,so.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},so.prototype.St=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},so.prototype.Dt=function(){var t=this.Ct();return Math.pow(2,t)<=this.size+1},so.prototype.Ct=function(){if(this.gt()&&this.left.gt())throw Mr();if(this.right.gt())throw Mr();var t=this.left.Ct();if(t!==this.right.Ct())throw Mr();return t+(this.gt()?0:1)},so);function so(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:so.RED,this.left=null!=r?r:so.EMPTY,this.right=null!=i?i:so.EMPTY,this.size=this.left.size+1+this.right.size}function uo(t,e,n,r){this.wt=r,this.Tt=[];for(var i=1;!t.m();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.wt?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.wt?t.right:t.left}}function ao(t,e){this.i=t,this.root=e||oo.EMPTY}function co(){this.size=0}oo.EMPTY=null,oo.RED=!0,oo.ot=!1,oo.EMPTY=(Object.defineProperty(co.prototype,"key",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Object.defineProperty(co.prototype,"value",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Object.defineProperty(co.prototype,"color",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Object.defineProperty(co.prototype,"left",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),Object.defineProperty(co.prototype,"right",{get:function(){throw Mr()},enumerable:!1,configurable:!0}),co.prototype.copy=function(t,e,n,r,i){return this},co.prototype.rt=function(t,e,n){return new oo(t,e)},co.prototype.remove=function(t,e){return this},co.prototype.m=function(){return!0},co.prototype.ut=function(t){return!1},co.prototype.ht=function(t){return!1},co.prototype.at=function(){return null},co.prototype.ct=function(){return null},co.prototype.gt=function(){return!1},co.prototype.Dt=function(){return!0},co.prototype.Ct=function(){return 0},new co);var ho=(vo.prototype.has=function(t){return null!==this.data.get(t)},vo.prototype.first=function(){return this.data.at()},vo.prototype.last=function(){return this.data.ct()},Object.defineProperty(vo.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),vo.prototype.indexOf=function(t){return this.data.indexOf(t)},vo.prototype.forEach=function(t){this.data.ut((function(e,n){return t(e),!1}))},vo.prototype.Nt=function(t,e){for(var n=this.data._t(t[0]);n.It();){var r=n.Et();if(0<=this.i(r.key,t[1]))return;e(r.key)}},vo.prototype.Ft=function(t,e){for(var n=void 0!==e?this.data._t(e):this.data.lt();n.It();)if(!t(n.Et().key))return},vo.prototype.$t=function(t){var e=this.data._t(t);return e.It()?e.Et().key:null},vo.prototype.lt=function(){return new fo(this.data.lt())},vo.prototype._t=function(t){return new fo(this.data._t(t))},vo.prototype.add=function(t){return this.copy(this.data.remove(t).rt(t,!0))},vo.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},vo.prototype.m=function(){return this.data.m()},vo.prototype.xt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},vo.prototype.isEqual=function(t){if(!(t instanceof vo))return!1;if(this.size!==t.size)return!1;for(var e=this.data.lt(),n=t.data.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(0!==this.i(r,i))return!1}return!0},vo.prototype.A=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},vo.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},vo.prototype.copy=function(t){var e=new vo(this.i);return e.data=t,e},vo),fo=(po.prototype.Et=function(){return this.kt.Et().key},po.prototype.It=function(){return this.kt.It()},po),lo=new ro(Yr.i);function po(t){this.kt=t}function vo(t){this.i=t,this.data=new ro(this.i)}var yo=new ro(Yr.i),go=new ro(Yr.i),mo=new ho(Yr.i);function wo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=mo,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var bo=new ho(Ii),Io=(Vo.Lt=function(t){return new Vo(t.i)},Vo.prototype.has=function(t){return null!=this.Mt.get(t)},Vo.prototype.get=function(t){return this.Mt.get(t)},Vo.prototype.first=function(){return this.Ot.at()},Vo.prototype.last=function(){return this.Ot.ct()},Vo.prototype.m=function(){return this.Ot.m()},Vo.prototype.indexOf=function(t){var e=this.Mt.get(t);return e?this.Ot.indexOf(e):-1},Object.defineProperty(Vo.prototype,"size",{get:function(){return this.Ot.size},enumerable:!1,configurable:!0}),Vo.prototype.forEach=function(t){this.Ot.ut((function(e,n){return t(e),!1}))},Vo.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Mt.rt(t.key,t),e.Ot.rt(t,null))},Vo.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Mt.remove(t),this.Ot.remove(e)):this},Vo.prototype.isEqual=function(t){if(!(t instanceof Vo))return!1;if(this.size!==t.size)return!1;for(var e=this.Ot.lt(),n=t.Ot.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(!r.isEqual(i))return!1}return!0},Vo.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},Vo.prototype.copy=function(t,e){var n=new Vo;return n.i=this.i,n.Mt=t,n.Ot=e,n},Vo),Eo=(Uo.prototype.track=function(t){var e=t.doc.key,n=this.Bt.get(e);!n||0!==t.type&&3===n.type?this.Bt=this.Bt.rt(e,t):3===t.type&&1!==n.type?this.Bt=this.Bt.rt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Bt=this.Bt.rt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Bt=this.Bt.remove(e):1===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):Mr()},Uo.prototype.qt=function(){var t=[];return this.Bt.ut((function(e,n){t.push(n)})),t},Uo),To=(Po.Kt=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:0,doc:t})})),new Po(t,e,Io.Lt(e),i,n,r,!0,!1)},Object.defineProperty(Po.prototype,"hasPendingWrites",{get:function(){return!this.Qt.m()},enumerable:!1,configurable:!0}),Po.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&$u(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ut.isEqual(t.Ut)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Po),_o=(Co.Jt=function(t,e){var n=new Map;return n.set(t,Ao.Xt(t,e)),new Co(Ui.min(),n,bo,lo,wo())},Co),Ao=(Lo.Xt=function(t,e){return new Lo(_i.B,e,wo(),wo(),wo())},Lo),No=function(t,e,n,r){this.se=t,this.removedTargetIds=e,this.key=n,this.ie=r},So=function(t,e){this.targetId=t,this.re=e},Do=function(t,e,n,r){void 0===n&&(n=_i.B),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},xo=(Object.defineProperty(ko.prototype,"Zt",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(ko.prototype,"resumeToken",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(ko.prototype,"le",{get:function(){return 0!==this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(ko.prototype,"_e",{get:function(){return this.he},enumerable:!1,configurable:!0}),ko.prototype.fe=function(t){0<t.O()&&(this.he=!0,this.ce=t)},ko.prototype.de=function(){var t=wo(),e=wo(),n=wo();return this.ae.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Mr()}})),new Ao(this.ce,this.ue,t,e,n)},ko.prototype.we=function(){this.he=!1,this.ae=Fo()},ko.prototype.me=function(t,e){this.he=!0,this.ae=this.ae.rt(t,e)},ko.prototype.Te=function(t){this.he=!0,this.ae=this.ae.remove(t)},ko.prototype.Ee=function(){this.oe+=1},ko.prototype.Ie=function(){--this.oe},ko.prototype.Ae=function(){this.he=!0,this.ue=!0},ko),Oo=(Ro.prototype.pe=function(t){for(var e=0,n=t.se;e<n.length;e++){var r=n[e];t.ie instanceof ku?this.be(r,t.ie):t.ie instanceof Lu&&this.ve(r,t.key,t.ie)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ve(s,t.key,t.ie)}},Ro.prototype.Se=function(t){var e=this;this.De(t,(function(n){var r=e.Ce(n);switch(t.state){case 0:e.Ne(n)&&r.fe(t.resumeToken);break;case 1:r.Ie(),r.le||r.we(),r.fe(t.resumeToken);break;case 2:r.Ie(),r.le||e.removeTarget(n);break;case 3:e.Ne(n)&&(r.Ae(),r.fe(t.resumeToken));break;case 4:e.Ne(n)&&(e.Fe(n),r.fe(t.resumeToken));break;default:Mr()}}))},Ro.prototype.De=function(t,e){var n=this;0<t.targetIds.length?t.targetIds.forEach(e):this.Pe.forEach((function(t,r){n.Ne(r)&&e(r)}))},Ro.prototype.$e=function(t){var e,n,r=t.targetId,i=t.re.count,o=this.xe(r);o&&(Yi(e=o.target)?0===i?(n=new Yr(e.path),this.ve(r,n,new Lu(n,Ui.min()))):Fr(1===i):this.ke(r)!==i&&(this.Fe(r),this.Ve=this.Ve.add(r)))},Ro.prototype.Me=function(t){var e=this,n=new Map;this.Pe.forEach((function(r,i){var o,s=e.xe(i);s&&(r.Zt&&Yi(s.target)&&(o=new Yr(s.target.path),null!==e.ge.get(o)||e.Oe(i,o)||e.ve(i,o,new Lu(o,t))),r._e&&(n.set(i,r.de()),r.we()))}));var r=wo();this.ye.forEach((function(t,n){var i=!0;n.Ft((function(t){var n=e.xe(t);return!n||2===n.tt||(i=!1)})),i&&(r=r.add(t))}));var i=new _o(t,n,this.Ve,this.ge,r);return this.ge=lo,this.ye=Mo(),this.Ve=new ho(Ii),i},Ro.prototype.be=function(t,e){var n;this.Ne(t)&&(n=this.Oe(t,e.key)?2:0,this.Ce(t).me(e.key,n),this.ge=this.ge.rt(e.key,e),this.ye=this.ye.rt(e.key,this.Le(e.key).add(t)))},Ro.prototype.ve=function(t,e,n){var r;this.Ne(t)&&(r=this.Ce(t),this.Oe(t,e)?r.me(e,1):r.Te(e),this.ye=this.ye.rt(e,this.Le(e).delete(t)),n&&(this.ge=this.ge.rt(e,n)))},Ro.prototype.removeTarget=function(t){this.Pe.delete(t)},Ro.prototype.ke=function(t){var e=this.Ce(t).de();return this.Re.Be(t).size+e.te.size-e.ne.size},Ro.prototype.Ee=function(t){this.Ce(t).Ee()},Ro.prototype.Ce=function(t){var e=this.Pe.get(t);return e||(e=new xo,this.Pe.set(t,e)),e},Ro.prototype.Le=function(t){var e=this.ye.get(t);return e||(e=new ho(Ii),this.ye=this.ye.rt(t,e)),e},Ro.prototype.Ne=function(t){var e=null!==this.xe(t);return e||Cr("WatchChangeAggregator","Detected inactive target",t),e},Ro.prototype.xe=function(t){var e=this.Pe.get(t);return e&&e.le?null:this.Re.qe(t)},Ro.prototype.Fe=function(t){var e=this;this.Pe.set(t,new xo),this.Re.Be(t).forEach((function(n){e.ve(t,n,null)}))},Ro.prototype.Oe=function(t,e){return this.Re.Be(t).has(e)},Ro);function Ro(t){this.Re=t,this.Pe=new Map,this.ge=lo,this.ye=Mo(),this.Ve=new ho(Ii)}function ko(){this.oe=0,this.ae=Fo(),this.ce=_i.B,this.ue=!1,this.he=!0}function Lo(t,e,n,r,i){this.resumeToken=t,this.Zt=e,this.te=n,this.ee=r,this.ne=i}function Co(t,e,n,r,i){this.et=t,this.Gt=e,this.zt=n,this.Ht=r,this.Yt=i}function Po(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ut=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}function Uo(){this.Bt=new ro(Yr.i)}function Vo(t){this.i=t?function(e,n){return t(e,n)||Yr.i(e.key,n.key)}:function(t,e){return Yr.i(t.key,e.key)},this.Mt=yo,this.Ot=new ro(this.i)}function Mo(){return new ro(Yr.i)}function Fo(){return new ro(Yr.i)}function qo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function jo(t){var e=Yo(t.mapValue.fields.__local_write_time__.timestampValue);return new Pi(e.seconds,e.nanos)}var Go=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Bo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?qo(t)?4:10:Mr()}function zo(t,e){var n,r,i,o=Bo(t);if(o!==Bo(e))return!1;switch(o){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return jo(t).isEqual(jo(e));case 3:return function(e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Yo(t.timestampValue),r=Yo(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e);case 5:return t.stringValue===e.stringValue;case 6:return i=e,$o(t.bytesValue).isEqual($o(i.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return r=e,Xo((n=t).geoPointValue.latitude)===Xo(r.geoPointValue.latitude)&&Xo(n.geoPointValue.longitude)===Xo(r.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Xo(t.integerValue)===Xo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Xo(t.doubleValue),r=Xo(e.doubleValue);return n===r?Bi(n)===Bi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Ei(t.arrayValue.values||[],e.arrayValue.values||[],zo);case 10:return function(){var n,r=t.mapValue.fields||{},i=e.mapValue.fields||{};if(qr(r)!==qr(i))return!1;for(n in r)if(r.hasOwnProperty(n)&&(void 0===i[n]||!zo(r[n],i[n])))return!1;return!0}();default:return Mr()}}function Ho(t,e){return void 0!==(t.values||[]).find((function(t){return zo(t,e)}))}function Qo(t,e){var n,r,i,o,s,u,a,c,h,f,l=Bo(t),p=Bo(e);if(l!==p)return Ii(l,p);switch(l){case 0:return 0;case 1:return Ii(t.booleanValue,e.booleanValue);case 2:return c=e,(h=Xo(t.integerValue||t.doubleValue))<(f=Xo(c.integerValue||c.doubleValue))?-1:f<h?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1;case 3:return Ko(t.timestampValue,e.timestampValue);case 4:return Ko(jo(t),jo(e));case 5:return Ii(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=$o(o),a=$o(s),u.L(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ii(n[i],r[i]);if(0!==o)return o}return Ii(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Ii(Xo(n.latitude),Xo(r.latitude)))?i:Ii(Xo(n.longitude),Xo(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Qo(n[i],r[i]);if(o)return o}return Ii(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Ii(r[s],o[s]);if(0!==u)return u;var a=Qo(n[r[s]],i[o[s]]);if(0!==a)return a}return Ii(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Mr()}}function Ko(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ii(t,e);var n=Yo(t),r=Yo(e),i=Ii(n.seconds,r.seconds);return 0!==i?i:Ii(n.nanos,r.nanos)}function Wo(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?"time("+(n=Yo(e.timestampValue)).seconds+","+n.nanos+")":"stringValue"in e?e.stringValue:"bytesValue"in e?$o(e.bytesValue).toBase64():"referenceValue"in e?(i=e.referenceValue,Yr.C(i).toString()):"geoPointValue"in e?"geo("+(r=e.geoPointValue).latitude+","+r.longitude+")":"arrayValue"in e?function(){for(var n="[",r=!0,i=0,o=e.arrayValue.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}():"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Mr();var n,r,i}(t)}function Yo(t){if(Fr(!!t),"string"!=typeof t)return{seconds:Xo(t.seconds),nanos:Xo(t.nanos)};var e,n=0,r=Go.exec(t);Fr(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function Xo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function $o(t){return"string"==typeof t?_i.fromBase64String(t):_i.fromUint8Array(t)}function Jo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.R()}}function Zo(t){return t&&"integerValue"in t}function ts(t){return!!t&&"arrayValue"in t}function es(t){return t&&"nullValue"in t}function ns(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function rs(t){return t&&"mapValue"in t}var is={asc:"ASCENDING",desc:"DESCENDING"},os={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ss=function(t,e){this.U=t,this.Ue=e};function us(t){return{integerValue:""+t}}function as(t,e){if(t.Ue){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Bi(e)?"-0":e}}function cs(t,e){return zi(e)?us(e):as(t,e)}function hs(t,e){return t.Ue?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function fs(t,e){return t.Ue?e.toBase64():e.toUint8Array()}function ls(t){return Fr(!!t),Ui.Y((e=Yo(t),new Pi(e.seconds,e.nanos)));var e}function ps(t,e){return new Qr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).R()}function ds(t){var e=Qr.P(t);return Fr(Os(e)),e}function vs(t,e){return ps(t.U,e.path)}function ys(t,e){var n=ds(e);return Fr(n.get(1)===t.U.projectId),Fr(!n.get(3)&&!t.U.database||n.get(3)===t.U.database),new Yr(bs(n))}function gs(t,e){return ps(t.U,e)}function ms(t){var e=ds(t);return 4===e.length?Qr.g():bs(e)}function ws(t){return new Qr(["projects",t.U.projectId,"databases",t.U.database]).R()}function bs(t){return Fr(4<t.length&&"documents"===t.get(4)),t.u(5)}function Is(t,e,n){return{name:vs(t,e),fields:n.proto.mapValue.fields}}function Es(t,e){var n,r,i,o,s,u;if(e instanceof cu)n={update:Is(t,e.key,e.value)};else if(e instanceof bu)n={delete:vs(t,e.key)};else if(e instanceof hu)n={update:Is(t,e.key,e.data),updateMask:(r=e.Qe,i=[],r.fields.forEach((function(t){return i.push(t.R())})),{fieldPaths:i})};else if(e instanceof vu)n={transform:{document:vs(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){var e=t.transform;if(e instanceof Ps)return{fieldPath:t.field.R(),setToServerValue:"REQUEST_TIME"};if(e instanceof Us)return{fieldPath:t.field.R(),appendMissingElements:{values:e.elements}};if(e instanceof js)return{fieldPath:t.field.R(),removeAllFromArray:{values:e.elements}};if(e instanceof Hs)return{fieldPath:t.field.R(),increment:e.We};throw Mr()}))}};else{if(!(e instanceof Iu))return Mr();n={verify:vs(t,e.key)}}return e.Ke.je||(n.currentDocument=void 0!==(o=e.Ke).updateTime?{updateTime:(s=t,u=o.updateTime,hs(s,u.X()))}:void 0!==o.exists?{exists:o.exists}:Mr()),n}function Ts(t,e){var n,r,i=e.currentDocument?void 0!==(n=e.currentDocument).updateTime?Zs.updateTime(ls(n.updateTime)):void 0!==n.exists?Zs.exists(n.exists):Zs.Ge():Zs.Ge();if(e.update){e.update.name;var o=ys(t,e.update.name),s=new Eu({mapValue:{fields:e.update.fields}});if(e.updateMask){var u=(r=e.updateMask.fieldPaths||[],new Ys(r.map((function(t){return Wr.S(t)}))));return new hu(o,s,u,i)}return new cu(o,s,i)}if(e.delete){var a=ys(t,e.delete);return new bu(a,i)}if(e.transform){var c=ys(t,e.transform.document),h=e.transform.fieldTransforms.map((function(e){return function(t,e){var n,r,i=null;"setToServerValue"in e?(Fr("REQUEST_TIME"===e.setToServerValue),i=new Ps):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],i=new Us(n)):"removeAllFromArray"in e?(r=e.removeAllFromArray.values||[],i=new js(r)):"increment"in e?i=new Hs(t,e.increment):Mr();var o=Wr.S(e.fieldPath);return new Xs(o,i)}(t,e)}));return Fr(!0===i.exists),new vu(c,h)}if(e.verify){var f=ys(t,e.verify);return new Iu(f,i)}return Mr()}function _s(t,e){return{documents:[gs(t,e.path)]}}function As(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=gs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=gs(t,r.h()),n.structuredQuery.from=[{collectionId:r._()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){if("=="===t.op){if(ns(t.value))return{unaryFilter:{field:Ds(t.field),op:"IS_NAN"}};if(es(t.value))return{unaryFilter:{field:Ds(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ns(t.value))return{unaryFilter:{field:Ds(t.field),op:"IS_NOT_NAN"}};if(es(t.value))return{unaryFilter:{field:Ds(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ds(t.field),op:(e=t.op,os[e]),value:t.value}};var e}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return{field:Ds((e=t).field),direction:(n=e.dir,is[n])};var e,n}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u=(s=e.limit,t.Ue||Gi(s)?s:{value:s});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Ns(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ns(e.endAt)),n}function Ns(t){return{before:t.before,values:t.position}}function Ss(t){var e=!!t.before,n=t.values||[];return new Ta(n,e)}function Ds(t){return{fieldPath:t.R()}}function xs(t){return Wr.S(t.fieldPath)}function Os(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Rs(){this.ze=void 0}function ks(t,e){return t instanceof Hs?Zo(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var Ls,Cs,Ps=(s(Ms,Cs=Rs),Ms),Us=(s(Vs,Ls=Rs),Vs);function Vs(t){var e=this;return(e=Ls.call(this)||this).elements=t,e}function Ms(){return null!==Cs&&Cs.apply(this,arguments)||this}function Fs(t,e){for(var n=Ws(e),r=0,i=t.elements;r<i.length;r++)!function(t){n.some((function(e){return zo(e,t)}))||n.push(t)}(i[r]);return{arrayValue:{values:n}}}var qs,js=(s(Gs,qs=Rs),Gs);function Gs(t){var e=this;return(e=qs.call(this)||this).elements=t,e}function Bs(t,e){for(var n=Ws(e),r=0,i=t.elements;r<i.length;r++)!function(t){n=n.filter((function(e){return!zo(e,t)}))}(i[r]);return{arrayValue:{values:n}}}var zs,Hs=(s(Qs,zs=Rs),Qs);function Qs(t,e){var n=this;return(n=zs.call(this)||this).serializer=t,n.We=e,n}function Ks(t){return Xo(t.integerValue||t.doubleValue)}function Ws(t){return ts(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ys=($s.prototype.He=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].T(t))return!0;return!1},$s.prototype.isEqual=function(t){return Ei(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},$s),Xs=function(t,e){this.field=t,this.transform=e};function $s(t){(this.fields=t).sort(Wr.i)}function Js(t,e){this.version=t,this.transformResults=e}var Zs=(tu.Ge=function(){return new tu},tu.exists=function(t){return new tu(void 0,t)},tu.updateTime=function(t){return new tu(t)},Object.defineProperty(tu.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),tu.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},tu);function tu(t,e){this.updateTime=t,this.exists=e}function eu(t,e){return void 0!==t.updateTime?e instanceof ku&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof ku}function nu(){}function ru(t,e,n){return t instanceof cu?new ku(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof hu?function(t,e,n){if(!eu(t.Ke,e))return new Cu(t.key,n.version);var r=pu(t,e);return new ku(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof vu?function(t,e,n){if(Fr(null!=n.transformResults),!eu(t.Ke,e))return new Cu(t.key,n.version);var r=e,i=function(t,e,n){var r=[];Fr(t.length===n.length);for(var i,o,s,u=0;u<n.length;u++){var a=t[u],c=a.transform,h=null;e instanceof ku&&(h=e.field(a.field)),r.push((i=c,o=h,s=n[u],i instanceof Us?Fs(i,o):i instanceof js?Bs(i,o):s))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=gu(t,r.data(),i);return new ku(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):new Lu(t.key,n.version,{hasCommittedMutations:!0})}function iu(t,e,n,r){return t instanceof cu?function(t,e){if(!eu(t.Ke,e))return e;var n=su(e);return new ku(t.key,n,t.value,{Ye:!0})}(t,e):t instanceof hu?function(t,e){if(!eu(t.Ke,e))return e;var n=su(e),r=pu(t,e);return new ku(t.key,n,r,{Ye:!0})}(t,e):t instanceof vu?function(t,e,n,r){if(!eu(t.Ke,e))return e;var i=e,o=function(t,e,n,r){for(var i,o,s,u,a,c,h,f=[],l=0,p=t;l<p.length;l++){var d=p[l],v=d.transform,y=null;n instanceof ku&&(y=n.field(d.field)),null===y&&r instanceof ku&&(y=r.field(d.field)),f.push((o=y,s=e,h=c=a=u=void 0,(i=v)instanceof Ps?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}},o&&(h.fields.__previous_value__=o),{mapValue:h}):i instanceof Us?Fs(i,o):i instanceof js?Bs(i,o):(c=Ks(a=ks(u=i,o))+Ks(u.We),Zo(a)&&Zo(u.We)?us(c):as(u.serializer,c))))}return f}(t.fieldTransforms,n,e,r),s=gu(t,i.data(),o);return new ku(t.key,i.version,s,{Ye:!0})}(t,e,r,n):(o=e,eu((i=t).Ke,o)?new Lu(i.key,Ui.min()):o);var i,o}function ou(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ke.isEqual(e.Ke)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||Ei(t.fieldTransforms,t.fieldTransforms,(function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof Us&&o instanceof Us||i instanceof js&&o instanceof js?Ei(i.elements,o.elements,zo):i instanceof Hs&&o instanceof Hs?zo(i.We,o.We):i instanceof Ps&&o instanceof Ps);var n,r,i,o})))}function su(t){return t instanceof ku?t.version:Ui.min()}var uu,au,cu=(s(lu,au=nu),lu),hu=(s(fu,uu=nu),fu);function fu(t,e,n,r){var i=this;return(i=uu.call(this)||this).key=t,i.data=e,i.Qe=n,i.Ke=r,i.type=1,i}function lu(t,e,n){var r=this;return(r=au.call(this)||this).key=t,r.value=e,r.Ke=n,r.type=0,r}function pu(t,e){return n=t,r=e instanceof ku?e.data():Eu.empty(),i=new Tu(r),n.Qe.fields.forEach((function(t){var e;t.m()||(null!==(e=n.data.field(t))?i.set(t,e):i.delete(t))})),i.Je();var n,r,i}var du,vu=(s(yu,du=nu),yu);function yu(t,e){var n=this;return(n=du.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ke=Zs.exists(!0),n}function gu(t,e,n){for(var r=new Tu(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Je()}var mu,wu,bu=(s(Su,wu=nu),Su),Iu=(s(Nu,mu=nu),Nu),Eu=(Au.empty=function(){return new Au({mapValue:{}})},Au.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!rs(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t._()])||null},Au.prototype.isEqual=function(t){return zo(this.proto,t.proto)},Au),Tu=(_u.prototype.set=function(t,e){return this.tn(t,e),this},_u.prototype.delete=function(t){return this.tn(t,null),this},_u.prototype.tn=function(t,e){for(var n=this.Ze,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);n=(o instanceof Map||(o=o&&10===Bo(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o)}n.set(t._(),e)},_u.prototype.Je=function(){var t=this.en(Wr.g(),this.Ze);return null!=t?new Eu(t):this.Xe},_u.prototype.en=function(t,e){var n=this,r=!1,i=this.Xe.field(t),o=rs(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){var s;e instanceof Map?null!=(s=n.en(t.child(i),e))&&(o[i]=s,r=!0):null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},_u);function _u(t){void 0===t&&(t=Eu.empty()),this.Xe=t,this.Ze=new Map}function Au(t){this.proto=t}function Nu(t,e){var n=this;return(n=mu.call(this)||this).key=t,n.Ke=e,n.type=4,n}function Su(t,e){var n=this;return(n=wu.call(this)||this).key=t,n.Ke=e,n.type=3,n}function Du(t,e){this.key=t,this.version=e}var xu,Ou,Ru,ku=(s(Mu,Ru=Du),Mu.prototype.field=function(t){return this.nn.field(t)},Mu.prototype.data=function(){return this.nn},Mu.prototype.sn=function(){return this.nn.proto},Mu.prototype.isEqual=function(t){return t instanceof Mu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.nn.isEqual(t.nn)},Mu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.nn.toString()+", {hasLocalMutations: "+this.Ye+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Mu.prototype,"hasPendingWrites",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Mu),Lu=(s(Vu,Ou=Du),Vu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Vu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Vu.prototype.isEqual=function(t){return t instanceof Vu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Vu),Cu=(s(Uu,xu=Du),Uu.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Uu.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Uu.prototype.isEqual=function(t){return t instanceof Uu&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Uu),Pu=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.rn=n,this.filters=r,this.limit=i,this.on=o,this.startAt=s,this.endAt=u,this.an=null,this.cn=null,this.startAt,this.endAt};function Uu(){return null!==xu&&xu.apply(this,arguments)||this}function Vu(t,e,n){var r=this;return(r=Ou.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Mu(t,e,n,r){var i=this;return(i=Ru.call(this,t,e)||this).nn=n,i.Ye=!!r.Ye,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Fu(t,e,n,r,i,o,s,u){return new Pu(t,e,n,r,i,o,s,u)}function qu(t){return new Pu(t)}function ju(t){return!Gi(t.limit)&&"F"===t.on}function Gu(t){return!Gi(t.limit)&&"L"===t.on}function Bu(t){return 0<t.rn.length?t.rn[0].field:null}function zu(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function Hu(t){return null!==t.collectionGroup}function Qu(t){var e=t;if(null===e.an){e.an=[];var n=zu(e),r=Bu(e);if(null!==n&&null===r)n.p()||e.an.push(new Ra(n)),e.an.push(new Ra(Wr.v(),"asc"));else{for(var i,o=!1,s=0,u=e.rn;s<u.length;s++){var a=u[s];e.an.push(a),a.field.p()&&(o=!0)}o||(i=0<e.rn.length?e.rn[e.rn.length-1].dir:"asc",e.an.push(new Ra(Wr.v(),i)))}}return e.an}function Ku(t){var e=t;if(!e.cn)if("F"===e.on)e.cn=Qi(e.path,e.collectionGroup,Qu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Qu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Ra(o.field,s))}var u=e.endAt?new Ta(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Ta(e.startAt.position,!e.startAt.before):null;e.cn=Qi(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.cn}function Wu(t,e,n){return new Pu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Yu(t,e){return new Pu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,e,t.endAt)}function Xu(t,e){return new Pu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,e)}function $u(t,e){return Wi(Ku(t),Ku(e))&&t.on===e.on}function Ju(t){return Ki(Ku(t))+"|lt:"+t.on}function Zu(t){return"Query(target="+(n=(e=Ku(t)).path.R(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map((function(t){return(e=t).field.R()+" "+e.op+" "+Wo(e.value);var e})).join(", ")+"]"),Gi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map((function(t){return(e=t).field.R()+" ("+e.dir+")";var e})).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Da(e.startAt)),e.endAt&&(n+=", endAt: "+Da(e.endAt)),"Target("+n+"); limitType=")+t.on+")";var e,n}function ta(t,e){return i=t,o=e.key.path,(null!==i.collectionGroup?e.key.N(i.collectionGroup)&&i.path.T(o):Yr.F(i.path)?i.path.isEqual(o):i.path.I(o))&&function(e){for(var n=0,r=t.rn;n<r.length;n++){var i=r[n];if(!i.field.p()&&null===e.field(i.field))return}return 1}(e)&&function(e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return;return 1}(e)&&(r=e,(!(n=t).startAt||xa(n.startAt,Qu(n),r))&&(!n.endAt||!xa(n.endAt,Qu(n),r)));var n,r,i,o}function ea(t){return function(e,n){for(var r=!1,i=0,o=Qu(t);i<o.length;i++){var s=o[i],u=function(t,e,n){var r=t.field.p()?Yr.i(e.key,n.key):function(t,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?Qo(r,i):Mr()}(t.field,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Mr()}}(s,e,n);if(0!==u)return u;r=r||s.field.p()}return 0}}var na,ra=(s(ia,na=function(){}),ia.create=function(t,e,n){if(t.p())return"in"===e||"not-in"===e?this.hn(t,e,n):new aa(t,e,n);if(es(n)){if("=="!==e&&"!="!==e)throw new Or(xr.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new ia(t,e,n)}if(ns(n)){if("=="!==e&&"!="!==e)throw new Or(xr.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new ia(t,e,n)}return"array-contains"===e?new wa(t,n):"in"===e?new ba(t,n):"not-in"===e?new Ia(t,n):"array-contains-any"===e?new Ea(t,n):new ia(t,e,n)},ia.hn=function(t,e,n){return new("in"===e?ca:ha)(t,n)},ia.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.ln(Qo(e,this.value)):null!==e&&Bo(this.value)===Bo(e)&&this.ln(Qo(e,this.value))},ia.prototype.ln=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Mr()}},ia.prototype.un=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},ia);function ia(t,e,n){var r=this;return(r=na.call(this)||this).field=t,r.op=e,r.value=n,r}var oa,sa,ua,aa=(s(pa,ua=ra),pa.prototype.matches=function(t){var e=Yr.i(t.key,this.key);return this.ln(e)},pa),ca=(s(la,sa=ra),la.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},la),ha=(s(fa,oa=ra),fa.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},fa);function fa(t,e){var n=this;return(n=oa.call(this,t,"not-in",e)||this).keys=da(0,e),n}function la(t,e){var n=this;return(n=sa.call(this,t,"in",e)||this).keys=da(0,e),n}function pa(t,e,n){var r=this;return(r=ua.call(this,t,e,n)||this).key=Yr.C(n.referenceValue),r}function da(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Yr.C(t.referenceValue)}))}var va,ya,ga,ma,wa=(s(Sa,ma=ra),Sa.prototype.matches=function(t){var e=t.field(this.field);return ts(e)&&Ho(e.arrayValue,this.value)},Sa),ba=(s(Na,ga=ra),Na.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Ho(this.value.arrayValue,e)},Na),Ia=(s(Aa,ya=ra),Aa.prototype.matches=function(t){if(Ho(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!Ho(this.value.arrayValue,e)},Aa),Ea=(s(_a,va=ra),_a.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!ts(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Ho(e.value.arrayValue,t)}))},_a),Ta=function(t,e){this.position=t,this.before=e};function _a(t,e){return va.call(this,t,"array-contains-any",e)||this}function Aa(t,e){return ya.call(this,t,"not-in",e)||this}function Na(t,e){return ga.call(this,t,"in",e)||this}function Sa(t,e){return ma.call(this,t,"array-contains",e)||this}function Da(t){return(t.before?"b":"a")+":"+t.position.map(Wo).join(",")}function xa(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];r=o.field.p()?Yr.i(Yr.C(s.referenceValue),n.key):Qo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Oa(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!zo(t.position[n],e.position[n]))return!1;return!0}var Ra=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function ka(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}var La,Ca=(Ba.prototype.reset=function(){this.Tn=0},Ba.prototype.An=function(){this.Tn=this.mn},Ba.prototype.Rn=function(t){var e=this;this.cancel();var n=Math.floor(this.Tn+this.Pn()),r=Math.max(0,Date.now()-this.In),i=Math.max(0,n-r);0<i&&Cr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Tn+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.En=this._n.gn(this.fn,i,(function(){return e.In=Date.now(),t()})),this.Tn*=this.wn,this.Tn<this.dn&&(this.Tn=this.dn),this.Tn>this.mn&&(this.Tn=this.mn)},Ba.prototype.yn=function(){null!==this.En&&(this.En.Vn(),this.En=null)},Ba.prototype.cancel=function(){null!==this.En&&(this.En.cancel(),this.En=null)},Ba.prototype.Pn=function(){return(Math.random()-.5)*this.Tn},Ba),Pa=(Ga.prototype.catch=function(t){return this.next(void 0,t)},Ga.prototype.next=function(t,e){var n=this;return this.Sn&&Mr(),this.Sn=!0,this.vn?this.error?this.Dn(e,this.error):this.Cn(t,this.result):new Ga((function(r,i){n.pn=function(e){n.Cn(t,e).next(r,i)},n.bn=function(t){n.Dn(e,t).next(r,i)}}))},Ga.prototype.Nn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},Ga.prototype.Fn=function(t){try{var e=t();return e instanceof Ga?e:Ga.resolve(e)}catch(t){return Ga.reject(t)}},Ga.prototype.Cn=function(t,e){return t?this.Fn((function(){return t(e)})):Ga.resolve(e)},Ga.prototype.Dn=function(t,e){return t?this.Fn((function(){return t(e)})):Ga.reject(e)},Ga.resolve=function(t){return new Ga((function(e,n){e(t)}))},Ga.reject=function(t){return new Ga((function(e,n){n(t)}))},Ga.$n=function(t){return new Ga((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},Ga.xn=function(t){for(var e=Ga.resolve(!1),n=0,r=t;n<r.length;n++)!function(t){e=e.next((function(e){return e?Ga.resolve(e):t()}))}(r[n]);return e},Ga.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.$n(r)},Ga),Ua=(ja.delete=function(t){return Cr("SimpleDb","Removing database:",t),Ya(window.indexedDB.deleteDatabase(t)).Nn()},ja.On=function(){if("undefined"==typeof indexedDB)return!1;if(ja.Ln())return!0;var t=g(),e=ja.Mn(t),n=0<e&&e<10,r=ja.Bn(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},ja.Ln=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.qn)},ja.Un=function(t,e){return t.store(e)},ja.Mn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},ja.Bn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},ja.prototype.Qn=function(){return u(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:return this.db?[3,2]:(Cr("SimpleDb","Opening database:",this.name),t=this,[4,new Promise((function(t,n){var r=indexedDB.open(e.name,e.version);r.onsuccess=function(e){var n=e.target.result;t(n)},r.onblocked=function(){n(new Ma("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){var e=t.target.error;"VersionError"===e.name?n(new Or(xr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new Ma(e))},r.onupgradeneeded=function(t){Cr("SimpleDb",'Database "'+e.name+'" requires upgrade from version:',t.oldVersion);var n=t.target.result;e.kn.createOrUpgrade(n,r.transaction,t.oldVersion,e.version).next((function(){Cr("SimpleDb","Database upgrade to version "+e.version+" complete")}))}}))]);case 1:t.db=n.sent(),n.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return e.Wn(t)}),this.db)]}}))}))},ja.prototype.jn=function(t){this.Wn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},ja.prototype.runTransaction=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,u;return a(this,(function(c){switch(c.label){case 0:r="readonly"===t,i=0,o=function(){var t,o,u,c,h;return a(this,(function(a){switch(a.label){case 0:++i,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,s.Qn()];case 2:return s.db=a.sent(),t=Ha.open(s.db,r?"readonly":"readwrite",e),o=n(t).catch((function(e){return t.abort(e),Pa.reject(e)})).Nn(),u={},o.catch((function(){})),[4,t.Kn];case 3:return[2,(u.value=(a.sent(),o),u)];case 4:return c=a.sent(),h="FirebaseError"!==c.name&&i<3,Cr("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),s.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},s=this,c.label=1;case 1:return[5,o()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},ja.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},ja),Va=(Object.defineProperty(qa.prototype,"vn",{get:function(){return this.zn},enumerable:!1,configurable:!0}),Object.defineProperty(qa.prototype,"Yn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(qa.prototype,"cursor",{set:function(t){this.Gn=t},enumerable:!1,configurable:!0}),qa.prototype.done=function(){this.zn=!0},qa.prototype.Jn=function(t){this.Hn=t},qa.prototype.delete=function(){return Ya(this.Gn.delete())},qa),Ma=(s(Fa,La=Or),Fa);function Fa(t){var e=this;return(e=La.call(this,xr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function qa(t){this.Gn=t,this.zn=!1,this.Hn=null}function ja(t,e,n){this.name=t,this.version=e,this.kn=n,12.2===ja.Mn(g())&&Pr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Ga(t){var e=this;this.pn=null,this.bn=null,this.result=void 0,this.error=void 0,this.vn=!1,this.Sn=!1,t((function(t){e.vn=!0,e.result=t,e.pn&&e.pn(t)}),(function(t){e.vn=!0,e.error=t,e.bn&&e.bn(t)}))}function Ba(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this._n=t,this.fn=e,this.dn=n,this.wn=r,this.mn=i,this.Tn=0,this.En=null,this.In=Date.now(),this.reset()}function za(t){return"IndexedDbTransactionError"===t.name}var Ha=(Wa.open=function(t,e,n){try{return new Wa(t.transaction(n,e))}catch(t){throw new Ma(t)}},Object.defineProperty(Wa.prototype,"Kn",{get:function(){return this.Xn.promise},enumerable:!1,configurable:!0}),Wa.prototype.abort=function(t){t&&this.Xn.reject(t),this.aborted||(Cr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Wa.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Qa(e)},Wa),Qa=(Ka.prototype.put=function(t,e){return Ya(void 0!==e?(Cr("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Cr("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Ka.prototype.add=function(t){return Cr("SimpleDb","ADD",this.store.name,t,t),Ya(this.store.add(t))},Ka.prototype.get=function(t){var e=this;return Ya(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Cr("SimpleDb","GET",e.store.name,t,n),n}))},Ka.prototype.delete=function(t){return Cr("SimpleDb","DELETE",this.store.name,t),Ya(this.store.delete(t))},Ka.prototype.count=function(){return Cr("SimpleDb","COUNT",this.store.name),Ya(this.store.count())},Ka.prototype.Zn=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ts(n,(function(t,e){r.push(e)})).next((function(){return r}))},Ka.prototype.es=function(t,e){Cr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ns=!1;var r=this.cursor(n);return this.ts(r,(function(t,e,n){return n.delete()}))},Ka.prototype.ss=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ts(r,e)},Ka.prototype.rs=function(t){var e=this.cursor({});return new Pa((function(n,r){e.onerror=function(t){var e=$a(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Ka.prototype.ts=function(t,e){var n=[];return new Pa((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i,o,s,u=t.target.result;u?(i=new Va(u),(o=e(u.primaryKey,u.value,i))instanceof Pa&&(s=o.catch((function(t){return i.done(),Pa.reject(t)})),n.push(s)),i.vn?r():null===i.Yn?u.continue():u.continue(i.Yn)):r()}})).next((function(){return Pa.$n(n)}))},Ka.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Ka.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Ka);function Ka(t){this.store=t}function Wa(t){var e=this;this.transaction=t,this.aborted=!1,this.Xn=new ka,this.transaction.oncomplete=function(){e.Xn.resolve()},this.transaction.onabort=function(){t.error?e.Xn.reject(new Ma(t.error)):e.Xn.resolve()},this.transaction.onerror=function(t){var n=$a(t.target.error);e.Xn.reject(new Ma(n))}}function Ya(t){return new Pa((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=$a(t.target.error);n(e)}}))}var Xa=!1;function $a(t){var e=Ua.Mn(g());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Or("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Xa||(Xa=!0,setTimeout((function(){throw r}),0)),r}}return t}function Ja(){return"undefined"!=typeof window?window:null}function Za(){return"undefined"!=typeof document?document:null}var tc=(rc.ls=function(t,e,n,r,i){var o=new rc(t,e,Date.now()+n,r,i);return o.start(n),o},rc.prototype.start=function(t){var e=this;this._s=setTimeout((function(){return e.fs()}),t)},rc.prototype.Vn=function(){return this.fs()},rc.prototype.cancel=function(t){null!==this._s&&(this.clearTimeout(),this.hs.reject(new Or(xr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},rc.prototype.fs=function(){var t=this;this.os.ds((function(){return null!==t._s?(t.clearTimeout(),t.op().then((function(e){return t.hs.resolve(e)}))):Promise.resolve()}))},rc.prototype.clearTimeout=function(){null!==this._s&&(this.us(this),clearTimeout(this._s),this._s=null)},rc),ec=(Object.defineProperty(nc.prototype,"Vs",{get:function(){return this.Es},enumerable:!1,configurable:!0}),nc.prototype.ds=function(t){this.enqueue(t)},nc.prototype.ps=function(t){this.bs(),this.vs(t)},nc.prototype.Ss=function(){var t;this.Es||(this.Es=!0,(t=Za())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ys))},nc.prototype.enqueue=function(t){return this.bs(),this.Es?new Promise((function(t){})):this.vs(t)},nc.prototype.Ds=function(t){var e=this;this.Ts.push(t),this.ds((function(){return e.Cs()}))},nc.prototype.Cs=function(){return u(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:if(0===this.Ts.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return n.sent(),this.Ts.shift(),this.gs.reset(),[3,4];case 3:if(!za(t=n.sent()))throw t;return Cr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:0<this.Ts.length&&this.gs.Rn((function(){return e.Cs()})),n.label=5;case 5:return[2]}}))}))},nc.prototype.vs=function(t){var e=this,n=this.ws.then((function(){return e.Rs=!0,t().catch((function(t){throw e.As=t,e.Rs=!1,Pr("INTERNAL UNHANDLED ERROR: ",(r=(n=t).message||"",n.stack&&(r=n.stack.includes(n.message)?n.stack:n.message+"\n"+n.stack),r)),t;var n,r})).then((function(t){return e.Rs=!1,t}))}));return this.ws=n},nc.prototype.gn=function(t,e,n){var r=this;this.bs(),-1<this.Ps.indexOf(t)&&(e=0);var i=tc.ls(this,t,e,n,(function(t){return r.Ns(t)}));return this.Is.push(i),i},nc.prototype.bs=function(){this.As&&Mr()},nc.prototype.Fs=function(){},nc.prototype.$s=function(){return u(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,t=this.ws];case 1:e.sent(),e.label=2;case 2:if(t!==this.ws)return[3,0];e.label=3;case 3:return[2]}}))}))},nc.prototype.xs=function(t){for(var e=0,n=this.Is;e<n.length;e++)if(n[e].fn===t)return!0;return!1},nc.prototype.ks=function(t){var e=this;return this.$s().then((function(){e.Is.sort((function(t,e){return t.cs-e.cs}));for(var n=0,r=e.Is;n<r.length;n++){var i=r[n];if(i.Vn(),"all"!==t&&i.fn===t)break}return e.$s()}))},nc.prototype.Ms=function(t){this.Ps.push(t)},nc.prototype.Ns=function(t){var e=this.Is.indexOf(t);this.Is.splice(e,1)},nc);function nc(){var t=this;this.ws=Promise.resolve(),this.Ts=[],this.Es=!1,this.Is=[],this.As=null,this.Rs=!1,this.Ps=[],this.gs=new Ca(this,"async_queue_retry"),this.ys=function(){var e=Za();e&&Cr("AsyncQueue","Visibility state changed to  ",e.visibilityState),t.gs.yn()};var e=Za();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ys)}function rc(t,e,n,r,i){this.os=t,this.fn=e,this.cs=n,this.op=r,this.us=i,this.hs=new ka,this.then=this.hs.promise.then.bind(this.hs.promise),this.hs.promise.catch((function(t){}))}function ic(t,e){if(Pr("AsyncQueue",e+": "+t),za(t))return new Or(xr.UNAVAILABLE,e+": "+t);throw t}function oc(){this.Os=void 0,this.listeners=[]}function sc(){this.Ls=new Ci(Ju,$u),this.onlineState="Unknown",this.Bs=new Set}function uc(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:if(n=t,r=e.query,i=!1,(o=n.Ls.get(r))||(i=!0,o=new oc),!i)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),s=o,[4,n.qs(r)];case 2:return s.Os=a.sent(),[3,4];case 3:return u=a.sent(),c=ic(u,"Initialization of query '"+Zu(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.Ls.set(r,o),o.listeners.push(e),e.Us(n.onlineState),o.Os&&e.Qs(o.Os)&&cc(n),[2]}}))}))}function ac(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(u){return n=t,r=e.query,i=!1,(o=n.Ls.get(r))&&0<=(s=o.listeners.indexOf(e))&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.Ls.delete(r),n.Ws(r))]:[2]}))}))}function cc(t){t.Bs.forEach((function(t){t.next()}))}var hc=(pc.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new To(t.query,t.docs,t.Ut,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Ks?this.zs(t)&&(this.js.next(t),o=!0):this.Hs(t,this.onlineState)&&(this.Ys(t),o=!0),this.Gs=t,o},pc.prototype.onError=function(t){this.js.error(t)},pc.prototype.Us=function(t){this.onlineState=t;var e=!1;return this.Gs&&!this.Ks&&this.Hs(this.Gs,t)&&(this.Ys(this.Gs),e=!0),e},pc.prototype.Hs=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Js&&n||t.docs.m()&&"Offline"!==e)},pc.prototype.zs=function(t){if(0<t.docChanges.length)return!0;var e=this.Gs&&this.Gs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},pc.prototype.Ys=function(t){t=To.Kt(t.query,t.docs,t.Qt,t.fromCache),this.Ks=!0,this.js.next(t)},pc),fc=(lc.prototype.Xs=function(){return null!=this.uid},lc.prototype.Zs=function(){return this.Xs()?"uid:"+this.uid:"anonymous-user"},lc.prototype.isEqual=function(t){return t.uid===this.uid},lc);function lc(t){this.uid=t}function pc(t,e,n){this.query=t,this.js=e,this.Ks=!1,this.Gs=null,this.onlineState="Unknown",this.options=n||{}}fc.UNAUTHENTICATED=new fc(null),fc.ti=new fc("google-credentials-uid"),fc.ei=new fc("first-party-uid");var dc=(vc.prototype.si=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},vc.prototype.next=function(){var t=++this.previousValue;return this.ii&&this.ii(t),t},vc);function vc(t,e){var n=this;this.previousValue=t,e&&(e.ni=function(t){return n.si(t)},this.ii=function(t){return e.ri(t)})}function yc(t,e){return"firestore_clients_"+t+"_"+e}function gc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Xs()&&(r+="_"+e.uid),r}function mc(t,e){return"firestore_targets_"+t+"_"+e}dc.oi=-1;var wc=(Hc.ai=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Or(r.error.code,r.error.message)),i?new Hc(t,e,r.state,o):(Pr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Hc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Hc),bc=(zc.ai=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Or(n.error.code,n.error.message)),r?new zc(t,n.state,i):(Pr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},zc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},zc),Ic=(Bc.ai=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=bo,o=0;r&&o<n.activeTargetIds.length;++o)r=zi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Bc(t,i):(Pr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Bc),Ec=(Gc.ai=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Gc(e.clientId,e.onlineState):(Pr("SharedClientState","Failed to parse online state: "+t),null)},Gc),Tc=(jc.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},jc.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},jc.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},jc),_c=(qc.On=function(t){return!(!t||!t.localStorage)},qc.prototype.start=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,u,c,h,f,l=this;return a(this,(function(a){switch(a.label){case 0:return[4,this._i.Vi()];case 1:for(t=a.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.li&&(i=this.getItem(yc(this.persistenceKey,r)))&&(o=Ic.ai(r,i))&&(this.mi=this.mi.rt(o.clientId,o));for(this.pi(),(s=this.storage.getItem(this.yi))&&(u=this.bi(s))&&this.vi(u),c=0,h=this.Ei;c<h.length;c++)f=h[c],this.wi(f);return this.Ei=[],this.window.addEventListener("unload",(function(){return l.Si()})),this.Ti=!0,[2]}}))}))},qc.prototype.ri=function(t){this.setItem(this.Ai,JSON.stringify(t))},qc.prototype.Di=function(){return this.Ci(this.mi)},qc.prototype.Ni=function(t){var e=!1;return this.mi.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},qc.prototype.Fi=function(t){this.$i(t,"pending")},qc.prototype.xi=function(t,e,n){this.$i(t,e,n),this.ki(t)},qc.prototype.Mi=function(t){var e,n,r="not-current";return this.Ni(t)&&(!(e=this.storage.getItem(mc(this.persistenceKey,t)))||(n=bc.ai(t,e))&&(r=n.state)),this.Oi.ui(t),this.pi(),r},qc.prototype.Li=function(t){this.Oi.hi(t),this.pi()},qc.prototype.Bi=function(t){return this.Oi.activeTargetIds.has(t)},qc.prototype.qi=function(t){this.removeItem(mc(this.persistenceKey,t))},qc.prototype.Ui=function(t,e,n){this.Qi(t,e,n)},qc.prototype.Wi=function(t,e,n){var r=this;e.forEach((function(t){r.ki(t)})),this.currentUser=t,n.forEach((function(t){r.Fi(t)}))},qc.prototype.ji=function(t){this.Ki(t)},qc.prototype.Si=function(){this.Ti&&(this.window.removeEventListener("storage",this.di),this.removeItem(this.Ii),this.Ti=!1)},qc.prototype.getItem=function(t){var e=this.storage.getItem(t);return Cr("SharedClientState","READ",t,e),e},qc.prototype.setItem=function(t,e){Cr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},qc.prototype.removeItem=function(t){Cr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},qc.prototype.wi=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Cr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ii)return void Pr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this._n.Ds((function(){return u(e,void 0,void 0,(function(){var t,e,r,i,o,s;return a(this,(function(u){if(this.Ti){if(null!==n.key)if(this.Ri.test(n.key)){if(null==n.newValue)return t=this.Gi(n.key),[2,this.zi(t,null)];if(e=this.Hi(n.key,n.newValue))return[2,this.zi(e.clientId,e)]}else if(this.Pi.test(n.key)){if(null!==n.newValue&&(r=this.Yi(n.key,n.newValue)))return[2,this.Ji(r)]}else if(this.gi.test(n.key)){if(null!==n.newValue&&(i=this.Xi(n.key,n.newValue)))return[2,this.Zi(i)]}else if(n.key===this.yi){if(null!==n.newValue&&(o=this.bi(n.newValue)))return[2,this.vi(o)]}else n.key===this.Ai&&(s=function(t){var e=dc.oi;if(null!=t)try{var n=JSON.parse(t);Fr("number"==typeof n),e=n}catch(t){Pr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==dc.oi&&this.ni(s)}else this.Ei.push(n);return[2]}))}))}))}},Object.defineProperty(qc.prototype,"Oi",{get:function(){return this.mi.get(this.li)},enumerable:!1,configurable:!0}),qc.prototype.pi=function(){this.setItem(this.Ii,this.Oi.ci())},qc.prototype.$i=function(t,e,n){var r=new wc(this.currentUser,t,e,n),i=gc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ci())},qc.prototype.ki=function(t){var e=gc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},qc.prototype.Ki=function(t){var e={clientId:this.li,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(e))},qc.prototype.Qi=function(t,e,n){var r=mc(this.persistenceKey,t),i=new bc(t,e,n);this.setItem(r,i.ci())},qc.prototype.Gi=function(t){var e=this.Ri.exec(t);return e?e[1]:null},qc.prototype.Hi=function(t,e){var n=this.Gi(t);return Ic.ai(n,e)},qc.prototype.Yi=function(t,e){var n=this.Pi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return wc.ai(new fc(i),r,e)},qc.prototype.Xi=function(t,e){var n=this.gi.exec(t),r=Number(n[1]);return bc.ai(r,e)},qc.prototype.bi=function(t){return Ec.ai(t)},qc.prototype.Ji=function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this._i.tr(t.batchId,t.state,t.error)]:(Cr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},qc.prototype.Zi=function(t){return this._i.er(t.targetId,t.state,t.error)},qc.prototype.zi=function(t,e){var n=this,r=e?this.mi.rt(t,e):this.mi.remove(t),i=this.Ci(this.mi),o=this.Ci(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this._i.nr(s,u).then((function(){n.mi=r}))},qc.prototype.vi=function(t){this.mi.get(t.clientId)&&this.fi(t.onlineState)},qc.prototype.Ci=function(t){var e=bo;return t.forEach((function(t,n){e=e.xt(n.activeTargetIds)})),e},qc),Ac=(Fc.prototype.Fi=function(t){},Fc.prototype.xi=function(t,e,n){},Fc.prototype.Mi=function(t){return this.sr.ui(t),this.ir[t]||"not-current"},Fc.prototype.Ui=function(t,e,n){this.ir[t]=e},Fc.prototype.Li=function(t){this.sr.hi(t)},Fc.prototype.Bi=function(t){return this.sr.activeTargetIds.has(t)},Fc.prototype.qi=function(t){delete this.ir[t]},Fc.prototype.Di=function(){return this.sr.activeTargetIds},Fc.prototype.Ni=function(t){return this.sr.activeTargetIds.has(t)},Fc.prototype.start=function(){return this.sr=new Tc,Promise.resolve()},Fc.prototype.Wi=function(t,e,n){},Fc.prototype.ji=function(t){},Fc.prototype.Si=function(){},Fc.prototype.ri=function(t){},Fc),Nc=(Mc.prototype.ar=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=ru(o,e,r[i]))}return e},Mc.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=iu(i,e,e,this.rr))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=iu(a,e,o,this.rr))}return e},Mc.prototype.hr=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.ur(r.key,t.get(r.key));i&&(n=n.rt(r.key,i))})),n},Mc.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),wo())},Mc.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ei(this.mutations,t.mutations,ou)&&Ei(this.baseMutations,t.baseMutations,ou)},Mc),Sc=(Vc.from=function(t,e,n){Fr(t.mutations.length===n.length);for(var r=go,i=t.mutations,o=0;o<i.length;o++)r=r.rt(i[o].key,n[o].version);return new Vc(t,e,n,r)},Vc),Dc=(Object.defineProperty(Uc.prototype,"readTime",{get:function(){return this.mr},set:function(t){this.mr=t},enumerable:!1,configurable:!0}),Uc.prototype.Tr=function(t,e){this.Er(),this.readTime=e,this.dr.set(t.key,t)},Uc.prototype.Ir=function(t,e){this.Er(),e&&(this.readTime=e),this.dr.set(t,null)},Uc.prototype.Ar=function(t,e){this.Er();var n=this.dr.get(e);return void 0!==n?Pa.resolve(n):this.Rr(t,e)},Uc.prototype.getEntries=function(t,e){return this.Pr(t,e)},Uc.prototype.apply=function(t){return this.Er(),this.wr=!0,this.gr(t)},Uc.prototype.Er=function(){},Uc),xc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Oc=(Pc.prototype.Vr=function(t){this.yr.push(t)},Pc.prototype.pr=function(){this.yr.forEach((function(t){return t()}))},Pc),Rc=(Cc.prototype.Dr=function(t,e){var n=this;return this.vr.Cr(t,e).next((function(r){return n.Nr(t,e,r)}))},Cc.prototype.Nr=function(t,e,n){return this.br.Ar(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].ur(e,t);return t}))},Cc.prototype.Fr=function(t,e,n){var r=lo;return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].ur(t,e);r=r.rt(t,e)})),r},Cc.prototype.$r=function(t,e){var n=this;return this.br.getEntries(t,e).next((function(e){return n.kr(t,e)}))},Cc.prototype.kr=function(t,e){var n=this;return this.vr.Mr(t,e).next((function(r){var i=n.Fr(t,e,r),o=lo;return i.forEach((function(t,e){e=e||new Lu(t,Ui.min()),o=o.rt(t,e)})),o}))},Cc.prototype.Or=function(t,e,n){return r=e,Yr.F(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Lr(t,e.path):Hu(e)?this.Br(t,e,n):this.qr(t,e,n);var r},Cc.prototype.Lr=function(t,e){return this.Dr(t,new Yr(e)).next((function(t){var e=yo;return t instanceof ku&&(e=e.rt(t.key,t)),e}))},Cc.prototype.Br=function(t,e,n){var r=this,i=e.collectionGroup,o=yo;return this.Sr.Ur(t,i).next((function(s){return Pa.forEach(s,(function(s){var u,a,c=(u=e,a=s.child(i),new Pu(a,null,u.rn.slice(),u.filters.slice(),u.limit,u.on,u.startAt,u.endAt));return r.qr(t,c,n).next((function(t){t.forEach((function(t,e){o=o.rt(t,e)}))}))})).next((function(){return o}))}))},Cc.prototype.qr=function(t,e,n){var r,i,o=this;return this.br.Or(t,e,n).next((function(n){return r=n,o.vr.Qr(t,e)})).next((function(e){return i=e,o.Wr(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=iu(a,h,h,o.rr);r=f instanceof ku?r.rt(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){ta(e,n)||(r=r.remove(t))})),r}))},Cc.prototype.Wr=function(t,e,n){for(var r=wo(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof hu&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.br.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof ku&&(c=c.rt(t,e))})),c}))},Cc),kc=(Lc.Gr=function(t,e){for(var n=wo(),r=wo(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Lc(t,e.fromCache,n,r)},Lc);function Lc(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Kr=r}function Cc(t,e,n){this.br=t,this.vr=e,this.Sr=n}function Pc(){this.yr=[]}function Uc(){this.dr=new Ci((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.wr=!1}function Vc(t,e,n,r){this.batch=t,this.lr=e,this.cr=n,this._r=r}function Mc(t,e,n,r){this.batchId=t,this.rr=e,this.baseMutations=n,this.mutations=r}function Fc(){this.sr=new Tc,this.ir={},this.fi=null,this.ni=null}function qc(t,e,n,r,i){this.window=t,this._n=e,this.persistenceKey=n,this.li=r,this._i=null,this.fi=null,this.ni=null,this.di=this.wi.bind(this),this.mi=new ro(Ii),this.Ti=!1,this.Ei=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ii=yc(this.persistenceKey,this.li),this.Ai="firestore_sequence_number_"+this.persistenceKey,this.mi=this.mi.rt(this.li,new Tc),this.Ri=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Pi=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.gi=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.yi="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.di)}function jc(){this.activeTargetIds=bo}function Gc(t,e){this.clientId=t,this.onlineState=e}function Bc(t,e){this.clientId=t,this.activeTargetIds=e}function zc(t,e,n){this.targetId=t,this.state=e,this.error=n}function Hc(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Qc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Ii(n,i);return 0===s?Ii(r,o):s}var Kc=($c.prototype.Yr=function(){return++this.Hr},$c.prototype.Jr=function(t){var e,n=[t,this.Yr()];this.buffer.size<this.zr?this.buffer=this.buffer.add(n):Qc(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty($c.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),$c),Wc={Xr:!1,Zr:0,eo:0,no:0},Yc=(Xc.oo=function(t){return new Xc(t,Xc.ao,Xc.co)},Xc);function Xc(t,e,n){this.so=t,this.io=e,this.ro=n}function $c(t){this.zr=t,this.buffer=new ho(Qc),this.Hr=0}Yc.uo=-1,Yc.ho=1048576,Yc.lo=41943040,Yc.ao=10,Yc.co=1e3,Yc._o=new Yc(Yc.lo,Yc.ao,Yc.co),Yc.fo=new Yc(Yc.uo,0,0);var Jc=(eh.prototype.start=function(t){this.do.params.so!==Yc.uo&&this.To(t)},eh.prototype.stop=function(){this.mo&&(this.mo.cancel(),this.mo=null)},Object.defineProperty(eh.prototype,"Ti",{get:function(){return null!==this.mo},enumerable:!1,configurable:!0}),eh.prototype.To=function(t){var e=this,n=this.wo?3e5:6e4;Cr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.mo=this.os.gn("lru_garbage_collection",n,(function(){return u(e,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:this.mo=null,this.wo=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Eo(this.do)];case 2:return n.sent(),[3,7];case 3:return za(e=n.sent())?(Cr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Rf(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.To(t)];case 8:return n.sent(),[2]}}))}))}))},eh),Zc=(th.prototype.Ao=function(t,e){return this.Io.Ro(t).next((function(t){return Math.floor(e/100*t)}))},th.prototype.Po=function(t,e){var n=this;if(0===e)return Pa.resolve(dc.oi);var r=new Kc(e);return this.Io.De(t,(function(t){return r.Jr(t.sequenceNumber)})).next((function(){return n.Io.yo(t,(function(t){return r.Jr(t)}))})).next((function(){return r.maxValue}))},th.prototype.Vo=function(t,e,n){return this.Io.Vo(t,e,n)},th.prototype.po=function(t,e){return this.Io.po(t,e)},th.prototype.bo=function(t,e){var n=this;return this.params.so===Yc.uo?(Cr("LruGarbageCollector","Garbage collection skipped; disabled"),Pa.resolve(Wc)):this.vo(t).next((function(r){return r<n.params.so?(Cr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.so),Wc):n.So(t,e)}))},th.prototype.vo=function(t){return this.Io.vo(t)},th.prototype.So=function(t,e){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.Ao(t,this.params.io).next((function(e){return i=e>h.params.ro?(Cr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.ro+" from "+e),h.params.ro):e,s=Date.now(),h.Po(t,i)})).next((function(n){return r=n,u=Date.now(),h.Vo(t,r,e)})).next((function(e){return o=e,a=Date.now(),h.po(t,r)})).next((function(t){return c=Date.now(),Lr()<=n.DEBUG&&Cr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),Pa.resolve({Xr:!0,Zr:i,eo:o,no:t})}))},th);function th(t,e){this.Io=t,this.params=e}function eh(t,e){this.do=t,this.os=e,this.wo=!1,this.mo=null}function nh(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=rh(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}(t.get(n),e);return rh(e)}function rh(t){return t+""}function ih(t){var e=t.length;if(Fr(2<=e),2===e)return Fr(""===t.charAt(0)&&""===t.charAt(1)),Qr.g();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Mr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Mr()}o=s+2}return new Qr(r)}var oh=function(t){this.Do=t};function sh(t,e){if(e.document)return n=t.Do,r=e.document,i=!!e.hasCommittedMutations,o=ys(n,r.name),s=ls(r.updateTime),u=new Eu({mapValue:{fields:r.fields}}),new ku(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=Yr.$(e.noDocument.path),c=fh(e.noDocument.readTime);return new Lu(a,c,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var h=Yr.$(e.unknownDocument.path),f=fh(e.unknownDocument.version);return new Cu(h,f)}return Mr()}function uh(t,e,n){var r,i,o=ah(n),s=e.key.path.h().A();if(e instanceof ku){var u={name:vs(r=t.Do,(i=e).key),fields:i.sn().mapValue.fields,updateTime:hs(r,i.version.X())},a=e.hasCommittedMutations;return new zh(null,null,u,a,o,s)}if(e instanceof Lu){var c=e.key.path.A(),h=hh(e.version),f=e.hasCommittedMutations;return new zh(null,new Gh(c,h),null,f,o,s)}if(e instanceof Cu){var l=e.key.path.A(),p=hh(e.version);return new zh(new Bh(l,p),null,null,!0,o,s)}return Mr()}function ah(t){var e=t.X();return[e.seconds,e.nanoseconds]}function ch(t){var e=new Pi(t[0],t[1]);return Ui.Y(e)}function hh(t){var e=t.X();return new Lh(e.seconds,e.nanoseconds)}function fh(t){var e=new Pi(t.seconds,t.nanoseconds);return Ui.Y(e)}function lh(t,e){var n=(e.baseMutations||[]).map((function(e){return Ts(t.Do,e)})),r=e.mutations.map((function(e){return Ts(t.Do,e)})),i=Pi.fromMillis(e.localWriteTimeMs);return new Nc(e.batchId,i,n,r)}function ph(t){var e,n=fh(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?fh(t.lastLimboFreeSnapshotVersion):Ui.min(),i=void 0!==t.query.documents?(Fr(1===(e=t.query).documents.length),Ku(qu(ms(e.documents[0])))):function(t){var e,n=ms(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Fr(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=xs(t.unaryFilter.field);return ra.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=xs(t.unaryFilter.field);return ra.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=xs(t.unaryFilter.field);return ra.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=xs(t.unaryFilter.field);return ra.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Mr()}}(e)]:void 0!==e.fieldFilter?[(n=e,ra.create(xs(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Mr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce((function(t,e){return t.concat(e)})):Mr():[];var n}(r.where));var u=[];r.orderBy&&(u=r.orderBy.map((function(t){return new Ra(xs((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e})));var a,c,h=null;r.limit&&(h=Gi(c="object"==typeof(a=r.limit)?a.value:a)?null:c);var f=null;r.startAt&&(f=Ss(r.startAt));var l=null;return r.endAt&&(l=Ss(r.endAt)),Ku(Fu(n,o,u,s,h,"F",f,l))}(t.query);return new Zi(i,t.targetId,0,t.lastListenSequenceNumber,n,r,_i.fromBase64String(t.resumeToken))}function dh(t,e){var n=hh(e.et),r=hh(e.lastLimboFreeSnapshotVersion),i=(Yi(e.target)?_s:As)(t.Do,e.target),o=e.resumeToken.toBase64();return new Qh(e.targetId,Ki(e.target),n,o,e.sequenceNumber,r,i)}var vh=(yh.Fo=function(t,e,n,r){return Fr(""!==t.uid),new yh(t.Xs()?t.uid:"",e,n,r)},yh.prototype.$o=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wh(t).ss({index:Fh.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},yh.prototype.xo=function(t,e,n,r){var i=this,o=bh(t),s=wh(t);return s.add({}).next((function(u){Fr("number"==typeof u);for(var a,c,h,f,l,p=new Nc(u,e,n,r),d=(a=i.serializer,c=i.userId,f=(h=p).baseMutations.map((function(t){return Es(a.Do,t)})),l=h.mutations.map((function(t){return Es(a.Do,t)})),new Fh(c,h.batchId,h.rr.toMillis(),f,l)),v=[],y=new ho((function(t,e){return Ii(t.R(),e.R())})),g=0,m=r;g<m.length;g++){var w=m[g],b=qh.key(i.userId,w.key.path,u);y=y.add(w.key.path.h());v.push(s.put(d)),v.push(o.put(b,qh.PLACEHOLDER))}return y.forEach((function(e){v.push(i.Sr.ko(t,e))})),t.Vr((function(){i.No[u]=p.keys()})),Pa.$n(v).next((function(){return p}))}))},yh.prototype.Mo=function(t,e){var n=this;return wh(t).get(e).next((function(t){return t?(Fr(t.userId===n.userId),lh(n.serializer,t)):null}))},yh.prototype.Oo=function(t,e){var n=this;return this.No[e]?Pa.resolve(this.No[e]):this.Mo(t,e).next((function(t){if(t){var r=t.keys();return n.No[e]=r}return null}))},yh.prototype.Lo=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return wh(t).ss({index:Fh.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Fr(e.batchId>=r),o=lh(n.serializer,e)),i.done()})).next((function(){return o}))},yh.prototype.Bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return wh(t).ss({index:Fh.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},yh.prototype.qo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return wh(t).Zn(Fh.userMutationsIndex,n).next((function(t){return t.map((function(t){return lh(e.serializer,t)}))}))},yh.prototype.Cr=function(t,e){var n=this,r=qh.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return bh(t).ss({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=ih(a);if(u===n.userId&&e.path.isEqual(h))return wh(t).get(c).next((function(t){if(!t)throw Mr();Fr(t.userId===n.userId),o.push(lh(n.serializer,t))}));s.done()})).next((function(){return o}))},yh.prototype.Mr=function(t,e){var n=this,r=new ho(Ii),i=[];return e.forEach((function(e){var o=qh.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=bh(t).ss({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=ih(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),Pa.$n(i).next((function(){return n.Uo(t,r)}))},yh.prototype.Qr=function(t,e){var n=this,r=e.path,i=r.length+1,o=qh.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new ho(Ii);return bh(t).ss({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=ih(a);s===n.userId&&r.T(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.Uo(t,u)}))},yh.prototype.Uo=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(wh(t).get(e).next((function(t){if(null===t)throw Mr();Fr(t.userId===n.userId),r.push(lh(n.serializer,t))})))})),Pa.$n(i).next((function(){return r}))},yh.prototype.Qo=function(t,e){var n=this;return mh(t.Wo,this.userId,e).next((function(r){return t.Vr((function(){n.jo(e.batchId)})),Pa.forEach(r,(function(e){return n.Co.Ko(t,e)}))}))},yh.prototype.jo=function(t){delete this.No[t]},yh.prototype.Go=function(t){var e=this;return this.$o(t).next((function(n){if(!n)return Pa.resolve();var r=IDBKeyRange.lowerBound(qh.prefixForUser(e.userId)),i=[];return bh(t).ss({range:r},(function(t,n,r){var o;t[0]===e.userId?(o=ih(t[1]),i.push(o)):r.done()})).next((function(){Fr(0===i.length)}))}))},yh.prototype.zo=function(t,e){return gh(t,this.userId,e)},yh.prototype.Ho=function(t){var e=this;return Ih(t).get(this.userId).next((function(t){return t||new Mh(e.userId,-1,"")}))},yh);function yh(t,e,n,r){this.userId=t,this.serializer=e,this.Sr=n,this.Co=r,this.No={}}function gh(t,e,n){var r=qh.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return bh(t).ss({range:o,ns:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function mh(t,e,n){var r=t.store(Fh.store),i=t.store(qh.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ss({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){Fr(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=qh.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Pa.$n(o).next((function(){return c}))}function wh(t){return pf.Un(t,Fh.store)}function bh(t){return pf.Un(t,qh.store)}function Ih(t){return pf.Un(t,Mh.store)}var Eh,Th=(_h.prototype.Tr=function(t,e,n){return Nh(t).put(Sh(e),n)},_h.prototype.Ir=function(t,e){var n=Nh(t),r=Sh(e);return n.delete(r)},_h.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Yo(t,r)}))},_h.prototype.Ar=function(t,e){var n=this;return Nh(t).get(Sh(e)).next((function(t){return n.Jo(t)}))},_h.prototype.Xo=function(t,e){var n=this;return Nh(t).get(Sh(e)).next((function(t){var e=n.Jo(t);return e?{Zo:e,size:Dh(t)}:null}))},_h.prototype.getEntries=function(t,e){var n=this,r=lo;return this.ta(t,e,(function(t,e){var i=n.Jo(e);r=r.rt(t,i)})).next((function(){return r}))},_h.prototype.ea=function(t,e){var n=this,r=lo,i=new ro(Yr.i);return this.ta(t,e,(function(t,e){var o=n.Jo(e);i=o?(r=r.rt(t,o),i.rt(t,Dh(e))):(r=r.rt(t,null),i.rt(t,0))})).next((function(){return{na:r,sa:i}}))},_h.prototype.ta=function(t,e,n){if(e.m())return Pa.resolve();var r=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),i=e.lt(),o=i.Et();return Nh(t).ss({range:r},(function(t,e,r){for(var s=Yr.$(t);o&&Yr.i(o,s)<0;)n(o,null),o=i.Et();o&&o.isEqual(s)&&(n(o,e),o=i.It()?i.Et():null),o?r.Jn(o.path.A()):r.done()})).next((function(){for(;o;)n(o,null),o=i.It()?i.Et():null}))},_h.prototype.Or=function(t,e,n){var r,i,o,s=this,u=yo,a=e.path.length+1,c={};return n.isEqual(Ui.min())?(r=e.path.A(),c.range=IDBKeyRange.lowerBound(r)):(i=e.path.A(),o=ah(n),c.range=IDBKeyRange.lowerBound([i,o],!0),c.index=zh.collectionReadTimeIndex),Nh(t).ss(c,(function(t,n,r){var i;t.length===a&&(i=sh(s.serializer,n),e.path.T(i.key.path)?i instanceof ku&&ta(e,i)&&(u=u.rt(i.key,i)):r.done())})).next((function(){return u}))},_h.prototype.ia=function(t,e){var n=this,r=lo,i=ah(e),o=Nh(t),s=IDBKeyRange.lowerBound(i,!0);return o.ss({index:zh.readTimeIndex,range:s},(function(t,e){var o=sh(n.serializer,e);r=r.rt(o.key,o),i=e.readTime})).next((function(){return{ra:r,readTime:ch(i)}}))},_h.prototype.oa=function(t){var e=Nh(t),n=Ui.min();return e.ss({index:zh.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=ch(e.readTime)),r.done()})).next((function(){return n}))},_h.prototype.aa=function(t){return new _h.ca(this,!!t&&t.ua)},_h.prototype.ha=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},_h.prototype.getMetadata=function(t){return Ah(t).get(Hh.key).next((function(t){return Fr(!!t),t}))},_h.prototype.Yo=function(t,e){return Ah(t).put(Hh.key,e)},_h.prototype.Jo=function(t){if(t){var e=sh(this.serializer,t);return e instanceof Lu&&e.version.isEqual(Ui.min())?null:e}return null},_h);function _h(t,e){this.serializer=t,this.Sr=e}function Ah(t){return pf.Un(t,Hh.store)}function Nh(t){return pf.Un(t,zh.store)}function Sh(t){return t.path.A()}function Dh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Mr();e=t.noDocument}return JSON.stringify(e).length}function xh(t,e){var n=this;return(n=Eh.call(this)||this).la=t,n.ua=e,n._a=new Ci((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),n}Th.ca=(s(xh,Eh=Dc),xh.prototype.gr=function(t){var e=this,n=[],r=0,i=new ho((function(t,e){return Ii(t.R(),e.R())}));return this.dr.forEach((function(o,s){var u,a,c,h=e._a.get(o);s?(u=uh(e.la.serializer,s,e.readTime),i=i.add(o.path.h()),a=Dh(u),r+=a-h,n.push(e.la.Tr(t,o,u))):(r-=h,e.ua?(c=uh(e.la.serializer,new Lu(o,Ui.min()),e.readTime),n.push(e.la.Tr(t,o,c))):n.push(e.la.Ir(t,o)))})),i.forEach((function(r){n.push(e.la.Sr.ko(t,r))})),n.push(this.la.updateMetadata(t,r)),Pa.$n(n)},xh.prototype.Rr=function(t,e){var n=this;return this.la.Xo(t,e).next((function(t){return null===t?(n._a.set(e,0),null):(n._a.set(e,t.size),t.Zo)}))},xh.prototype.Pr=function(t,e){var n=this;return this.la.ea(t,e).next((function(t){var e=t.na;return t.sa.forEach((function(t,e){n._a.set(t,e)})),e}))},xh);var Oh=(Vh.prototype.ko=function(t,e){return this.fa.add(e),Pa.resolve()},Vh.prototype.Ur=function(t,e){return Pa.resolve(this.fa.getEntries(e))},Vh),Rh=(Uh.prototype.add=function(t){var e=t._(),n=t.h(),r=this.index[e]||new ho(Qr.i),i=!r.has(n);return this.index[e]=r.add(n),i},Uh.prototype.has=function(t){var e=t._(),n=t.h(),r=this.index[e];return r&&r.has(n)},Uh.prototype.getEntries=function(t){return(this.index[t]||new ho(Qr.i)).A()},Uh),kh=(Ph.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Fr(n<r&&0<=n&&r<=10);var o,s=new Ha(e);n<1&&1<=r&&(t.createObjectStore(Ch.store),(o=t).createObjectStore(Mh.store,{keyPath:Mh.keyPath}),o.createObjectStore(Fh.store,{keyPath:Fh.keyPath,autoIncrement:!0}).createIndex(Fh.userMutationsIndex,Fh.userMutationsKeyPath,{unique:!0}),o.createObjectStore(qh.store),Xh(t),t.createObjectStore(zh.store));var u,a=Pa.resolve();return n<3&&3<=r&&(0!==n&&((u=t).deleteObjectStore(Kh.store),u.deleteObjectStore(Qh.store),u.deleteObjectStore(Wh.store),Xh(t)),a=a.next((function(){return t=s.store(Wh.store),e=new Wh(0,0,Ui.min().X(),0),t.put(Wh.key,e);var t,e}))),n<4&&4<=r&&(0!==n&&(a=a.next((function(){return e=t,(n=s).store(Fh.store).Zn().next((function(t){e.deleteObjectStore(Fh.store),e.createObjectStore(Fh.store,{keyPath:Fh.keyPath,autoIncrement:!0}).createIndex(Fh.userMutationsIndex,Fh.userMutationsKeyPath,{unique:!0});var r=n.store(Fh.store),i=t.map((function(t){return r.put(t)}));return Pa.$n(i)}));var e,n}))),a=a.next((function(){t.createObjectStore($h.store,{keyPath:$h.keyPath})}))),n<5&&5<=r&&(a=a.next((function(){return i.removeAcknowledgedMutations(s)}))),n<6&&6<=r&&(a=a.next((function(){return t.createObjectStore(Hh.store),i.addDocumentGlobal(s)}))),n<7&&7<=r&&(a=a.next((function(){return i.ensureSequenceNumbers(s)}))),n<8&&8<=r&&(a=a.next((function(){return i.createCollectionParentIndex(t,s)}))),n<9&&9<=r&&(a=a.next((function(){var n,r;(r=t).objectStoreNames.contains("remoteDocumentChanges")&&r.deleteObjectStore("remoteDocumentChanges"),(n=e.objectStore(zh.store)).createIndex(zh.readTimeIndex,zh.readTimeIndexPath,{unique:!1}),n.createIndex(zh.collectionReadTimeIndex,zh.collectionReadTimeIndexPath,{unique:!1})}))),n<10&&10<=r&&(a=a.next((function(){return i.rewriteCanonicalIds(s)}))),a},Ph.prototype.addDocumentGlobal=function(t){var e=0;return t.store(zh.store).ss((function(t,n){e+=Dh(n)})).next((function(){var n=new Hh(e);return t.store(Hh.store).put(Hh.key,n)}))},Ph.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Mh.store),r=t.store(Fh.store);return n.Zn().next((function(n){return Pa.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Zn(Fh.userMutationsIndex,i).next((function(r){return Pa.forEach(r,(function(r){Fr(r.userId===n.userId);var i=lh(e.serializer,r);return mh(t,n.userId,i).next((function(){}))}))}))}))}))},Ph.prototype.ensureSequenceNumbers=function(t){var e=t.store(Kh.store),n=t.store(zh.store);return t.store(Wh.store).get(Wh.key).next((function(t){var r=[];return n.ss((function(n,i){var o=new Qr(n),s=[0,nh(o)];r.push(e.get(s).next((function(n){return n?Pa.resolve():e.put(new Kh(0,nh(o),t.highestListenSequenceNumber))})))})).next((function(){return Pa.$n(r)}))}))},Ph.prototype.createCollectionParentIndex=function(t,e){function n(t){if(i.add(t)){var e=t._(),n=t.h();return r.put({collectionId:e,parent:nh(n)})}}t.createObjectStore(Yh.store,{keyPath:Yh.keyPath});var r=e.store(Yh.store),i=new Rh;return e.store(zh.store).ss({ns:!0},(function(t,e){return n(new Qr(t).h())})).next((function(){return e.store(qh.store).ss({ns:!0},(function(t,e){t[0];var r=t[1];return n((t[2],ih(r)).h())}))}))},Ph.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Qh.store);return n.ss((function(t,r){var i=ph(r),o=dh(e.serializer,i);return n.put(o)}))},Ph),Lh=function(t,e){this.seconds=t,this.nanoseconds=e},Ch=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Ph(t){this.serializer=t}function Uh(){this.index={}}function Vh(){this.fa=new Rh}Ch.store="owner",Ch.key="owner";var Mh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Mh.store="mutationQueues",Mh.keyPath="userId";var Fh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Fh.store="mutations",Fh.keyPath="batchId",Fh.userMutationsIndex="userMutationsIndex",Fh.userMutationsKeyPath=["userId","batchId"];var qh=(jh.prefixForUser=function(t){return[t]},jh.prefixForPath=function(t,e){return[t,nh(e)]},jh.key=function(t,e,n){return[t,nh(e),n]},jh);function jh(){}qh.store="documentMutations",qh.PLACEHOLDER=new qh;var Gh=function(t,e){this.path=t,this.readTime=e},Bh=function(t,e){this.path=t,this.version=e},zh=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};zh.store="remoteDocuments",zh.readTimeIndex="readTimeIndex",zh.readTimeIndexPath="readTime",zh.collectionReadTimeIndex="collectionReadTimeIndex",zh.collectionReadTimeIndexPath=["parentPath","readTime"];var Hh=function(t){this.byteSize=t};Hh.store="remoteDocumentGlobal",Hh.key="remoteDocumentGlobalKey";var Qh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Qh.store="targets",Qh.keyPath="targetId",Qh.queryTargetsIndexName="queryTargetsIndex",Qh.queryTargetsKeyPath=["canonicalId","targetId"];var Kh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Kh.store="targetDocuments",Kh.keyPath=["targetId","path"],Kh.documentTargetsIndex="documentTargetsIndex",Kh.documentTargetsKeyPath=["path","targetId"];var Wh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Wh.key="targetGlobalKey",Wh.store="targetGlobal";var Yh=function(t,e){this.collectionId=t,this.parent=e};function Xh(t){t.createObjectStore(Kh.store,{keyPath:Kh.keyPath}).createIndex(Kh.documentTargetsIndex,Kh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Qh.store,{keyPath:Qh.keyPath}).createIndex(Qh.queryTargetsIndexName,Qh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Wh.store)}Yh.store="collectionParents",Yh.keyPath=["collectionId","parent"];var $h=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};$h.store="clientMetadata",$h.keyPath="clientId";var Jh=c(c(c([Mh.store,Fh.store,qh.store,zh.store,Qh.store,Ch.store,Wh.store,Kh.store],[$h.store]),[Hh.store]),[Yh.store]),Zh=(tf.prototype.ko=function(t,e){var n=this;if(this.da.has(e))return Pa.resolve();var r=e._(),i=e.h();t.Vr((function(){n.da.add(e)}));var o={collectionId:r,parent:nh(i)};return ef(t).put(o)},tf.prototype.Ur=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Ti(e),""],!1,!0);return ef(t).Zn(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ih(o.parent))}return n}))},tf);function tf(){this.da=new Rh}function ef(t){return pf.Un(t,Yh.store)}var nf=(sf.prototype.next=function(){return this.wa+=2,this.wa},sf.ma=function(){return new sf(0)},sf.Ta=function(){return new sf(-1)},sf),rf=(of.prototype.Ea=function(t){var e=this;return this.Ia(t).next((function(n){var r=new nf(n.highestTargetId);return n.highestTargetId=r.next(),e.Aa(t,n).next((function(){return n.highestTargetId}))}))},of.prototype.Ra=function(t){return this.Ia(t).next((function(t){return Ui.Y(new Pi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},of.prototype.Pa=function(t){return this.Ia(t).next((function(t){return t.highestListenSequenceNumber}))},of.prototype.ga=function(t,e,n){var r=this;return this.Ia(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.X()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Aa(t,i)}))},of.prototype.ya=function(t,e){var n=this;return this.Va(t,e).next((function(){return n.Ia(t).next((function(r){return r.targetCount+=1,n.pa(e,r),n.Aa(t,r)}))}))},of.prototype.ba=function(t,e){return this.Va(t,e)},of.prototype.va=function(t,e){var n=this;return this.Sa(t,e.targetId).next((function(){return uf(t).delete(e.targetId)})).next((function(){return n.Ia(t)})).next((function(e){return Fr(0<e.targetCount),--e.targetCount,n.Aa(t,e)}))},of.prototype.Vo=function(t,e,n){var r=this,i=0,o=[];return uf(t).ss((function(s,u){var a=ph(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.va(t,a)))})).next((function(){return Pa.$n(o)})).next((function(){return i}))},of.prototype.De=function(t,e){return uf(t).ss((function(t,n){var r=ph(n);e(r)}))},of.prototype.Ia=function(t){return af(t).get(Wh.key).next((function(t){return Fr(null!==t),t}))},of.prototype.Aa=function(t,e){return af(t).put(Wh.key,e)},of.prototype.Va=function(t,e){return uf(t).put(dh(this.serializer,e))},of.prototype.pa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},of.prototype.Da=function(t){return this.Ia(t).next((function(t){return t.targetCount}))},of.prototype.Ca=function(t,e){var n=Ki(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return uf(t).ss({range:r,index:Qh.queryTargetsIndexName},(function(t,n,r){var o=ph(n);Wi(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},of.prototype.Na=function(t,e,n){var r=this,i=[],o=cf(t);return e.forEach((function(e){var s=nh(e.path);i.push(o.put(new Kh(n,s))),i.push(r.Co.Fa(t,n,e))})),Pa.$n(i)},of.prototype.$a=function(t,e,n){var r=this,i=cf(t);return Pa.forEach(e,(function(e){var o=nh(e.path);return Pa.$n([i.delete([n,o]),r.Co.xa(t,n,e)])}))},of.prototype.Sa=function(t,e){var n=cf(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},of.prototype.ka=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=cf(t),i=wo();return r.ss({range:n,ns:!0},(function(t,e,n){var r=ih(t[1]),o=new Yr(r);i=i.add(o)})).next((function(){return i}))},of.prototype.zo=function(t,e){var n=nh(e.path),r=IDBKeyRange.bound([n],[Ti(n)],!1,!0),i=0;return cf(t).ss({index:Kh.documentTargetsIndex,ns:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return 0<i}))},of.prototype.qe=function(t,e){return uf(t).get(e).next((function(t){return t?ph(t):null}))},of);function of(t,e){this.Co=t,this.serializer=e}function sf(t){this.wa=t}function uf(t){return pf.Un(t,Qh.store)}function af(t){return pf.Un(t,Wh.store)}function cf(t){return pf.Un(t,Kh.store)}var hf,ff="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",lf=(s(vf,hf=Oc),vf),pf=(df.Un=function(t,e){if(t instanceof lf)return Ua.Un(t.Wo,e);throw Mr()},df.prototype.start=function(){var t=this;return this.Ja().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Or(xr.FAILED_PRECONDITION,ff);return t.Xa(),t.Za(),t.tc(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.Ha.Pa(e)}))})).then((function(e){t.Ba=new dc(e,t.Oa)})).then((function(){t.qa=!0})).catch((function(e){return t.za&&t.za.close(),Promise.reject(e)}))},df.prototype.ec=function(t){var e=this;return this.Ka=function(n){return u(e,void 0,void 0,(function(){return a(this,(function(e){return this.Ti?[2,t(n)]:[2]}))}))},t(this.isPrimary)},df.prototype.nc=function(t){var e=this;this.za.jn((function(n){return u(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},df.prototype.sc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this._n.ds((function(){return u(e,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.Ti?[4,this.Ja()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},df.prototype.Ja=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return gf(e).put(new $h(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.ic(e).next((function(e){e||(t.isPrimary=!1,t._n.Ds((function(){return t.Ka(!1)})))}))})).next((function(){return t.rc(e)})).next((function(n){return t.isPrimary&&!n?t.oc(e).next((function(){return!1})):!!n&&t.ac(e).next((function(){return!0}))}))})).catch((function(e){if(za(e))return Cr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Cr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t._n.Ds((function(){return t.Ka(e)})),t.isPrimary=e}))},df.prototype.ic=function(t){var e=this;return yf(t).get(Ch.key).next((function(t){return Pa.resolve(e.cc(t))}))},df.prototype.uc=function(t){return gf(t).delete(this.clientId)},df.prototype.hc=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i=this;return a(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.lc(this.ja,18e5)?[3,2]:(this.ja=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=df.Un(t,$h.store);return e.Zn().next((function(t){var n=i._c(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return Pa.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Ya)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ya.removeItem(this.fc(r.clientId));o.label=2;case 2:return[2]}}))}))},df.prototype.tc=function(){var t=this;this.Wa=this._n.gn("client_metadata_refresh",4e3,(function(){return t.Ja().then((function(){return t.hc()})).then((function(){return t.tc()}))}))},df.prototype.cc=function(t){return!!t&&t.ownerId===this.clientId},df.prototype.rc=function(t){var e=this;return this.La?Pa.resolve(!0):yf(t).get(Ch.key).next((function(n){if(null!==n&&e.lc(n.leaseTimestampMs,5e3)&&!e.dc(n.ownerId)){if(e.cc(n)&&e.networkEnabled)return!0;if(!e.cc(n)){if(!n.allowTabSynchronization)throw new Or(xr.FAILED_PRECONDITION,ff);return!1}}return!(!e.networkEnabled||!e.inForeground)||gf(t).Zn().next((function(t){return void 0===e._c(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&Cr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},df.prototype.Si=function(){return u(this,void 0,void 0,(function(){var t=this;return a(this,(function(e){switch(e.label){case 0:return this.qa=!1,this.wc(),this.Wa&&(this.Wa.cancel(),this.Wa=null),this.mc(),this.Tc(),[4,this.za.runTransaction("readwrite",[Ch.store,$h.store],(function(e){var n=new lf(e,dc.oi);return t.oc(n).next((function(){return t.uc(n)}))}))];case 1:return e.sent(),this.za.close(),this.Ec(),[2]}}))}))},df.prototype._c=function(t,e){var n=this;return t.filter((function(t){return n.lc(t.updateTimeMs,e)&&!n.dc(t.clientId)}))},df.prototype.Vi=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return gf(e).Zn().next((function(e){return t._c(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(df.prototype,"Ti",{get:function(){return this.qa},enumerable:!1,configurable:!0}),df.prototype.Ic=function(t){return vh.Fo(t,this.serializer,this.Sr,this.Co)},df.prototype.Ac=function(){return this.Ha},df.prototype.Rc=function(){return this.br},df.prototype.Pc=function(){return this.Sr},df.prototype.runTransaction=function(t,e,n){var r=this;Cr("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.za.runTransaction(o,Jh,(function(o){return i=new lf(o,r.Ba?r.Ba.next():dc.oi),"readwrite-primary"===e?r.ic(i).next((function(t){return!!t||r.rc(i)})).next((function(e){if(!e)throw Pr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r._n.Ds((function(){return r.Ka(!1)})),new Or(xr.FAILED_PRECONDITION,xc);return n(i)})).next((function(t){return r.ac(i).next((function(){return t}))})):r.gc(i).next((function(){return n(i)}))})).then((function(t){return i.pr(),t}))},df.prototype.gc=function(t){var e=this;return yf(t).get(Ch.key).next((function(t){if(null!==t&&e.lc(t.leaseTimestampMs,5e3)&&!e.dc(t.ownerId)&&!e.cc(t)&&!(e.La||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Or(xr.FAILED_PRECONDITION,ff)}))},df.prototype.ac=function(t){var e=new Ch(this.clientId,this.allowTabSynchronization,Date.now());return yf(t).put(Ch.key,e)},df.On=function(){return Ua.On()},df.prototype.oc=function(t){var e=this,n=yf(t);return n.get(Ch.key).next((function(t){return e.cc(t)?(Cr("IndexedDbPersistence","Releasing primary lease."),n.delete(Ch.key)):Pa.resolve()}))},df.prototype.lc=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Pr("Detected an update time that is in the future: "+t+" > "+n),1))},df.prototype.Xa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Qa=function(){t._n.ds((function(){return t.inForeground="visible"===t.document.visibilityState,t.Ja()}))},this.document.addEventListener("visibilitychange",this.Qa),this.inForeground="visible"===this.document.visibilityState)},df.prototype.mc=function(){this.Qa&&(this.document.removeEventListener("visibilitychange",this.Qa),this.Qa=null)},df.prototype.Za=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ua=function(){e.wc(),e._n.ds((function(){return e.Si()}))},this.window.addEventListener("unload",this.Ua))},df.prototype.Tc=function(){this.Ua&&(this.window.removeEventListener("unload",this.Ua),this.Ua=null)},df.prototype.dc=function(t){var e;try{var n=null!==(null===(e=this.Ya)||void 0===e?void 0:e.getItem(this.fc(t)));return Cr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Pr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},df.prototype.wc=function(){if(this.Ya)try{this.Ya.setItem(this.fc(this.clientId),String(Date.now()))}catch(t){Pr("Failed to set zombie client id.",t)}},df.prototype.Ec=function(){if(this.Ya)try{this.Ya.removeItem(this.fc(this.clientId))}catch(t){}},df.prototype.fc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},df);function df(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this._n=i,this.window=o,this.document=s,this.Oa=a,this.La=c,this.Ba=null,this.qa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ua=null,this.inForeground=!1,this.Qa=null,this.Wa=null,this.ja=Number.NEGATIVE_INFINITY,this.Ka=function(t){return Promise.resolve()},!df.On())throw new Or(xr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Co=new mf(this,r),this.Ga=e+"main",this.serializer=new oh(u),this.za=new Ua(this.Ga,10,new kh(this.serializer)),this.Ha=new rf(this.Co,this.serializer),this.Sr=new Zh,this.br=new Th(this.serializer,this.Sr),this.window&&this.window.localStorage?this.Ya=this.window.localStorage:(this.Ya=null,!1===c&&Pr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function vf(t,e){var n=this;return(n=hf.call(this)||this).Wo=t,n.Ma=e,n}function yf(t){return pf.Un(t,Ch.store)}function gf(t){return pf.Un(t,$h.store)}var mf=(wf.prototype.Ro=function(t){var e=this.yc(t);return this.db.Ac().Da(t).next((function(t){return e.next((function(e){return t+e}))}))},wf.prototype.yc=function(t){var e=0;return this.yo(t,(function(t){e++})).next((function(){return e}))},wf.prototype.De=function(t,e){return this.db.Ac().De(t,e)},wf.prototype.yo=function(t,e){return this.Vc(t,(function(t,n){return e(n)}))},wf.prototype.Fa=function(t,e,n){return bf(t,n)},wf.prototype.xa=function(t,e,n){return bf(t,n)},wf.prototype.Vo=function(t,e,n){return this.db.Ac().Vo(t,e,n)},wf.prototype.Ko=bf,wf.prototype.bc=function(t,e){return r=e,i=!1,Ih(n=t).rs((function(t){return gh(n,t,r).next((function(t){return t&&(i=!0),Pa.resolve(!t)}))})).next((function(){return i}));var n,r,i},wf.prototype.po=function(t,e){var n=this,r=this.db.Rc().aa(),i=[],o=0;return this.Vc(t,(function(s,u){var a;u<=e&&(a=n.bc(t,s).next((function(e){if(!e)return o++,r.Ar(t,s).next((function(){return r.Ir(s),cf(t).delete([0,nh(s.path)])}))})),i.push(a))})).next((function(){return Pa.$n(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},wf.prototype.removeTarget=function(t,e){var n=e.nt(t.Ma);return this.db.Ac().ba(t,n)},wf.prototype.vc=bf,wf.prototype.Vc=function(t,e){var n,r=cf(t),i=dc.oi;return r.ss({index:Kh.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==dc.oi&&e(new Yr(ih(n)),i),i=u,n=s):i=dc.oi})).next((function(){i!==dc.oi&&e(new Yr(ih(n)),i)}))},wf.prototype.vo=function(t){return this.db.Rc().ha(t)},wf);function wf(t,e){this.db=t,this.do=new Zc(this,e)}function bf(t,e){return cf(t).put((n=t.Ma,new Kh(0,nh(e.path),n)));var n}function If(t,e){var n=t.projectId;return t.W||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Ef=(Tf.prototype.Eo=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.bo(n,e.Dc)}))},Tf);function Tf(t,e,n){this.persistence=t,this.Sc=e,this.Dc=new ro(Ii),this.Cc=new Ci(Ki,Wi),this.Nc=Ui.min(),this.vr=t.Ic(n),this.Fc=t.Rc(),this.Ha=t.Ac(),this.$c=new Rc(this.Fc,this.vr,this.persistence.Pc()),this.Sc.xc(this.$c)}function _f(t,e){var n=t;return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r,i,o,s,u,a,c,h=e.batch.keys(),f=n.Fc.aa({ua:!0});return r=n,i=t,s=f,a=(u=(o=e).batch).keys(),c=Pa.resolve(),a.forEach((function(t){c=c.next((function(){return s.Ar(i,t)})).next((function(e){var n=e,r=o._r.get(t);Fr(null!==r),(!n||n.version.L(r)<0)&&(n=u.ar(t,n,o))&&s.Tr(n,o.lr)}))})),c.next((function(){return r.vr.Qo(i,u)})).next((function(){return f.apply(t)})).next((function(){return n.vr.Go(t)})).next((function(){return n.$c.$r(t,h)}))}))}function Af(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.Ha.Ra(t)}))}function Nf(t,e){var n=t,r=e.et,i=n.Dc;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.Fc.aa({ua:!0});i=n.Dc;var s=[];e.Gt.forEach((function(e,o){var u,a,c,h,f,l=i.get(o);l&&(s.push(n.Ha.$a(t,e.ne,o).next((function(){return n.Ha.Na(t,e.te,o)}))),0<(u=e.resumeToken).O()&&(a=l.st(u,r).nt(t.Ma),i=i.rt(o,a),c=l,f=e,Fr(0<(h=a).resumeToken.O()),(0===c.resumeToken.O()||3e8<=h.et.J()-c.et.J()||0<f.te.size+f.ee.size+f.ne.size)&&s.push(n.Ha.ba(t,a))))}));var u,a=lo,c=wo();return e.Ht.forEach((function(t,e){c=c.add(t)})),s.push(o.getEntries(t,c).next((function(i){e.Ht.forEach((function(u,c){var h=i.get(u);c instanceof Lu&&c.version.isEqual(Ui.min())?(o.Ir(u,r),a=a.rt(u,c)):null==h||0<c.version.L(h.version)||0===c.version.L(h.version)&&h.hasPendingWrites?(o.Tr(c,r),a=a.rt(u,c)):Cr("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.Yt.has(u)&&s.push(n.persistence.Co.vc(t,u))}))}))),r.isEqual(Ui.min())||(u=n.Ha.Ra(t).next((function(e){return n.Ha.ga(t,t.Ma,r)})),s.push(u)),Pa.$n(s).next((function(){return o.apply(t)})).next((function(){return n.$c.kr(t,a)}))})).then((function(t){return n.Dc=i,t}))}function Sf(t,e){var n=t;return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.Ha.Ca(t,e).next((function(i){return i?(r=i,Pa.resolve(r)):n.Ha.Ea(t).next((function(i){return r=new Zi(e,i,0,t.Ma),n.Ha.ya(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Dc.get(t.targetId);return(null===r||0<t.et.L(r.et))&&(n.Dc=n.Dc.rt(t.targetId,t),n.Cc.set(e,t.targetId)),t}))}function Df(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s;return a(this,(function(u){switch(u.label){case 0:i=(r=t).Dc.get(e),o=n?"readwrite":"readwrite-primary",u.label=1;case 1:return u.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.Co.removeTarget(t,i)}))];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:if(!za(s=u.sent()))throw s;return Cr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Dc=r.Dc.remove(e),r.Cc.delete(i.target),[2]}}))}))}function xf(t,e,n){var r=t,i=Ui.min(),o=wo();return r.persistence.runTransaction("Execute query","readonly",(function(t){return s=r,u=t,a=Ku(e),(void 0!==(h=(c=s).Cc.get(a))?Pa.resolve(c.Dc.get(h)):c.Ha.Ca(u,a)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ha.ka(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.Sc.Or(t,e,n?i:Ui.min(),n?o:wo())})).next((function(t){return{documents:t,kc:o}}));var s,u,a,c,h}))}function Of(t,e){var n=t,r=n.Ha,i=n.Dc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.qe(t,e).next((function(t){return t?t.target:null}))}))}function Rf(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){if(t.code!==xr.FAILED_PRECONDITION||t.message!==xc)throw t;return Cr("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function kf(t,e){this.user=e,this.type="OAuth",this.zc={},this.zc.Authorization="Bearer "+t}function Lf(t,e,n,r,i){var o=this;this.Gu=t,this.zu=e,this.os=n,this.Hu={},this.Yu=[],this.Ju=new Map,this.Xu=new Set,this.Zu=[],this.th=i,this.th.eh((function(t){n.ds((function(){return u(o,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return dl(this)?(Cr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return u(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return(e=t).Xu.add(4),[4,sl(e)];case 1:return n.sent(),e.nh.set("Unknown"),e.Xu.delete(4),[4,ol(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.nh=new Kf(n,r)}var Cf,Pf,Uf,Vf=(il.prototype.m=function(){return this.Mc.m()},il.prototype.Fa=function(t,e){var n=new Mf(t,e);this.Mc=this.Mc.add(n),this.Lc=this.Lc.add(n)},il.prototype.qc=function(t,e){var n=this;t.forEach((function(t){return n.Fa(t,e)}))},il.prototype.xa=function(t,e){this.Uc(new Mf(t,e))},il.prototype.Qc=function(t,e){var n=this;t.forEach((function(t){return n.xa(t,e)}))},il.prototype.Wc=function(t){var e=this,n=new Yr(new Qr([])),r=new Mf(n,t),i=new Mf(n,t+1),o=[];return this.Lc.Nt([r,i],(function(t){e.Uc(t),o.push(t.key)})),o},il.prototype.jc=function(){var t=this;this.Mc.forEach((function(e){return t.Uc(e)}))},il.prototype.Uc=function(t){this.Mc=this.Mc.delete(t),this.Lc=this.Lc.delete(t)},il.prototype.Kc=function(t){var e=new Yr(new Qr([])),n=new Mf(e,t),r=new Mf(e,t+1),i=wo();return this.Lc.Nt([n,r],(function(t){i=i.add(t.key)})),i},il.prototype.zo=function(t){var e=new Mf(t,0),n=this.Mc.$t(e);return null!==n&&t.isEqual(n.key)},il),Mf=(rl.Oc=function(t,e){return Yr.i(t.key,e.key)||Ii(t.Gc,e.Gc)},rl.Bc=function(t,e){return Ii(t.Gc,e.Gc)||Yr.i(t.key,e.key)},rl),Ff=(nl.prototype.getToken=function(){return Promise.resolve(null)},nl.prototype.Yc=function(){},nl.prototype.Jc=function(t){(this.Hc=t)(fc.UNAUTHENTICATED)},nl.prototype.Xc=function(){this.Hc=null},nl),qf=(el.prototype.getToken=function(){var t=this,e=this.eu,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.eu!==e?(Cr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Fr("string"==typeof n.accessToken),new kf(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},el.prototype.Yc=function(){this.forceRefresh=!0},el.prototype.Jc=function(t){this.Hc=t,this.tu&&t(this.currentUser)},el.prototype.Xc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Zc),this.Zc=null,this.Hc=null},el.prototype.nu=function(){var t=this.auth&&this.auth.getUid();return Fr(null===t||"string"==typeof t),new fc(t)},el),jf=(Object.defineProperty(tl.prototype,"zc",{get:function(){var t={"X-Goog-AuthUser":this.iu},e=this.su.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),tl),Gf=(Zf.prototype.getToken=function(){return Promise.resolve(new jf(this.su,this.iu))},Zf.prototype.Jc=function(t){t(fc.ei)},Zf.prototype.Xc=function(){},Zf.prototype.Yc=function(){},Zf),Bf=(Jf.prototype.hu=function(){return 1===this.state||2===this.state||4===this.state},Jf.prototype.lu=function(){return 2===this.state},Jf.prototype.start=function(){3!==this.state?this.auth():this._u()},Jf.prototype.stop=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.hu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},Jf.prototype.fu=function(){this.state=0,this.gs.reset()},Jf.prototype.du=function(){var t=this;this.lu()&&null===this.uu&&(this.uu=this._n.gn(this.ru,6e4,(function(){return t.wu()})))},Jf.prototype.mu=function(t){this.Tu(),this.stream.send(t)},Jf.prototype.wu=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){return this.lu()?[2,this.close(0)]:[2]}))}))},Jf.prototype.Tu=function(){this.uu&&(this.uu.cancel(),this.uu=null)},Jf.prototype.close=function(t,e){return u(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return this.Tu(),this.gs.cancel(),this.cu++,3!==t?this.gs.reset():e&&e.code===xr.RESOURCE_EXHAUSTED?(Pr(e.toString()),Pr("Using maximum backoff delay to prevent overloading the backend."),this.gs.An()):e&&e.code===xr.UNAUTHENTICATED&&this.au.Yc(),null!==this.stream&&(this.Eu(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Iu(e)];case 1:return n.sent(),[2]}}))}))},Jf.prototype.Eu=function(){},Jf.prototype.auth=function(){var t=this;this.state=1;var e=this.Au(this.cu),n=this.cu;this.au.getToken().then((function(e){t.cu===n&&t.Ru(e)}),(function(n){e((function(){var e=new Or(xr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.Pu(e)}))}))},Jf.prototype.Ru=function(t){var e=this,n=this.Au(this.cu);this.stream=this.gu(t),this.stream.yu((function(){n((function(){return e.state=2,e.listener.yu()}))})),this.stream.Iu((function(t){n((function(){return e.Pu(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},Jf.prototype._u=function(){var t=this;this.state=4,this.gs.Rn((function(){return u(t,void 0,void 0,(function(){return a(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},Jf.prototype.Pu=function(t){return Cr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Jf.prototype.Au=function(t){var e=this;return function(n){e._n.ds((function(){return e.cu===t?n():(Cr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},Jf),zf=(s($f,Uf=Bf),$f.prototype.gu=function(t){return this.ou.Vu("Listen",t)},$f.prototype.onMessage=function(t){this.gs.reset();var e=function(t,e){var n,r,i,o;if("targetChange"in e){e.targetChange;var s="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Mr(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.Ue?(Fr(void 0===i||"string"==typeof i),_i.fromBase64String(i||"")):(Fr(void 0===i||i instanceof Uint8Array),_i.fromUint8Array(i||new Uint8Array))),c=e.targetChange.cause,h=c&&(r=void 0===(n=c).code?xr.UNKNOWN:no(n.code),new Or(r,n.message||"")),f=new Do(s,u,a,h||null)}else if("documentChange"in e){e.documentChange;var l=e.documentChange;l.document,l.document.name,l.document.updateTime;var p=ys(t,l.document.name),d=ls(l.document.updateTime),v=new Eu({mapValue:{fields:l.document.fields}}),y=new ku(p,d,v,{}),g=l.targetIds||[],m=l.removedTargetIds||[];f=new No(g,m,y.key,y)}else if("documentDelete"in e){e.documentDelete;var w=e.documentDelete;w.document;var b=ys(t,w.document),I=w.readTime?ls(w.readTime):Ui.min(),E=new Lu(b,I),T=w.removedTargetIds||[];f=new No([],T,E.key,E)}else if("documentRemove"in e){e.documentRemove;var _=e.documentRemove;_.document;var A=ys(t,_.document),N=_.removedTargetIds||[];f=new No([],N,A,null)}else{if(!("filter"in e))return Mr();e.filter;var S=e.filter;S.targetId;var D=new Xi(S.count||0),x=S.targetId;f=new So(x,D)}return f}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Ui.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Ui.min():ls(e.readTime)}(t);return this.listener.pu(e,n)},$f.prototype.bu=function(t){var e,n,r,i,o={};o.database=ws(this.serializer),o.addTarget=(e=this.serializer,(r=Yi(i=(n=t).target)?{documents:_s(e,i)}:{query:As(e,i)}).targetId=n.targetId,0<n.resumeToken.O()&&(r.resumeToken=fs(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.tt){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Mr()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.mu(o)},$f.prototype.vu=function(t){var e={};e.database=ws(this.serializer),e.removeTarget=t,this.mu(e)},$f),Hf=(s(Xf,Pf=Bf),Object.defineProperty(Xf.prototype,"Du",{get:function(){return this.Su},enumerable:!1,configurable:!0}),Xf.prototype.start=function(){this.Su=!1,this.lastStreamToken=void 0,Pf.prototype.start.call(this)},Xf.prototype.Eu=function(){this.Su&&this.Cu([])},Xf.prototype.gu=function(t){return this.ou.Vu("Write",t)},Xf.prototype.onMessage=function(t){if(Fr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Su){this.gs.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(Fr(void 0!==i),r.map((function(t){return function(t,e){var n=t.updateTime?ls(t.updateTime):ls(e);n.isEqual(Ui.min())&&(n=ls(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new Js(n,r)}(t,i)}))):[]),n=ls(t.commitTime);return this.listener.Nu(n,e)}var r,i;return Fr(!t.writeResults||0===t.writeResults.length),this.Su=!0,this.listener.Fu()},Xf.prototype.$u=function(){var t={};t.database=ws(this.serializer),this.mu(t)},Xf.prototype.Cu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Es(e.serializer,t)}))};this.mu(n)},Xf),Qf=(s(Yf,Cf=function(){}),Yf.prototype.ku=function(){if(this.xu)throw new Or(xr.FAILED_PRECONDITION,"The client has already been terminated.")},Yf.prototype.Mu=function(t,e,n){var r=this;return this.ku(),this.credentials.getToken().then((function(i){return r.ou.Mu(t,e,n,i)})).catch((function(t){throw t.code===xr.UNAUTHENTICATED&&r.credentials.Yc(),t}))},Yf.prototype.Ou=function(t,e,n){var r=this;return this.ku(),this.credentials.getToken().then((function(i){return r.ou.Ou(t,e,n,i)})).catch((function(t){throw t.code===xr.UNAUTHENTICATED&&r.credentials.Yc(),t}))},Yf.prototype.terminate=function(){this.xu=!1},Yf),Kf=(Wf.prototype.Uu=function(){var t=this;0===this.Lu&&(this.Qu("Unknown"),this.Bu=this.os.gn("online_state_timeout",1e4,(function(){return t.Bu=null,t.Wu("Backend didn't respond within 10 seconds."),t.Qu("Offline"),Promise.resolve()})))},Wf.prototype.ju=function(t){"Online"===this.state?this.Qu("Unknown"):(this.Lu++,1<=this.Lu&&(this.Ku(),this.Wu("Connection failed 1 times. Most recent error: "+t.toString()),this.Qu("Offline")))},Wf.prototype.set=function(t){this.Ku(),this.Lu=0,"Online"===t&&(this.qu=!1),this.Qu(t)},Wf.prototype.Qu=function(t){t!==this.state&&(this.state=t,this.fi(t))},Wf.prototype.Wu=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.qu?(Pr(e),this.qu=!1):Cr("OnlineStateTracker",e)},Wf.prototype.Ku=function(){null!==this.Bu&&(this.Bu.cancel(),this.Bu=null)},Wf);function Wf(t,e){this.os=t,this.fi=e,this.state="Unknown",this.Lu=0,this.Bu=null,this.qu=!0}function Yf(t,e,n){var r=this;return(r=Cf.call(this)||this).credentials=t,r.ou=e,r.serializer=n,r.xu=!1,r}function Xf(t,e,n,r,i){var o=this;return(o=Pf.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Su=!1,o}function $f(t,e,n,r,i){var o=this;return(o=Uf.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Jf(t,e,n,r,i,o){this._n=t,this.ru=n,this.ou=r,this.au=i,this.listener=o,this.state=0,this.cu=0,this.uu=null,this.stream=null,this.gs=new Ca(t,e)}function Zf(t,e){this.su=t,this.iu=e}function tl(t,e){this.su=t,this.iu=e,this.type="FirstParty",this.user=fc.ei}function el(t){var e=this;this.Zc=null,this.currentUser=fc.UNAUTHENTICATED,this.tu=!1,this.eu=0,this.Hc=null,this.forceRefresh=!1,this.Zc=function(){e.eu++,e.currentUser=e.nu(),e.tu=!0,e.Hc&&e.Hc(e.currentUser)},this.eu=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Zc):(this.Zc(null),t.get().then((function(t){e.auth=t,e.Zc&&e.auth.addAuthTokenListener(e.Zc)}),(function(){})))}function nl(){this.Hc=null}function rl(t,e){this.key=t,this.Gc=e}function il(){this.Mc=new ho(Mf.Oc),this.Lc=new ho(Mf.Bc)}function ol(t){return u(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:if(!dl(t))return[3,4];e=0,n=t.Zu,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function sl(t){return u(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:e=0,n=t.Zu,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function ul(t){return u(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return e=t,Cr("RemoteStore","RemoteStore shutting down."),e.Xu.add(5),[4,sl(e)];case 1:return n.sent(),e.th.Si(),e.nh.set("Unknown"),[2]}}))}))}function al(t,e){var n=t;n.Ju.has(e.targetId)||(n.Ju.set(e.targetId,e),pl(n)?ll(n):Tl(n).lu()&&hl(n,e))}function cl(t,e){var n=t,r=Tl(n);n.Ju.delete(e),r.lu()&&fl(n,e),0===n.Ju.size&&(r.lu()?r.du():dl(n)&&n.nh.set("Unknown"))}function hl(t,e){t.sh.Ee(e.targetId),Tl(t).bu(e)}function fl(t,e){t.sh.Ee(e),Tl(t).vu(e)}function ll(t){t.sh=new Oo({Be:function(e){return t.Hu.Be(e)},qe:function(e){return t.Ju.get(e)||null}}),Tl(t).start(),t.nh.Uu()}function pl(t){return dl(t)&&!Tl(t).hu()&&0<t.Ju.size}function dl(t){return 0===t.Xu.size}function vl(t){t.sh=void 0}function yl(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o;return a(this,(function(s){switch(s.label){case 0:if(t.nh.set("Online"),!(e instanceof Do&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.Ju.has(o)?[4,t.Hu.ih(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.Ju.delete(o),t.sh.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Cr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,gl(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof No?t.sh.pe(e):e instanceof So?t.sh.$e(e):t.sh.Se(e),n.isEqual(Ui.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Af(t.Gu)];case 8:return i=s.sent(),0<=n.L(i)?[4,(h=n,(f=(c=t).sh.Me(h)).Gt.forEach((function(t,e){var n;0<t.resumeToken.O()&&(n=c.Ju.get(e))&&c.Ju.set(e,n.st(t.resumeToken,h))})),f.zt.forEach((function(t){var e,n=c.Ju.get(t);n&&(c.Ju.set(t,n.st(_i.B,n.et)),fl(c,t),e=new Zi(n.target,t,1,n.sequenceNumber),hl(c,e))})),c.Hu.rh(f))]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Cr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,gl(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}var c,h,f}))}))}function gl(t,e,n){return u(this,void 0,void 0,(function(){var r=this;return a(this,(function(i){switch(i.label){case 0:if(!za(e))throw e;return t.Xu.add(1),[4,sl(t)];case 1:return i.sent(),t.nh.set("Offline"),n=n||function(){return Af(t.Gu)},t.os.Ds((function(){return u(r,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return Cr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Xu.delete(1),[4,ol(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function ml(t,e){return e().catch((function(n){return gl(t,n,e)}))}function wl(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o;return a(this,(function(s){switch(s.label){case 0:n=_l(e=t),r=0<e.Yu.length?e.Yu[e.Yu.length-1].batchId:-1,s.label=1;case 1:if(!(dl(e)&&e.Yu.length<10))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,(u=e.Gu,a=r,(c=u).persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===a&&(a=-1),c.vr.Lo(t,a)})))];case 3:return null===(i=s.sent())?(0===e.Yu.length&&n.du(),[3,7]):(r=i.batchId,function(t,e){t.Yu.push(e);var n=_l(t);n.lu()&&n.Du&&n.Cu(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,gl(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return bl(e)&&Il(e),[2]}var u,a,c}))}))}function bl(t){return dl(t)&&!_l(t).hu()&&0<t.Yu.length}function Il(t){_l(t).start()}function El(t,e){return u(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return n=t,e?(n.Xu.delete(2),[4,ol(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Xu.add(2),[4,sl(n)]);case 3:r.sent(),n.nh.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Tl(t){var e,n,r,i,o=this;return t.uh||(t.uh=(e=t.zu,n=t.os,r={yu:function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){return t.Ju.forEach((function(e,n){hl(t,e)})),[2]}))}))}.bind(null,t),Iu:function(t,e){return u(this,void 0,void 0,(function(){return a(this,(function(n){return vl(t),pl(t)?(t.nh.ju(e),ll(t)):t.nh.set("Unknown"),[2]}))}))}.bind(null,t),pu:yl.bind(null,t)},(i=e).ku(),new zf(n,i.ou,i.credentials,i.serializer,r)),t.Zu.push((function(e){return u(o,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return e?(t.uh.fu(),pl(t)?ll(t):t.nh.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.uh.stop()];case 2:n.sent(),vl(t),n.label=3;case 3:return[2]}}))}))}))),t.uh}function _l(t){var e,n,r,i,o=this;return t.hh||(t.hh=(e=t.zu,n=t.os,r={yu:function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){return _l(t).$u(),[2]}))}))}.bind(null,t),Iu:function(t,e){return u(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return e&&_l(t).Du?[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return eo(r=e.code)&&r!==xr.ABORTED?(n=t.Yu.shift(),_l(t).fu(),[4,ml(t,(function(){return t.Hu.ah(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,wl(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return bl(t)&&Il(t),[2]}}))}))}.bind(null,t),Fu:function(t){return u(this,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(o){for(e=_l(t),n=0,r=t.Yu;n<r.length;n++)i=r[n],e.Cu(i.mutations);return[2]}))}))}.bind(null,t),Nu:function(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return r=t.Yu.shift(),i=Sc.from(r,e,n),[4,ml(t,(function(){return t.Hu.oh(i)}))];case 1:return o.sent(),[4,wl(t)];case 2:return o.sent(),[2]}}))}))}.bind(null,t)},(i=e).ku(),new Hf(n,i.ou,i.credentials,i.serializer,r)),t.Zu.push((function(e){return u(o,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return e?(t.hh.fu(),[4,wl(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.hh.stop()];case 3:n.sent(),0<t.Yu.length&&(Cr("RemoteStore","Stopping write stream with "+t.Yu.length+" pending writes"),t.Yu=[]),n.label=4;case 4:return[2]}}))}))}))),t.hh}var Al=function(t){this.key=t},Nl=function(t){this.key=t},Sl=(Object.defineProperty(kl.prototype,"mh",{get:function(){return this.lh},enumerable:!1,configurable:!0}),kl.prototype.Th=function(t,e){var n=this,r=e?e.Eh:new Eo,i=e?e.wh:this.wh,o=e?e.Qt:this.Qt,s=i,u=!1,a=ju(this.query)&&i.size===this.query.limit?i.last():null,c=Gu(this.query)&&i.size===this.query.limit?i.first():null;if(t.ut((function(t,e){var h=i.get(t),f=(f=e instanceof ku?e:null)&&(ta(n.query,f)?f:null),l=!!h&&n.Qt.has(h.key),p=!!f&&(f.Ye||n.Qt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Ih(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&0<n.dh(f,a)||c&&n.dh(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(o=f?(s=s.add(f),p?o.add(t):o.delete(t)):(s=s.delete(t),o.delete(t)))})),ju(this.query)||Gu(this.query))for(;s.size>this.query.limit;){var h=ju(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key);r.track({type:1,doc:h})}return{wh:s,Eh:r,Ah:u,Qt:o}},kl.prototype.Ih=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},kl.prototype.gr=function(t,e,n){var r=this,i=this.wh;this.wh=t.wh,this.Qt=t.Qt;var o=t.Eh.qt();o.sort((function(t,e){return i=t.type,o=e.type,n(i)-n(o)||r.dh(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Mr()}}var i,o})),this.Rh(n);var s=e?this.Ph():[],u=0===this.fh.size&&this.Zt?1:0,a=u!==this._h;return this._h=u,0!==o.length||a?{snapshot:new To(this.query,t.wh,i,o,t.Qt,0==u,a,!1),gh:s}:{gh:s}},kl.prototype.Us=function(t){return this.Zt&&"Offline"===t?(this.Zt=!1,this.gr({wh:this.wh,Eh:new Eo,Qt:this.Qt,Ah:!1},!1)):{gh:[]}},kl.prototype.yh=function(t){return!this.lh.has(t)&&!!this.wh.has(t)&&!this.wh.get(t).Ye},kl.prototype.Rh=function(t){var e=this;t&&(t.te.forEach((function(t){return e.lh=e.lh.add(t)})),t.ee.forEach((function(t){})),t.ne.forEach((function(t){return e.lh=e.lh.delete(t)})),this.Zt=t.Zt)},kl.prototype.Ph=function(){var t=this;if(!this.Zt)return[];var e=this.fh;this.fh=wo(),this.wh.forEach((function(e){t.yh(e.key)&&(t.fh=t.fh.add(e.key))}));var n=[];return e.forEach((function(e){t.fh.has(e)||n.push(new Nl(e))})),this.fh.forEach((function(t){e.has(t)||n.push(new Al(t))})),n},kl.prototype.Vh=function(t){this.lh=t.kc,this.fh=wo();var e=this.Th(t.documents);return this.gr(e,!0)},kl.prototype.ph=function(){return To.Kt(this.query,this.wh,this.Qt,0===this._h)},kl),Dl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},xl=function(t){this.key=t,this.bh=!1},Ol=(Object.defineProperty(Rl.prototype,"Wh",{get:function(){return!0===this.Qh},enumerable:!1,configurable:!0}),Rl);function Rl(t,e,n,r,i,o){this.Gu=t,this.Sh=e,this.Dh=n,this.Ch=r,this.currentUser=i,this.Nh=o,this.Fh={},this.$h=new Ci(Ju,$u),this.xh=new Map,this.kh=[],this.Mh=new ro(Yr.i),this.Oh=new Map,this.Lh=new Vf,this.Bh={},this.qh=new Map,this.Uh=nf.Ta(),this.onlineState="Unknown",this.Qh=void 0}function kl(t,e){this.query=t,this.lh=e,this._h=null,this.Zt=!1,this.fh=wo(),this.Qt=wo(),this.dh=ea(t),this.wh=new Io(this.dh)}function Ll(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o,s,c,h,f;return a(this,(function(l){switch(l.label){case 0:return t.jh=function(e,n,r){return function(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o,s;return a(this,(function(u){switch(u.label){case 0:return(i=e.view.Th(n)).Ah?[4,xf(t.Gu,e.query,!1).then((function(t){var n=t.documents;return e.view.Th(n,i)}))]:[3,2];case 1:i=u.sent(),u.label=2;case 2:return o=r&&r.Gt.get(e.targetId),s=e.view.gr(i,t.Wh,o),[2,(jl(t,e.targetId,s.gh),s.snapshot)]}}))}))}(t,e,n,r)},[4,xf(t.Gu,e,!0)];case 1:return i=l.sent(),o=new Sl(e,i.kc),s=o.Th(i.documents),c=Ao.Xt(n,r&&"Offline"!==t.onlineState),h=o.gr(s,t.Wh,c),jl(t,n,h.gh),f=new Dl(e,n,o),[2,(t.$h.set(e,f),t.xh.has(n)?t.xh.get(n).push(e):t.xh.set(n,[e]),h.snapshot)]}}))}))}function Cl(t,e){return u(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:n=t,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Nf(n.Gu,e)];case 2:return r=i.sent(),e.Gt.forEach((function(t,e){var r=n.Oh.get(e);r&&(Fr(t.te.size+t.ee.size+t.ne.size<=1),0<t.te.size?r.bh=!0:0<t.ee.size?Fr(r.bh):0<t.ne.size&&(Fr(r.bh),r.bh=!1))})),[4,Bl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Rf(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function Pl(t,e,n){var r,i=t;(i.Wh&&0===n||!i.Wh&&1===n)&&(r=[],i.$h.forEach((function(t,n){var i=n.view.Us(e);i.snapshot&&r.push(i.snapshot)})),function(t,e){var n=t;n.onlineState=e;var r=!1;n.Ls.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Us(e)&&(r=!0)})),r&&cc(n)}(i.Dh,e),r.length&&i.Fh.pu(r),i.onlineState=e,i.Wh&&i.Ch.ji(e))}function Ul(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:r=t,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,(s=r.Gu,u=e,(a=s).persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var e;return a.vr.Mo(t,u).next((function(n){return Fr(null!==n),e=n.keys(),a.vr.Qo(t,n)})).next((function(){return a.vr.Go(t)})).next((function(){return a.$c.$r(t,e)}))})))];case 2:return i=o.sent(),Ml(r,e,n),Vl(r,e),r.Ch.xi(e,"rejected",n),[4,Bl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Rf(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}var s,u,a}))}))}function Vl(t,e){(t.qh.get(e)||[]).forEach((function(t){t.resolve()})),t.qh.delete(e)}function Ml(t,e,n){var r,i=t,o=i.Bh[i.currentUser.Zs()];o&&((r=o.get(e))&&(n?r.reject(n):r.resolve(),o=o.remove(e)),i.Bh[i.currentUser.Zs()]=o)}function Fl(t,e,n){void 0===n&&(n=null),t.Ch.Li(e);for(var r=0,i=t.xh.get(e);r<i.length;r++){var o=i[r];t.$h.delete(o),n&&t.Fh.Kh(o,n)}t.xh.delete(e),t.Wh&&t.Lh.Wc(e).forEach((function(e){t.Lh.zo(e)||ql(t,e)}))}function ql(t,e){var n=t.Mh.get(e);null!==n&&(cl(t.Sh,n),t.Mh=t.Mh.remove(e),t.Oh.delete(n),Gl(t))}function jl(t,e,n){for(var r,i,o=0,s=n;o<s.length;o++){var u=s[o];u instanceof Al?(t.Lh.Fa(u.key,e),r=t,void 0,i=u.key,r.Mh.get(i)||(Cr("SyncEngine","New document in limbo: "+i),r.kh.push(i),Gl(r))):u instanceof Nl?(Cr("SyncEngine","Document no longer in limbo: "+u.key),t.Lh.xa(u.key,e),t.Lh.zo(u.key)||ql(t,u.key)):Mr()}}function Gl(t){for(;0<t.kh.length&&t.Mh.size<t.Nh;){var e=t.kh.shift(),n=t.Uh.next();t.Oh.set(n,new xl(e)),t.Mh=t.Mh.rt(e,n),al(t.Sh,new Zi(Ku(qu(e.path)),n,2,dc.oi))}}function Bl(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s;return a(this,(function(c){switch(c.label){case 0:return i=[],o=[],s=[],(r=t).$h.m()?[3,3]:(r.$h.forEach((function(t,u){s.push(r.jh(u,e,n).then((function(t){var e;t&&(r.Wh&&r.Ch.Ui(u.targetId,t.fromCache?"not-current":"current"),i.push(t),e=kc.Gr(u.targetId,t),o.push(e))})))})),[4,Promise.all(s)]);case 1:return c.sent(),r.Fh.pu(i),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,u,c,h,f;return a(this,(function(a){switch(a.label){case 0:n=t,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return Pa.forEach(e,(function(e){return Pa.forEach(e.jr,(function(r){return n.persistence.Co.Fa(t,e.targetId,r)})).next((function(){return Pa.forEach(e.Kr,(function(r){return n.persistence.Co.xa(t,e.targetId,r)}))}))}))}))];case 2:return a.sent(),[3,4];case 3:if(!za(r=a.sent()))throw r;return Cr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=o[i],u=s.targetId,s.fromCache||(c=n.Dc.get(u),h=c.et,f=c.it(h),n.Dc=n.Dc.rt(u,f));return[2]}}))}))}(r.Gu,o)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function zl(t,e){return u(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return(n=t).currentUser.isEqual(e)?[3,3]:(Cr("SyncEngine","User change. New user:",e.Zs()),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(s){switch(s.label){case 0:return r=(n=t).vr,i=n.$c,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n.vr.qo(t).next((function(s){return o=s,r=n.persistence.Ic(e),i=new Rc(n.Fc,r,n.persistence.Pc()),r.qo(t)})).next((function(e){for(var n=[],r=[],s=wo(),u=0,a=o;u<a.length;u++){var c=a[u];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];r.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];s=s.add(m.key)}}return i.$r(t,s).next((function(t){return{Gh:t,zh:n,Hh:r}}))}))}))];case 1:return o=s.sent(),[2,(n.vr=r,n.$c=i,n.Sc.xc(n.$c),o)]}}))}))}(n.Gu,e)]);case 1:return r=i.sent(),n.currentUser=e,(o=n).qh.forEach((function(t){t.forEach((function(t){t.reject(new Or(xr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.qh.clear(),n.Ch.Wi(e,r.zh,r.Hh),[4,Bl(n,r.Gh)];case 2:i.sent(),i.label=3;case 3:return[2]}var o}))}))}function Hl(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o;return a(this,(function(s){switch(s.label){case 0:return[4,(u=(i=t).Gu,a=e,h=(c=u).vr,c.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return h.Oo(t,a).next((function(e){return e?c.$c.$r(t,e):Pa.resolve(null)}))})))];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,wl(i.Sh)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ml(i,e,r||null),Vl(i,e),i.Gu.vr.jo(e)):Mr(),s.label=4;case 4:return[4,Bl(i,o)];case 5:return s.sent(),[3,7];case 6:Cr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}var u,a,c,h}))}))}function Ql(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,u,c,h;return a(this,(function(a){switch(a.label){case 0:return Xl(n=t),$l(n),!0!==e||!0===n.Qh?[3,3]:(r=n.Ch.Di(),[4,Kl(n,r.A())]);case 1:return i=a.sent(),n.Qh=!0,[4,El(n.Sh,!0)];case 2:for(a.sent(),o=0,s=i;o<s.length;o++)u=s[o],al(n.Sh,u);return[3,7];case 3:return!1!==e||!1===n.Qh?[3,7]:(c=[],h=Promise.resolve(),n.xh.forEach((function(t,e){n.Ch.Bi(e)?c.push(e):h=h.then((function(){return Fl(n,e),Df(n.Gu,e,!0)})),cl(n.Sh,e)})),[4,h]);case 4:return a.sent(),[4,Kl(n,c)];case 5:return a.sent(),(f=n).Oh.forEach((function(t,e){cl(f.Sh,e)})),f.Lh.jc(),f.Oh=new Map,f.Mh=new ro(Yr.i),n.Qh=!1,[4,El(n.Sh,!1)];case 6:a.sent(),a.label=7;case 7:return[2]}var f}))}))}function Kl(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,c,h,f,l,p,d,v,y,g;return a(this,(function(m){switch(m.label){case 0:n=t,r=[],i=[],o=0,s=e,m.label=1;case 1:return o<s.length?(c=s[o],h=void 0,(f=n.xh.get(c))&&0!==f.length?[4,Sf(n.Gu,Ku(f[0]))]:[3,7]):[3,13];case 2:h=m.sent(),l=0,p=f,m.label=3;case 3:return l<p.length?(d=p[l],v=n.$h.get(d),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return[4,xf((n=t).Gu,e.query,!0)];case 1:return r=o.sent(),i=e.view.Vh(r),[2,(n.Wh&&jl(n,e.targetId,i.gh),i)]}}))}))}(n,v)]):[3,6];case 4:(y=m.sent()).snapshot&&i.push(y.snapshot),m.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,Of(n.Gu,c)];case 8:return g=m.sent(),[4,Sf(n.Gu,g)];case 9:return h=m.sent(),[4,Ll(n,Wl(g),c,!1)];case 10:m.sent(),m.label=11;case 11:r.push(h),m.label=12;case 12:return o++,[3,1];case 13:return[2,(n.Fh.pu(i),r)]}}))}))}function Wl(t){return Fu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Yl(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o,s;return a(this,(function(u){switch(u.label){case 0:return(i=t).Qh?(Cr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.xh.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(a=i.Gu,c=a.Fc,a.persistence.runTransaction("Get new document changes","readonly",(function(t){return c.ia(t,a.Nc)})).then((function(t){var e=t.ra,n=t.readTime;return a.Nc=n,e})))];case 3:return o=u.sent(),s=_o.Jt(e,"current"===n),[4,Bl(i,o,s)];case 4:return u.sent(),[3,8];case 5:return[4,Df(i.Gu,e,!0)];case 6:return u.sent(),Fl(i,e,r),[3,8];case 7:Mr(),u.label=8;case 8:return[2]}var a,c}))}))}function Xl(t){var e=t;return e.Sh.Hu.rh=Cl.bind(null,e),e.Sh.Hu.Be=function(t,e){var n=t,r=n.Oh.get(e);if(r&&r.bh)return wo().add(r.key);var i=wo(),o=n.xh.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.$h.get(a);i=i.xt(c.view.mh)}return i}.bind(null,e),e.Sh.Hu.ih=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:return(r=t).Ch.Ui(e,"rejected",n),i=r.Oh.get(e),(o=i&&i.key)?(s=(s=new ro(Yr.i)).rt(o,new Lu(o,Ui.min())),u=wo().add(o),c=new _o(Ui.min(),new Map,new ho(Ii),s,u),[4,Cl(r,c)]):[3,2];case 1:return a.sent(),r.Mh=r.Mh.remove(o),r.Oh.delete(e),Gl(r),[3,4];case 2:return[4,Df(r.Gu,e,!1).then((function(){return Fl(r,e,n)})).catch(Rf)];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))}.bind(null,e),e.Fh.pu=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.Ls.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(s)&&(r=!0);a.Os=s}}r&&cc(n)}.bind(null,e.Dh),e.Fh.Kh=function(t,e,n){var r=t,i=r.Ls.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.Ls.delete(e)}.bind(null,e.Dh),e}function $l(t){var e=t;return e.Sh.Hu.oh=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:n=t,r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,_f(n.Gu,e)];case 2:return i=o.sent(),Ml(n,r,null),Vl(n,r),n.Ch.xi(r,"acknowledged"),[4,Bl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Rf(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}.bind(null,e),e.Sh.Hu.ah=Ul.bind(null,e),e}var Jl,Zl=(ip.prototype.xc=function(t){this.Yh=t},ip.prototype.Or=function(t,e,r,i){var o=this;return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.rn.length||1===e.rn.length&&e.rn[0].field.p())||r.isEqual(Ui.min())?this.Jh(t,e):this.Yh.$r(t,i).next((function(s){var u=o.Xh(e,s);return(ju(e)||Gu(e))&&o.Ah(e.on,u,i,r)?o.Jh(t,e):(Lr()<=n.DEBUG&&Cr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Zu(e)),o.Yh.Or(t,e,r).next((function(t){return u.forEach((function(e){t=t.rt(e.key,e)})),t})))}))},ip.prototype.Xh=function(t,e){var n=new ho(ea(t));return e.forEach((function(e,r){r instanceof ku&&ta(t,r)&&(n=n.add(r))})),n},ip.prototype.Ah=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.L(r))},ip.prototype.Jh=function(t,e){return Lr()<=n.DEBUG&&Cr("IndexFreeQueryEngine","Using full collection scan to execute query:",Zu(e)),this.Yh.Or(t,e,Ui.min())},ip),tp=(rp.prototype.$o=function(t){return Pa.resolve(0===this.vr.length)},rp.prototype.xo=function(t,e,n,r){var i=this.Zh;this.Zh++,0<this.vr.length&&this.vr[this.vr.length-1];var o=new Nc(i,e,n,r);this.vr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.tl=this.tl.add(new Mf(a.key,i)),this.Sr.ko(t,a.key.path.h())}return Pa.resolve(o)},rp.prototype.Mo=function(t,e){return Pa.resolve(this.el(e))},rp.prototype.Lo=function(t,e){var n=e+1,r=this.nl(n),i=r<0?0:r;return Pa.resolve(this.vr.length>i?this.vr[i]:null)},rp.prototype.Bo=function(){return Pa.resolve(0===this.vr.length?-1:this.Zh-1)},rp.prototype.qo=function(t){return Pa.resolve(this.vr.slice())},rp.prototype.Cr=function(t,e){var n=this,r=new Mf(e,0),i=new Mf(e,Number.POSITIVE_INFINITY),o=[];return this.tl.Nt([r,i],(function(t){var e=n.el(t.Gc);o.push(e)})),Pa.resolve(o)},rp.prototype.Mr=function(t,e){var n=this,r=new ho(Ii);return e.forEach((function(t){var e=new Mf(t,0),i=new Mf(t,Number.POSITIVE_INFINITY);n.tl.Nt([e,i],(function(t){r=r.add(t.Gc)}))})),Pa.resolve(this.sl(r))},rp.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,i=n;Yr.F(i)||(i=i.child(""));var o=new Mf(new Yr(i),0),s=new ho(Ii);return this.tl.Ft((function(t){var e=t.key.path;return!!n.T(e)&&(e.length===r&&(s=s.add(t.Gc)),!0)}),o),Pa.resolve(this.sl(s))},rp.prototype.sl=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.el(t);null!==r&&n.push(r)})),n},rp.prototype.Qo=function(t,e){var n=this;Fr(0===this.il(e.batchId,"removed")),this.vr.shift();var r=this.tl;return Pa.forEach(e.mutations,(function(i){var o=new Mf(i.key,e.batchId);return r=r.delete(o),n.Co.Ko(t,i.key)})).next((function(){n.tl=r}))},rp.prototype.jo=function(t){},rp.prototype.zo=function(t,e){var n=new Mf(e,0),r=this.tl.$t(n);return Pa.resolve(e.isEqual(r&&r.key))},rp.prototype.Go=function(t){return this.vr.length,Pa.resolve()},rp.prototype.il=function(t,e){return this.nl(t)},rp.prototype.nl=function(t){return 0===this.vr.length?0:t-this.vr[0].batchId},rp.prototype.el=function(t){var e=this.nl(t);return e<0||e>=this.vr.length?null:this.vr[e]},rp),ep=(np.prototype.Tr=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.rl(e);return this.docs=this.docs.rt(r,{Zo:e,size:s,readTime:n}),this.size+=s-o,this.Sr.ko(t,r.path.h())},np.prototype.Ir=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},np.prototype.Ar=function(t,e){var n=this.docs.get(e);return Pa.resolve(n?n.Zo:null)},np.prototype.getEntries=function(t,e){var n=this,r=lo;return e.forEach((function(t){var e=n.docs.get(t);r=r.rt(t,e?e.Zo:null)})),Pa.resolve(r)},np.prototype.Or=function(t,e,n){for(var r=yo,i=new Yr(e.path.child("")),o=this.docs._t(i);o.It();){var s=o.Et(),u=s.key,a=s.value,c=a.Zo,h=a.readTime;if(!e.path.T(u.path))break;h.L(n)<=0||c instanceof ku&&ta(e,c)&&(r=r.rt(c.key,c))}return Pa.resolve(r)},np.prototype.ol=function(t,e){return Pa.forEach(this.docs,(function(t){return e(t)}))},np.prototype.aa=function(t){return new np.ca(this)},np.prototype.ha=function(t){return Pa.resolve(this.size)},np);function np(t,e){this.Sr=t,this.rl=e,this.docs=new ro(Yr.i),this.size=0}function rp(t,e){this.Sr=t,this.Co=e,this.vr=[],this.Zh=1,this.tl=new ho(Mf.Oc)}function ip(){}function op(t){var e=this;return(e=Jl.call(this)||this).la=t,e}ep.ca=(s(op,Jl=Dc),op.prototype.gr=function(t){var e=this,n=[];return this.dr.forEach((function(r,i){i?n.push(e.la.Tr(t,i,e.readTime)):e.la.Ir(r)})),Pa.$n(n)},op.prototype.Rr=function(t,e){return this.la.Ar(t,e)},op.prototype.Pr=function(t,e){return this.la.getEntries(t,e)},op);var sp,up,ap=(Ap.prototype.De=function(t,e){return this.al.forEach((function(t,n){return e(n)})),Pa.resolve()},Ap.prototype.Ra=function(t){return Pa.resolve(this.lastRemoteSnapshotVersion)},Ap.prototype.Pa=function(t){return Pa.resolve(this.cl)},Ap.prototype.Ea=function(t){return this.highestTargetId=this.hl.next(),Pa.resolve(this.highestTargetId)},Ap.prototype.ga=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.cl&&(this.cl=e),Pa.resolve()},Ap.prototype.Va=function(t){this.al.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.hl=new nf(e),this.highestTargetId=e),t.sequenceNumber>this.cl&&(this.cl=t.sequenceNumber)},Ap.prototype.ya=function(t,e){return this.Va(e),this.targetCount+=1,Pa.resolve()},Ap.prototype.ba=function(t,e){return this.Va(e),Pa.resolve()},Ap.prototype.va=function(t,e){return this.al.delete(e.target),this.ul.Wc(e.targetId),--this.targetCount,Pa.resolve()},Ap.prototype.Vo=function(t,e,n){var r=this,i=0,o=[];return this.al.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.al.delete(s),o.push(r.Sa(t,u.targetId)),i++)})),Pa.$n(o).next((function(){return i}))},Ap.prototype.Da=function(t){return Pa.resolve(this.targetCount)},Ap.prototype.Ca=function(t,e){var n=this.al.get(e)||null;return Pa.resolve(n)},Ap.prototype.Na=function(t,e,n){return this.ul.qc(e,n),Pa.resolve()},Ap.prototype.$a=function(t,e,n){this.ul.Qc(e,n);var r=this.persistence.Co,i=[];return r&&e.forEach((function(e){i.push(r.Ko(t,e))})),Pa.$n(i)},Ap.prototype.Sa=function(t,e){return this.ul.Wc(e),Pa.resolve()},Ap.prototype.ka=function(t,e){var n=this.ul.Kc(e);return Pa.resolve(n)},Ap.prototype.zo=function(t,e){return Pa.resolve(this.ul.zo(e))},Ap),cp=(_p.prototype.start=function(){return Promise.resolve()},_p.prototype.Si=function(){return this.qa=!1,Promise.resolve()},Object.defineProperty(_p.prototype,"Ti",{get:function(){return this.qa},enumerable:!1,configurable:!0}),_p.prototype.nc=function(){},_p.prototype.sc=function(){},_p.prototype.Pc=function(){return this.Sr},_p.prototype.Ic=function(t){var e=this.ll[t.Zs()];return e||(e=new tp(this.Sr,this.Co),this.ll[t.Zs()]=e),e},_p.prototype.Ac=function(){return this.Ha},_p.prototype.Rc=function(){return this.br},_p.prototype.runTransaction=function(t,e,n){var r=this;Cr("MemoryPersistence","Starting transaction:",t);var i=new hp(this.Ba.next());return this.Co.fl(),n(i).next((function(t){return r.Co.dl(i).next((function(){return t}))})).Nn().then((function(t){return i.pr(),t}))},_p.prototype.wl=function(t,e){return Pa.xn(Object.values(this.ll).map((function(n){return function(){return n.zo(t,e)}})))},_p),hp=(s(Tp,up=Oc),Tp),fp=(Ep.El=function(t){return new Ep(t)},Object.defineProperty(Ep.prototype,"Il",{get:function(){if(this.Tl)return this.Tl;throw Mr()},enumerable:!1,configurable:!0}),Ep.prototype.Fa=function(t,e,n){return this.ml.Fa(n,e),this.Il.delete(n.toString()),Pa.resolve()},Ep.prototype.xa=function(t,e,n){return this.ml.xa(n,e),this.Il.add(n.toString()),Pa.resolve()},Ep.prototype.Ko=function(t,e){return this.Il.add(e.toString()),Pa.resolve()},Ep.prototype.removeTarget=function(t,e){var n=this;this.ml.Wc(e.targetId).forEach((function(t){return n.Il.add(t.toString())}));var r=this.persistence.Ac();return r.ka(t,e.targetId).next((function(t){t.forEach((function(t){return n.Il.add(t.toString())}))})).next((function(){return r.va(t,e)}))},Ep.prototype.fl=function(){this.Tl=new Set},Ep.prototype.dl=function(t){var e=this,n=this.persistence.Rc().aa();return Pa.forEach(this.Il,(function(r){var i=Yr.D(r);return e.Al(t,i).next((function(t){t||n.Ir(i)}))})).next((function(){return e.Tl=null,n.apply(t)}))},Ep.prototype.vc=function(t,e){var n=this;return this.Al(t,e).next((function(t){t?n.Il.delete(e.toString()):n.Il.add(e.toString())}))},Ep.prototype._l=function(t){return 0},Ep.prototype.Al=function(t,e){var n=this;return Pa.xn([function(){return Pa.resolve(n.ml.zo(e))},function(){return n.persistence.Ac().zo(t,e)},function(){return n.persistence.wl(t,e)}])},Ep),lp=(Ip.prototype.yu=function(t){this.gl=t},Ip.prototype.Iu=function(t){this.yl=t},Ip.prototype.onMessage=function(t){this.Vl=t},Ip.prototype.close=function(){this.Pl()},Ip.prototype.send=function(t){this.Rl(t)},Ip.prototype.pl=function(){this.gl()},Ip.prototype.bl=function(t){this.yl(t)},Ip.prototype.vl=function(t){this.Vl(t)},Ip),pp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},dp=(bp.prototype.Mu=function(t,e,n,r){var i=this.Nl(t,e);Cr("RestConnection","Sending: ",i,n);var o={};return this.Fl(o,r),this.$l(t,i,o,n).then((function(t){return Cr("RestConnection","Received: ",t),t}),(function(e){throw Ur("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},bp.prototype.Ou=function(t,e,n,r){return this.Mu(t,e,n,r)},bp.prototype.Fl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.22.1",t["Content-Type"]="text/plain",e)for(var n in e.zc)e.zc.hasOwnProperty(n)&&(t[n]=e.zc[n])},bp.prototype.Nl=function(t,e){var n=pp[t];return this.Dl+"/v1/"+e+":"+n},s(wp,sp=bp),wp.prototype.$l=function(t,e,n,r){return new Promise((function(i,o){var s=new Ar;s.listenOnce(Tr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case Er.NO_ERROR:var e=s.getResponseJson();Cr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Er.TIMEOUT:Cr("Connection",'RPC "'+t+'" timed out'),o(new Or(xr.DEADLINE_EXCEEDED,"Request time out"));break;case Er.HTTP_ERROR:var n,r,u=s.getStatus();Cr("Connection",'RPC "'+t+'" failed with status:',u,"response text:",s.getResponseText()),0<u?(n=s.getResponseJson().error)&&n.status&&n.message?(a=n.status.toLowerCase().replace("_","-"),r=0<=Object.values(xr).indexOf(a)?a:xr.UNKNOWN,o(new Or(r,n.message))):o(new Or(xr.UNKNOWN,"Server responded with status "+s.getStatus())):o(new Or(xr.UNAVAILABLE,"Connection failed."));break;default:Mr()}}finally{Cr("Connection",'RPC "'+t+'" completed.')}var a}));var u=JSON.stringify(r);s.send(e,"POST",u,n,15)}))},wp.prototype.Vu=function(t,e){var n,r,i=[this.Dl,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Ir(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.U.projectId+"/databases/"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Fl(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=g().indexOf("Electron/")||0<=(r=g()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=g().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){c.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))}Cr("Connection","Creating WebChannel: "+u,s);var c=o.createWebChannel(u,s),h=!1,f=!1,l=new lp({Rl:function(t){f?Cr("Connection","Not sending because WebChannel is closed:",t):(h||(Cr("Connection","Opening WebChannel transport."),c.open(),h=!0),Cr("Connection","WebChannel sending:",t),c.send(t))},Pl:function(){return c.close()}});return a(_r.EventType.OPEN,(function(){f||Cr("Connection","WebChannel transport opened.")})),a(_r.EventType.CLOSE,(function(){f||(f=!0,Cr("Connection","WebChannel transport closed"),l.bl())})),a(_r.EventType.ERROR,(function(t){f||(f=!0,Ur("Connection","WebChannel transport errored:",t),l.bl(new Or(xr.UNAVAILABLE,"The operation could not be completed")))})),a(_r.EventType.MESSAGE,(function(t){var e,n,r,i,o,s;f||(Fr(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Cr("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=$i[i];if(void 0!==t)return no(t)}(),s=r.message,void 0===o&&(o=xr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.bl(new Or(o,s)),c.close()):(Cr("Connection","WebChannel received:",n),l.vl(n)))})),setTimeout((function(){l.pl()}),0),l},wp),vp=(mp.prototype.eh=function(t){this.Ll.push(t)},mp.prototype.Si=function(){window.removeEventListener("online",this.xl),window.removeEventListener("offline",this.Ml)},mp.prototype.Bl=function(){window.addEventListener("online",this.xl),window.addEventListener("offline",this.Ml)},mp.prototype.kl=function(){Cr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ll;t<e.length;t++)(0,e[t])(0)},mp.prototype.Ol=function(){Cr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ll;t<e.length;t++)(0,e[t])(1)},mp.On=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},mp),yp=(gp.prototype.eh=function(t){},gp.prototype.Si=function(){},gp);function gp(){}function mp(){var t=this;this.xl=function(){return t.kl()},this.Ml=function(){return t.Ol()},this.Ll=[],this.Bl()}function wp(t){var e=this;return(e=sp.call(this,t)||this).forceLongPolling=t.forceLongPolling,e}function bp(t){this.Sl=t,this.U=t.U;var e=t.ssl?"https":"http";this.Dl=e+"://"+t.host,this.Cl="projects/"+this.U.projectId+"/databases/"+this.U.database+"/documents"}function Ip(t){this.Rl=t.Rl,this.Pl=t.Pl}function Ep(t){this.persistence=t,this.ml=new Vf,this.Tl=null}function Tp(t){var e=this;return(e=up.call(this)||this).Ma=t,e}function _p(t){var e=this;this.ll={},this.Ba=new dc(0),this.qa=!1,this.qa=!0,this.Co=t(this),this.Ha=new ap(this),this.Sr=new Oh,this.br=new ep(this.Sr,(function(t){return e.Co._l(t)}))}function Ap(t){this.persistence=t,this.al=new Ci(Ki,Wi),this.lastRemoteSnapshotVersion=Ui.min(),this.highestTargetId=0,this.cl=0,this.ul=new Vf,this.targetCount=0,this.hl=nf.ma()}function Np(t){return new ss(t,!0)}var Sp,Dp,xp,Op,Rp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",kp=(Kp.prototype.initialize=function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this.Ch=this.ql(t),this.persistence=this.Ul(t),[4,this.persistence.start()];case 1:return e.sent(),this.Ql=this.Wl(t),this.Gu=this.jl(t),[2]}}))}))},Kp.prototype.Wl=function(t){return null},Kp.prototype.jl=function(t){return e=this.persistence,n=new Zl,r=t.Kl,new Ef(e,n,r);var e,n,r},Kp.prototype.Ul=function(t){if(t.persistenceSettings.Gl)throw new Or(xr.FAILED_PRECONDITION,Rp);return new cp(fp.El)},Kp.prototype.ql=function(t){return new Ac},Kp.prototype.terminate=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.Ql&&this.Ql.stop(),[4,this.Ch.Si()];case 1:return t.sent(),[4,this.persistence.Si()];case 2:return t.sent(),[2]}}))}))},Kp.prototype.clearPersistence=function(t,e){throw new Or(xr.FAILED_PRECONDITION,Rp)},Kp),Lp=(s(Qp,Op=kp),Qp.prototype.initialize=function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,Op.prototype.initialize.call(this,t)];case 1:return e.sent(),[4,function(t){return u(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){return n=(e=t).Fc,[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return n.oa(t)})).then((function(t){e.Nc=t}))]}))}))}(this.Gu)];case 2:return e.sent(),[4,this.zl.initialize(this,t)];case 3:return e.sent(),[4,$l(this.zl._i)];case 4:return e.sent(),[4,wl(this.zl.Sh)];case 5:return e.sent(),[2]}}))}))},Qp.prototype.Wl=function(t){var e=this.persistence.Co.do;return new Jc(e,t.os)},Qp.prototype.Ul=function(t){var e=If(t.Sl.U,t.Sl.persistenceKey),n=Np(t.Sl.U);return new pf(t.persistenceSettings.synchronizeTabs,e,t.clientId,Yc.oo(t.persistenceSettings.cacheSizeBytes),t.os,Ja(),Za(),n,this.Ch,t.persistenceSettings.La)},Qp.prototype.ql=function(t){return new Ac},Qp.prototype.clearPersistence=function(t,e){return function(t){return u(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return Ua.On()?(e=t+"main",[4,Ua.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(If(t,e))},s(Hp,xp=Qp),Hp.prototype.initialize=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:return[4,xp.prototype.initialize.call(this,t)];case 1:return r.sent(),e=this.zl._i,this.Ch instanceof _c?(this.Ch._i={tr:Hl.bind(null,e),er:Yl.bind(null,e),nr:function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,u,c,h,f,l,p;return a(this,(function(d){switch(d.label){case 0:if(!(r=Xl(t)).Qh)return[3,10];i=0,o=e,d.label=1;case 1:return i<o.length?(s=o[i],r.xh.has(s)?(Cr("SyncEngine","Adding an already active target "+s),[3,5]):[4,Of(r.Gu,s)]):[3,6];case 2:return u=d.sent(),[4,Sf(r.Gu,u)];case 3:return c=d.sent(),[4,Ll(r,Wl(u),c.targetId,!1)];case 4:d.sent(),al(r.Sh,c),d.label=5;case 5:return i++,[3,1];case 6:h=function(t){return a(this,(function(e){switch(e.label){case 0:return r.xh.has(t)?[4,Df(r.Gu,t,!1).then((function(){cl(r.Sh,t),Fl(r,t)})).catch(Rf)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,l=n,d.label=7;case 7:return f<l.length?(p=l[f],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}.bind(null,e),Vi:function(t){return t.Gu.persistence.Vi()}.bind(null,e)},[4,this.Ch.start()]):[3,3];case 2:r.sent(),r.label=3;case 3:return[4,this.persistence.ec((function(t){return u(n,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,Ql(this.zl._i,t)];case 1:return e.sent(),this.Ql&&(t&&!this.Ql.Ti?this.Ql.start(this.Gu):t||this.Ql.stop()),[2]}}))}))}))];case 4:return r.sent(),[2]}}))}))},Hp.prototype.ql=function(t){if(t.persistenceSettings.Gl&&t.persistenceSettings.synchronizeTabs){var e=Ja();if(!_c.On(e))throw new Or(xr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=If(t.Sl.U,t.Sl.persistenceKey);return new _c(e,t.os,n,t.clientId,t.Kl)}return new Ac},Hp),Cp=(zp.prototype.initialize=function(t,e){return u(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){switch(r.label){case 0:return this.Gu?[3,2]:(this.Gu=t.Gu,this.Ch=t.Ch,this.zu=this.Hl(e),this.Sh=this.Yl(e),this.Dh=this.Jl(e),this._i=this.Xl(e),this.Ch.fi=function(t){return Pl(n._i,t,1)},this.Sh.Hu.Zl=zl.bind(null,this._i),[4,El(this.Sh,this._i.Wh)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},zp.prototype.Jl=function(t){return new sc},zp.prototype.Hl=function(t){var e,n,r=Np(t.Sl.U),i=(e=t.Sl,new dp(e));return n=t.credentials,new Qf(n,i,r)},zp.prototype.Yl=function(t){var e=this;return new Lf(this.Gu,this.zu,t.os,(function(t){return Pl(e._i,t,0)}),new(vp.On()?vp:yp))},zp.prototype.Xl=function(t){return e=this.Gu,n=this.Sh,r=this.Dh,i=this.Ch,o=t.Kl,s=t.Nh,u=!t.persistenceSettings.Gl||!t.persistenceSettings.synchronizeTabs,a=new Ol(e,n,r,i,o,s),u&&(a.Qh=!0),a;var e,n,r,i,o,s,u,a},zp.prototype.terminate=function(){return ul(this.Sh)},zp),Pp=(Bp.prototype.next=function(t){this.observer.next&&this.t_(this.observer.next,t)},Bp.prototype.error=function(t){this.observer.error?this.t_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Bp.prototype.e_=function(){this.muted=!0},Bp.prototype.t_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},Bp),Up=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new Or(xr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(ii("FieldPath","string",e,t[e]),0===t[e].length)throw new Or(xr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.n_=new Wr(t)},Vp=(s(Gp,Dp=Up),Gp.documentId=function(){return new Gp(Wr.v().R())},Gp.prototype.isEqual=function(t){if(!(t instanceof Gp))throw vi("isEqual","FieldPath",1,t);return this.n_.isEqual(t.n_)},Gp),Mp=new RegExp("[~\\*/\\[\\]]"),Fp=function(t){this.s_=t},qp=(s(jp,Sp=Fp),jp.prototype.i_=function(t){if(2!==t.r_)throw 1===t.r_?t.o_(this.s_+"() can only appear at the top level of your update data"):t.o_(this.s_+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},jp.prototype.isEqual=function(t){return t instanceof jp},jp);function jp(){return null!==Sp&&Sp.apply(this,arguments)||this}function Gp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Dp.call(this,t)||this}function Bp(t){this.observer=t,this.muted=!1}function zp(){}function Hp(){return null!==xp&&xp.apply(this,arguments)||this}function Qp(t){var e=this;return(e=Op.call(this)||this).zl=t,e}function Kp(){}function Wp(t,e,n){return new gd({r_:3,a_:e.settings.a_,methodName:t.s_,c_:n},e.U,e.serializer,e.ignoreUndefinedProperties)}var Yp,Xp,$p,Jp,Zp=(s(vd,Jp=Fp),vd.prototype.i_=function(t){return new Xs(t.path,new Ps)},vd.prototype.isEqual=function(t){return t instanceof vd},vd),td=(s(dd,$p=Fp),dd.prototype.i_=function(t){var e=Wp(this,t,!0),n=this.u_.map((function(t){return Ad(t,e)})),r=new Us(n);return new Xs(t.path,r)},dd.prototype.isEqual=function(t){return this===t},dd),ed=(s(pd,Xp=Fp),pd.prototype.i_=function(t){var e=Wp(this,t,!0),n=this.u_.map((function(t){return Ad(t,e)})),r=new js(n);return new Xs(t.path,r)},pd.prototype.isEqual=function(t){return this===t},pd),nd=(s(ld,Yp=Fp),ld.prototype.i_=function(t){var e=new Hs(t.serializer,cs(t.serializer,this.h_));return new Xs(t.path,e)},ld.prototype.isEqual=function(t){return this===t},ld),rd=(Object.defineProperty(fd.prototype,"latitude",{get:function(){return this.l_},enumerable:!1,configurable:!0}),Object.defineProperty(fd.prototype,"longitude",{get:function(){return this.__},enumerable:!1,configurable:!0}),fd.prototype.isEqual=function(t){return this.l_===t.l_&&this.__===t.__},fd.prototype.toJSON=function(){return{latitude:this.l_,longitude:this.__}},fd.prototype.H=function(t){return Ii(this.l_,t.l_)||Ii(this.__,t.__)},fd),id=function(t){this.f_=t},od=/^__.*__$/,sd=function(t,e,n){this.d_=t,this.w_=e,this.m_=n},ud=(hd.prototype.T_=function(t,e){var n=[];return null!==this.Qe?n.push(new hu(t,this.data,this.Qe,e)):n.push(new cu(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new vu(t,this.fieldTransforms)),n},hd),ad=(cd.prototype.T_=function(t,e){var n=[new hu(t,this.data,this.Qe,e)];return 0<this.fieldTransforms.length&&n.push(new vu(t,this.fieldTransforms)),n},cd);function cd(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function hd(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function fd(t,e){if(ei("GeoPoint",arguments,2),ii("GeoPoint","number",1,t),ii("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Or(xr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Or(xr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.l_=t,this.__=e}function ld(t,e){var n=this;return(n=Yp.call(this,t)||this).h_=e,n}function pd(t,e){var n=this;return(n=Xp.call(this,t)||this).u_=e,n}function dd(t,e){var n=this;return(n=$p.call(this,t)||this).u_=e,n}function vd(){return null!==Jp&&Jp.apply(this,arguments)||this}function yd(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Mr()}}var gd=(Object.defineProperty(bd.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(bd.prototype,"r_",{get:function(){return this.settings.r_},enumerable:!1,configurable:!0}),bd.prototype.I_=function(t){return new bd(Object.assign(Object.assign({},this.settings),t),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},bd.prototype.A_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.I_({path:n,c_:!1});return r.R_(t),r},bd.prototype.P_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.I_({path:n,c_:!1});return r.E_(),r},bd.prototype.g_=function(t){return this.I_({path:void 0,c_:!0})},bd.prototype.o_=function(t){return Rd(t,this.settings.methodName,this.settings.y_||!1,this.path,this.settings.a_)},bd.prototype.contains=function(t){return void 0!==this.Qe.find((function(e){return t.T(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.T(e.field)}))},bd.prototype.E_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.R_(this.path.get(t))},bd.prototype.R_=function(t){if(0===t.length)throw this.o_("Document fields must not be empty");if(yd(this.r_)&&od.test(t))throw this.o_('Document fields cannot begin and end with "__"')},bd),md=(wd.prototype.V_=function(t,e,n,r){return void 0===r&&(r=!1),new gd({r_:t,methodName:e,a_:n,path:Wr.g(),c_:!1,y_:r},this.U,this.serializer,this.ignoreUndefinedProperties)},wd);function wd(t,e,n){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=n||Np(t)}function bd(t,e,n,r,i,o){this.settings=t,this.U=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.E_(),this.fieldTransforms=i||[],this.Qe=o||[]}function Id(t,e,n,r,i,o){void 0===o&&(o={});var s=t.V_(o.merge||o.mergeFields?2:0,e,n,i);Dd("Data must be an object, but it was:",s,r);var u,a,c=Nd(r,s);if(o.merge)u=new Ys(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Up)d=p.n_;else{if("string"!=typeof p)throw Mr();d=Od(e,p,n)}if(!s.contains(d))throw new Or(xr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");kd(h,d)||h.push(d)}u=new Ys(h),a=s.fieldTransforms.filter((function(t){return u.He(t.field)}))}else u=null,a=s.fieldTransforms;return new ud(new Eu(c),u,a)}function Ed(t,e,n,r){var i=t.V_(1,e,n);Dd("Data must be an object, but it was:",i,r);var o=[],s=new Tu;jr(r,(function(t,r){var u,a=Od(e,t,n),c=i.P_(a);r instanceof qp||r instanceof id&&r.f_ instanceof qp?o.push(a):null!=(u=Ad(r,c))&&(o.push(a),s.set(a,u))}));var u=new Ys(o);return new ad(s.Je(),u,i.fieldTransforms)}function Td(t,e,n,r,i,o){var s=t.V_(1,e,n),u=[xd(e,r,n)],a=[i];if(o.length%2!=0)throw new Or(xr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(xd(e,o[c])),a.push(o[c+1]);for(var h,f,l,p,d=[],v=new Tu,y=u.length-1;0<=y;--y)kd(d,u[y])||(h=u[y],f=a[y],l=s.P_(h),f instanceof qp||f instanceof id&&f.f_ instanceof qp?d.push(h):null!=(p=Ad(f,l))&&(d.push(h),v.set(h,p)));var g=new Ys(d);return new ad(v.Je(),g,s.fieldTransforms)}function _d(t,e,n,r){return void 0===r&&(r=!1),Ad(n,t.V_(r?4:3,e))}function Ad(t,e){if(t instanceof id&&(t=t.f_),Sd(t))return Dd("Unsupported field value:",e,t),Nd(t,e);if(t instanceof Fp)return function(t,e){if(!yd(e.r_))throw e.o_(t.s_+"() can only be used with update() and set()");if(!e.path)throw e.o_(t.s_+"() is not currently supported inside arrays");var n=t.i_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Qe.push(e.path),t instanceof Array){if(e.settings.c_&&4!==e.r_)throw e.o_("Nested arrays are not supported");return function(e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Ad(o[i],e.g_(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return cs(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Pi.fromDate(t);return{timestampValue:hs(e.serializer,n)}}if(t instanceof Pi){var r=new Pi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:hs(e.serializer,r)}}if(t instanceof rd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ni)return{bytesValue:fs(e.serializer,t.q)};if(t instanceof sd){var i=e.U,o=t.d_;if(!o.isEqual(i))throw e.o_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:ps(t.d_||e.U,t.w_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.o_("Unsupported field value: "+li(t))}(t,e)}function Nd(t,e){var n={};return Gr(t)?e.path&&0<e.path.length&&e.Qe.push(e.path):jr(t,(function(t,r){var i=Ad(r,e.A_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Sd(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Pi||t instanceof rd||t instanceof Ni||t instanceof sd||t instanceof Fp)}function Dd(t,e,n){if(!Sd(n)||!fi(n)){var r=li(n);throw"an object"===r?e.o_(t+" a custom object"):e.o_(t+" "+r)}}function xd(t,e,n){if(e instanceof Up)return e.n_;if("string"==typeof e)return Od(t,e);throw Rd("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Od(t,e,n){try{return function(t){if(0<=t.search(Mp))throw new Or(xr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Vp.bind.apply(Vp,c([void 0],t.split("."))))}catch(e){throw new Or(xr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).n_}catch(e){throw Rd(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Rd(t,e,n,r,i){var o=r&&!r.m(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Or(xr.INVALID_ARGUMENT,(u+=". ")+t+a)}function kd(t,e){return t.some((function(t){return t.isEqual(e)}))}var Ld=(Md.prototype.D_=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:if(this.C_(),0<this.mutations.length)throw new Or(xr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,u;return a(this,(function(a){switch(a.label){case 0:return r=ws((n=t).serializer)+"/documents",i={documents:e.map((function(t){return vs(n.serializer,t)}))},[4,n.Ou("BatchGetDocuments",r,i)];case 1:return o=a.sent(),s=new Map,o.forEach((function(t){var e,r,i=(e=n.serializer,"found"in(r=t)?function(t,e){Fr(!!e.found),e.found.name,e.found.updateTime;var n=ys(t,e.found.name),r=ls(e.found.updateTime),i=new Eu({mapValue:{fields:e.found.fields}});return new ku(n,r,i,{})}(e,r):"missing"in r?function(t,e){Fr(!!e.missing),Fr(!!e.readTime);var n=ys(t,e.missing),r=ls(e.readTime);return new Lu(n,r)}(e,r):Mr());s.set(i.key.toString(),i)})),u=[],[2,(e.forEach((function(t){var e=s.get(t.toString());Fr(!!e),u.push(e)})),u)]}}))}))}(this.zu,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof Lu||t instanceof ku?n.N_(t):Mr()})),e)]}}))}))},Md.prototype.set=function(t,e){this.write(e.T_(t,this.Ke(t))),this.S_.add(t.toString())},Md.prototype.update=function(t,e){try{this.write(e.T_(t,this.F_(t)))}catch(t){this.v_=t}this.S_.add(t.toString())},Md.prototype.delete=function(t){this.write([new bu(t,this.Ke(t))]),this.S_.add(t.toString())},Md.prototype.commit=function(){return u(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:if(this.C_(),this.v_)throw this.v_;return t=this.p_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Yr.D(n);e.mutations.push(new Iu(r,e.Ke(r)))})),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return r=ws((n=t).serializer)+"/documents",i={writes:e.map((function(t){return Es(n.serializer,t)}))},[4,n.Mu("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.zu,this.mutations)];case 1:return n.sent(),this.b_=!0,[2]}}))}))},Md.prototype.N_=function(t){var e;if(t instanceof ku)e=t.version;else{if(!(t instanceof Lu))throw Mr();e=Ui.min()}var n=this.p_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Or(xr.ABORTED,"Document version changed between two reads.")}else this.p_.set(t.key.toString(),e)},Md.prototype.Ke=function(t){var e=this.p_.get(t.toString());return!this.S_.has(t.toString())&&e?Zs.updateTime(e):Zs.Ge()},Md.prototype.F_=function(t){var e=this.p_.get(t.toString());if(this.S_.has(t.toString())||!e)return Zs.exists(!0);if(e.isEqual(Ui.min()))throw new Or(xr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Zs.updateTime(e)},Md.prototype.write=function(t){this.C_(),this.mutations=this.mutations.concat(t)},Md.prototype.C_=function(){},Md),Cd=(Vd.prototype.run=function(){this.k_()},Vd.prototype.k_=function(){var t=this;this.gs.Rn((function(){return u(t,void 0,void 0,(function(){var t,e,n=this;return a(this,(function(r){return t=new Ld(this.zu),(e=this.M_(t))&&e.then((function(e){n.os.ds((function(){return t.commit().then((function(){n.hs.resolve(e)})).catch((function(t){n.O_(t)}))}))})).catch((function(t){n.O_(t)})),[2]}))}))}))},Vd.prototype.M_=function(t){try{var e=this.updateFunction(t);return!Gi(e)&&e.catch&&e.then?e:(this.hs.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.hs.reject(t),null}},Vd.prototype.O_=function(t){var e=this;0<this.x_&&this.L_(t)?(--this.x_,this.os.ds((function(){return e.k_(),Promise.resolve()}))):this.hs.reject(t)},Vd.prototype.L_=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!eo(e)},Vd),Pd=(Ud.prototype.start=function(t,e,n,r){var i=this;this.q_(),this.Sl=t;var o=new ka,s=!1;return this.credentials.Jc((function(t){return s?void i.os.Ds((function(){return function(t,e){return u(this,void 0,void 0,(function(){var n,r;return a(this,(function(i){switch(i.label){case 0:return(n=t).os.Fs(),Cr("RemoteStore","RemoteStore received new credentials"),r=dl(n),n.Xu.add(3),[4,sl(n)];case 1:return i.sent(),r&&n.nh.set("Unknown"),[4,n.Hu.Zl(e)];case 2:return i.sent(),n.Xu.delete(3),[4,ol(n)];case 3:return i.sent(),[2]}}))}))}(i.Sh,t)})):(s=!0,Cr("FirestoreClient","Initializing. user=",t.uid),i.U_(e,n,r,t,o).then(i.B_.resolve,i.B_.reject))})),this.os.ds((function(){return i.B_.promise})),o.promise},Ud.prototype.enableNetwork=function(){var t=this;return this.q_(),this.os.enqueue((function(){return t.persistence.sc(!0),(e=t.Sh).Xu.delete(0),ol(e);var e}))},Ud.prototype.U_=function(t,e,n,r,i){return u(this,void 0,void 0,(function(){var o,s,c=this;return a(this,(function(h){switch(h.label){case 0:return h.trys.push([0,3,,4]),o={os:this.os,Sl:this.Sl,clientId:this.clientId,credentials:this.credentials,Kl:r,Nh:100,persistenceSettings:n},[4,t.initialize(o)];case 1:return h.sent(),[4,e.initialize(t,o)];case 2:return h.sent(),this.persistence=t.persistence,this.Ch=t.Ch,this.Gu=t.Gu,this.Ql=t.Ql,this.zu=e.zu,this.Sh=e.Sh,this._i=e._i,this.Q_=e.Dh,this.Q_.qs=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,u;return a(this,(function(a){switch(a.label){case 0:return n=Xl(t),(o=n.$h.get(e))?(r=o.targetId,n.Ch.Mi(r),i=o.view.ph(),[3,4]):[3,1];case 1:return[4,Sf(n.Gu,Ku(e))];case 2:return s=a.sent(),u=n.Ch.Mi(s.targetId),r=s.targetId,[4,Ll(n,e,r,"current"===u)];case 3:i=a.sent(),n.Wh&&al(n.Sh,s),a.label=4;case 4:return[2,i]}}))}))}.bind(null,this._i),this.Q_.Ws=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return r=(n=t).$h.get(e),1<(i=n.xh.get(r.targetId)).length?[2,(n.xh.set(r.targetId,i.filter((function(t){return!$u(t,e)}))),void n.$h.delete(e))]:n.Wh?(n.Ch.Li(r.targetId),n.Ch.Ni(r.targetId)?[3,2]:[4,Df(n.Gu,r.targetId,!1).then((function(){n.Ch.qi(r.targetId),cl(n.Sh,r.targetId),Fl(n,r.targetId)})).catch(Rf)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Fl(n,r.targetId),[4,Df(n.Gu,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}.bind(null,this._i),this.persistence.nc((function(){return u(c,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),i.resolve(),[3,4];case 3:if(s=h.sent(),i.reject(s),!this.W_(s))throw s;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),this.U_(new kp,new Cp,{Gl:!1},r,i))];case 4:return[2]}}))}))},Ud.prototype.W_=function(t){return"FirebaseError"===t.name?t.code===xr.FAILED_PRECONDITION||t.code===xr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Ud.prototype.q_=function(){if(this.os.Vs)throw new Or(xr.FAILED_PRECONDITION,"The client has already been terminated.")},Ud.prototype.disableNetwork=function(){var t=this;return this.q_(),this.os.enqueue((function(){return t.persistence.sc(!1),function(t){return u(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return(e=t).Xu.add(0),[4,sl(e)];case 1:return n.sent(),e.nh.set("Offline"),[2]}}))}))}(t.Sh)}))},Ud.prototype.terminate=function(){var t=this;this.os.Ss();var e=new ka;return this.os.ps((function(){return u(t,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),this.Ql&&this.Ql.stop(),[4,ul(this.Sh)];case 1:return r.sent(),[4,this.Ch.Si()];case 2:return r.sent(),[4,this.persistence.Si()];case 3:return r.sent(),this.credentials.Xc(),e.resolve(),[3,5];case 4:return t=r.sent(),n=ic(t,"Failed to shutdown persistence"),e.reject(n),[3,5];case 5:return[2]}}))}))})),e.promise},Ud.prototype.waitForPendingWrites=function(){var t=this;this.q_();var e=new ka;return this.os.ds((function(){return function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(u){switch(u.label){case 0:dl((n=t).Sh)||Cr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,(a=n.Gu).persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return a.vr.Bo(t)}))];case 2:return-1===(r=u.sent())?[2,void e.resolve()]:((i=n.qh.get(r)||[]).push(e),n.qh.set(r,i),[3,4]);case 3:return o=u.sent(),s=ic(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}var a}))}))}(t._i,e)})),e.promise},Ud.prototype.listen=function(t,e,n){var r=this;this.q_();var i=new Pp(n),o=new hc(t,i,e);return this.os.ds((function(){return uc(r.Q_,o)})),function(){i.e_(),r.os.ds((function(){return ac(r.Q_,o)}))}},Ud.prototype.j_=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:return this.q_(),[4,this.B_.promise];case 1:return r.sent(),e=new ka,[2,(this.os.ds((function(){return function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o;return a(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,(u=e,(a=t).persistence.runTransaction("read document","readonly",(function(t){return a.$c.Dr(t,u)})))];case 1:return(r=s.sent())instanceof ku?n.resolve(r):r instanceof Lu?n.resolve(null):n.reject(new Or(xr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=s.sent(),o=ic(i,"Failed to get document '"+e+" from cache"),n.reject(o),[3,3];case 3:return[2]}var u,a}))}))}(n.Gu,t,e)})),e.promise)]}}))}))},Ud.prototype.K_=function(t,e){return void 0===e&&(e={}),u(this,void 0,void 0,(function(){var n,r=this;return a(this,(function(i){switch(i.label){case 0:return this.q_(),[4,this.B_.promise];case 1:return i.sent(),n=new ka,[2,(this.os.ds((function(){return i=r.Q_,o=r.os,s=t,u=e,a=n,c=new Pp({next:function(t){o.ds((function(){return ac(i,h)}));var e=t.docs.has(s);!e&&t.fromCache?a.reject(new Or(xr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&u&&"server"===u.source?a.reject(new Or(xr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(t)},error:function(t){return a.reject(t)}}),h=new hc(qu(s.path),c,{includeMetadataChanges:!0,Js:!0}),uc(i,h);var i,o,s,u,a,c,h})),n.promise)]}}))}))},Ud.prototype.G_=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:return this.q_(),[4,this.B_.promise];case 1:return r.sent(),e=new ka,[2,(this.os.ds((function(){return function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,u,c;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,xf(t,e,!0)];case 1:return r=a.sent(),i=new Sl(e,r.kc),o=i.Th(r.documents),s=i.gr(o,!1),n.resolve(s.snapshot),[3,3];case 2:return u=a.sent(),c=ic(u,"Failed to execute query '"+e+" against cache"),n.reject(c),[3,3];case 3:return[2]}}))}))}(n.Gu,t,e)})),e.promise)]}}))}))},Ud.prototype.z_=function(t,e){return void 0===e&&(e={}),u(this,void 0,void 0,(function(){var n,r=this;return a(this,(function(i){switch(i.label){case 0:return this.q_(),[4,this.B_.promise];case 1:return i.sent(),n=new ka,[2,(this.os.ds((function(){return i=r.Q_,o=r.os,s=t,u=e,a=n,c=new Pp({next:function(t){o.ds((function(){return ac(i,h)})),t.fromCache&&"server"===u.source?a.reject(new Or(xr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):a.resolve(t)},error:function(t){return a.reject(t)}}),h=new hc(s,c,{includeMetadataChanges:!0,Js:!0}),uc(i,h);var i,o,s,u,a,c,h})),n.promise)]}}))}))},Ud.prototype.write=function(t){var e=this;this.q_();var n=new ka;return this.os.ds((function(){return function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s;return a(this,(function(u){switch(u.label){case 0:r=$l(t),u.label=1;case 1:return u.trys.push([1,5,,6]),[4,(l=r.Gu,p=e,v=l,y=Pi.now(),g=p.reduce((function(t,e){return t.add(e.key)}),wo()),v.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return v.$c.$r(t,g).next((function(e){d=e;for(var n,r,i=[],o=0,s=p;o<s.length;o++){var u=s[o],a=(n=u,r=d.get(u.key),n instanceof vu?function(t){for(var e=null,r=0,i=n.fieldTransforms;r<i.length;r++){var o=i[r],s=t instanceof ku?t.field(o.field):void 0,u=ks(o.transform,s||null);null!=u&&(e=null==e?(new Tu).set(o.field,u):e.set(o.field,u))}return e?e.Je():null}(r):null);null!=a&&i.push(new hu(u.key,a,function t(e){var n=[];return jr(e.fields||{},(function(e,r){var i=new Wr([e]);if(rs(r)){var o=t(r.mapValue).fields;if(0===o.length)n.push(i);else for(var s=0,u=o;s<u.length;s++){var a=u[s];n.push(i.child(a))}}else n.push(i)})),new Ys(n)}(a.proto.mapValue),Zs.exists(!0)))}return v.vr.xo(t,y,i,p)}))})).then((function(t){var e=t.hr(d);return{batchId:t.batchId,dr:e}})))];case 2:return i=u.sent(),r.Ch.Fi(i.batchId),a=r,c=i.batchId,h=n,f=(f=(f=a.Bh[a.currentUser.Zs()])||new ro(Ii)).rt(c,h),a.Bh[a.currentUser.Zs()]=f,[4,Bl(r,i.dr)];case 3:return u.sent(),[4,wl(r.Sh)];case 4:return u.sent(),[3,6];case 5:return o=u.sent(),s=ic(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}var a,c,h,f,l,p,d,v,y,g}))}))}(e._i,t,n)})),n.promise},Ud.prototype.U=function(){return this.Sl.U},Ud.prototype.H_=function(t){var e=this;this.q_();var n=new Pp(t);return this.os.ds((function(){return u(e,void 0,void 0,(function(){return a(this,(function(t){return[2,(e=this.Q_,r=n,e.Bs.add(r),void r.next())];var e,r}))}))})),function(){n.e_(),e.os.ds((function(){return u(e,void 0,void 0,(function(){return a(this,(function(t){return[2,void this.Q_.Bs.delete(n)]}))}))}))}},Object.defineProperty(Ud.prototype,"Y_",{get:function(){return this.os.Vs},enumerable:!1,configurable:!0}),Ud.prototype.transaction=function(t){var e=this;this.q_();var n=new ka;return this.os.ds((function(){return new Cd(e.os,e.zu,t,n).run(),Promise.resolve()})),n.promise},Ud);function Ud(t,e){this.credentials=t,this.os=e,this.clientId=wi.k(),this.B_=new ka}function Vd(t,e,n,r){this.os=t,this.zu=e,this.updateFunction=n,this.hs=r,this.x_=5,this.gs=new Ca(this.os,"transaction_retry")}function Md(t){this.zu=t,this.p_=new Map,this.mutations=[],this.b_=!1,this.v_=null,this.S_=new Set}function Fd(t){return function(){if("object"==typeof t&&null!==t)for(var e=t,n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return 1}}()}var qd,jd,Gd=(sv.prototype.tf=function(t){switch(Bo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Xo(t.integerValue||t.doubleValue);case 3:return this.ef(t.timestampValue);case 4:return this.nf(t);case 5:return t.stringValue;case 6:return this.Z_($o(t.bytesValue));case 7:return this.sf(t.referenceValue);case 8:return this.if(t.geoPointValue);case 9:return this.rf(t.arrayValue);case 10:return this.af(t.mapValue);default:throw Mr()}},sv.prototype.af=function(t){var e=this,n={};return jr(t.fields||{},(function(t,r){n[t]=e.tf(r)})),n},sv.prototype.if=function(t){return new rd(Xo(t.latitude),Xo(t.longitude))},sv.prototype.rf=function(t){var e=this;return(t.values||[]).map((function(t){return e.tf(t)}))},sv.prototype.nf=function(t){switch(this.J_){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return qo(n)?t(n):n}(t);return null==e?null:this.tf(e);case"estimate":return this.ef(jo(t));default:return null}},sv.prototype.ef=function(t){var e=Yo(t),n=new Pi(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},sv.prototype.sf=function(t){var e=Qr.P(t);Fr(Os(e));var n=new Li(e.get(1),e.get(3)),r=new Yr(e.u(5));return n.isEqual(this.U)||Pr("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.U.projectId+"/"+this.U.database+") instead."),this.X_(r)},sv),Bd=Yc.uo,zd=(ov.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},ov),Hd=(Object.defineProperty(iv.prototype,"Ef",{get:function(){return this.If||(this.If=new md(this.d_,this.Tf.ignoreUndefinedProperties)),this.If},enumerable:!1,configurable:!0}),iv.prototype.settings=function(t){ei("Firestore.settings",arguments,1),ii("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.Tf),t)).merge;var e=new zd(t);if(this.ff&&!this.Tf.isEqual(e))throw new Or(xr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Tf=e).credentials&&(this.mf=function(t){if(!t)return new Ff;switch(t.type){case"gapi":var e=t.client;return Fr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Gf(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Or(xr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},iv.prototype.enableNetwork=function(){return this._f(),this.ff.enableNetwork()},iv.prototype.disableNetwork=function(){return this._f(),this.ff.disableNetwork()},iv.prototype.enablePersistence=function(t){var e,n;if(this.ff)throw new Or(xr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Pr("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new Or(xr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Af(this.cf,this.uf,{Gl:!0,cacheSizeBytes:this.Tf.cacheSizeBytes,synchronizeTabs:r,La:i})},iv.prototype.clearPersistence=function(){return u(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){if(void 0!==this.ff&&!this.ff.Y_)throw new Or(xr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return t=new ka,[2,(this.lf.ps((function(){return u(e,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.cf.clearPersistence(this.d_,this.wf)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},iv.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(iv.prototype,"Rf",{get:function(){return this._f(),this.ff.Y_},enumerable:!1,configurable:!0}),iv.prototype.waitForPendingWrites=function(){return this._f(),this.ff.waitForPendingWrites()},iv.prototype.onSnapshotsInSync=function(t){if(this._f(),Fd(t))return this.ff.H_(t);ii("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.ff.H_(e)},iv.prototype._f=function(){return this.ff||this.Af(new kp,new Cp,{Gl:!1}),this.ff},iv.prototype.Pf=function(){return new Oi(this.d_,this.wf,this.Tf.host,this.Tf.ssl,this.Tf.experimentalForceLongPolling)},iv.prototype.Af=function(t,e,n){var r=this.Pf();return this.ff=new Pd(this.mf,this.lf),this.ff.start(r,t,e,n)},iv.df=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Or(xr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Or(xr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Li(n)},Object.defineProperty(iv.prototype,"app",{get:function(){if(!this.hf)throw new Or(xr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.hf},enumerable:!1,configurable:!0}),iv.prototype.collection=function(t){return ei("Firestore.collection",arguments,1),ii("Firestore.collection","non-empty string",1,t),this._f(),new dv(Qr.P(t),this,null)},iv.prototype.doc=function(t){return ei("Firestore.doc",arguments,1),ii("Firestore.doc","non-empty string",1,t),this._f(),Wd.gf(Qr.P(t),this,null)},iv.prototype.collectionGroup=function(t){if(ei("Firestore.collectionGroup",arguments,1),ii("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Or(xr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this._f(),new lv((e=t,new Pu(Qr.g(),e)),this,null);var e},iv.prototype.runTransaction=function(t){var e=this;return ei("Firestore.runTransaction",arguments,1),ii("Firestore.runTransaction","function",1,t),this._f().transaction((function(n){return t(new Qd(e,n))}))},iv.prototype.batch=function(){return this._f(),new Kd(this)},Object.defineProperty(iv,"logLevel",{get:function(){switch(Lr()){case n.DEBUG:return"debug";case n.ERROR:return"error";case n.SILENT:return"silent";case n.WARN:return"warn";case n.INFO:return"info";case n.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),iv.setLogLevel=function(t){ei("Firestore.setLogLevel",arguments,1),ci("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Rr.setLogLevel(t)},iv.prototype.yf=function(){return this.Tf.timestampsInSnapshots},iv.prototype.Vf=function(){return this.Tf},iv),Qd=(rv.prototype.get=function(t){var e=this;ei("Transaction.get",arguments,1);var n=Iv("Transaction.get",t,this.pf);return this.bf.D_([n.w_]).then((function(t){if(!t||1!==t.length)return Mr();var r=t[0];if(r instanceof Lu)return new Xd(e.pf,n.w_,null,!1,!1,n.m_);if(r instanceof ku)return new Xd(e.pf,n.w_,r,!1,!1,n.m_);throw Mr()}))},rv.prototype.set=function(t,e,n){ri("Transaction.set",arguments,2,3);var r=Iv("Transaction.set",t,this.pf);n=mv("Transaction.set",n);var i=Ev(r.m_,e,n),o=Id(this.pf.Ef,"Transaction.set",r.w_,i,null!==r.m_,n);return this.bf.set(r.w_,o),this},rv.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Vp?(ni("Transaction.update",arguments,3),r=Iv("Transaction.update",t,this.pf),Td(this.pf.Ef,"Transaction.update",r.w_,e,n,o)):(ei("Transaction.update",arguments,2),r=Iv("Transaction.update",t,this.pf),Ed(this.pf.Ef,"Transaction.update",r.w_,e)),this.bf.update(r.w_,i),this},rv.prototype.delete=function(t){ei("Transaction.delete",arguments,1);var e=Iv("Transaction.delete",t,this.pf);return this.bf.delete(e.w_),this},rv),Kd=(nv.prototype.set=function(t,e,n){ri("WriteBatch.set",arguments,2,3),this.Df();var r=Iv("WriteBatch.set",t,this.pf);n=mv("WriteBatch.set",n);var i=Ev(r.m_,e,n),o=Id(this.pf.Ef,"WriteBatch.set",r.w_,i,null!==r.m_,n);return this.vf=this.vf.concat(o.T_(r.w_,Zs.Ge())),this},nv.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Df(),i="string"==typeof e||e instanceof Vp?(ni("WriteBatch.update",arguments,3),r=Iv("WriteBatch.update",t,this.pf),Td(this.pf.Ef,"WriteBatch.update",r.w_,e,n,o)):(ei("WriteBatch.update",arguments,2),r=Iv("WriteBatch.update",t,this.pf),Ed(this.pf.Ef,"WriteBatch.update",r.w_,e)),this.vf=this.vf.concat(i.T_(r.w_,Zs.exists(!0))),this},nv.prototype.delete=function(t){ei("WriteBatch.delete",arguments,1),this.Df();var e=Iv("WriteBatch.delete",t,this.pf);return this.vf=this.vf.concat(new bu(e.w_,Zs.Ge())),this},nv.prototype.commit=function(){return this.Df(),this.Sf=!0,0<this.vf.length?this.pf._f().write(this.vf):Promise.resolve()},nv.prototype.Df=function(){if(this.Sf)throw new Or(xr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},nv),Wd=(s(ev,jd=sd),ev.gf=function(t,e,n){if(t.length%2!=0)throw new Or(xr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.R()+" has "+t.length);return new ev(new Yr(t),e,n)},Object.defineProperty(ev.prototype,"id",{get:function(){return this.w_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(ev.prototype,"parent",{get:function(){return new dv(this.w_.path.h(),this.firestore,this.m_)},enumerable:!1,configurable:!0}),Object.defineProperty(ev.prototype,"path",{get:function(){return this.w_.path.R()},enumerable:!1,configurable:!0}),ev.prototype.collection=function(t){if(ei("DocumentReference.collection",arguments,1),ii("DocumentReference.collection","non-empty string",1,t),!t)throw new Or(xr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Qr.P(t);return new dv(this.w_.path.child(e),this.firestore,null)},ev.prototype.isEqual=function(t){if(!(t instanceof ev))throw vi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.w_.isEqual(t.w_)&&this.m_===t.m_},ev.prototype.set=function(t,e){ri("DocumentReference.set",arguments,1,2),e=mv("DocumentReference.set",e);var n=Ev(this.m_,t,e),r=Id(this.firestore.Ef,"DocumentReference.set",this.w_,n,null!==this.m_,e);return this.ff.write(r.T_(this.w_,Zs.Ge()))},ev.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Vp?(ni("DocumentReference.update",arguments,2),Td(this.firestore.Ef,"DocumentReference.update",this.w_,t,e,r)):(ei("DocumentReference.update",arguments,1),Ed(this.firestore.Ef,"DocumentReference.update",this.w_,t)),this.ff.write(n.T_(this.w_,Zs.exists(!0)))},ev.prototype.delete=function(){return ei("DocumentReference.delete",arguments,0),this.ff.write([new bu(this.w_,Zs.Ge())])},ev.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ri("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Fd(i[u])||(di("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),ui("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a,c={includeMetadataChanges:s.includeMetadataChanges};Fd(i[u])?(a=i[u],i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)):(ii("DocumentReference.onSnapshot","function",u,i[u]),oi("DocumentReference.onSnapshot","function",u+1,i[u+1]),oi("DocumentReference.onSnapshot","function",u+2,i[u+2]));var h={next:function(t){i[u]&&i[u](r.Cf(t))},error:i[u+1],complete:i[u+2]};return this.ff.listen(qu(this.w_.path),c,h)},ev.prototype.get=function(t){var e=this;ri("DocumentReference.get",arguments,0,1),bv("DocumentReference.get",t);var n=this.firestore._f();return t&&"cache"===t.source?n.j_(this.w_).then((function(t){return new Xd(e.firestore,e.w_,t,!0,t instanceof ku&&t.Ye,e.m_)})):n.K_(this.w_,t).then((function(t){return e.Cf(t)}))},ev.prototype.withConverter=function(t){return new ev(this.w_,this.firestore,t)},ev.prototype.Cf=function(t){var e=t.docs.get(this.w_);return new Xd(this.firestore,this.w_,e,t.fromCache,t.hasPendingWrites,this.m_)},ev),Yd=(tv.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},tv),Xd=(Zd.prototype.data=function(t){var e=this;if(ri("DocumentSnapshot.data",arguments,0,1),t=wv("DocumentSnapshot.data",t),this.Nf){if(this.m_){var n=new $d(this.pf,this.w_,this.Nf,this.Ff,this.$f,null);return this.m_.fromFirestore(n,t)}return new Gd(this.pf.d_,this.pf.yf(),t.serverTimestamps||"none",(function(t){return new Wd(t,e.pf,null)}),(function(t){return new ki(t)})).tf(this.Nf.sn())}},Zd.prototype.get=function(t,e){var n=this;if(ri("DocumentSnapshot.get",arguments,1,2),e=wv("DocumentSnapshot.get",e),this.Nf){var r=this.Nf.data().field(xd("DocumentSnapshot.get",t,this.w_));if(null!==r)return new Gd(this.pf.d_,this.pf.yf(),e.serverTimestamps||"none",(function(t){return new Wd(t,n.pf,n.m_)}),(function(t){return new ki(t)})).tf(r)}},Object.defineProperty(Zd.prototype,"id",{get:function(){return this.w_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(Zd.prototype,"ref",{get:function(){return new Wd(this.w_,this.pf,this.m_)},enumerable:!1,configurable:!0}),Object.defineProperty(Zd.prototype,"exists",{get:function(){return null!==this.Nf},enumerable:!1,configurable:!0}),Object.defineProperty(Zd.prototype,"metadata",{get:function(){return new Yd(this.$f,this.Ff)},enumerable:!1,configurable:!0}),Zd.prototype.isEqual=function(t){if(!(t instanceof Zd))throw vi("isEqual","DocumentSnapshot",1,t);return this.pf===t.pf&&this.Ff===t.Ff&&this.w_.isEqual(t.w_)&&(null===this.Nf?null===t.Nf:this.Nf.isEqual(t.Nf))&&this.m_===t.m_},Zd),$d=(s(Jd,qd=Xd),Jd.prototype.data=function(t){return qd.prototype.data.call(this,t)},Jd);function Jd(){return null!==qd&&qd.apply(this,arguments)||this}function Zd(t,e,n,r,i,o){this.pf=t,this.w_=e,this.Nf=n,this.Ff=r,this.$f=i,this.m_=o}function tv(t,e){this.hasPendingWrites=t,this.fromCache=e}function ev(t,e,n){var r=this;return(r=jd.call(this,e.d_,t,n)||this).w_=t,r.firestore=e,r.m_=n,r.ff=r.firestore._f(),r}function nv(t){this.pf=t,this.vf=[],this.Sf=!1}function rv(t,e){this.pf=t,this.bf=e}function iv(t,e,n,r){var i=this;if(void 0===n&&(n=new kp),void 0===r&&(r=new Cp),this.cf=n,this.uf=r,this.hf=null,this.lf=new ec,this.INTERNAL={delete:function(){return u(i,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this._f(),[4,this.ff.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof t.options){var o=t;this.hf=o,this.d_=iv.df(o),this.wf=o.name,this.mf=new qf(e)}else{var s=t;if(!s.projectId)throw new Or(xr.INVALID_ARGUMENT,"Must provide projectId");this.d_=new Li(s.projectId,s.database),this.wf="[DEFAULT]",this.mf=new Ff}this.Tf=new zd({})}function ov(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Or(xr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else si("settings","non-empty string","host",t.host),this.host=t.host,ui("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(di("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),ui("settings","object","credentials",t.credentials),this.credentials=t.credentials,ui("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),ui("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Pr("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Pr("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,ui("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Yc.lo;else{if(t.cacheSizeBytes!==Bd&&t.cacheSizeBytes<Yc.ho)throw new Or(xr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Yc.ho);this.cacheSizeBytes=t.cacheSizeBytes}ui("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function sv(t,e,n,r,i){this.U=t,this.timestampsInSnapshots=e,this.J_=n,this.X_=r,this.Z_=i}function uv(t,e,n){if("string"==typeof n){if(""===n)throw new Or(xr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Hu(e)&&-1!==n.indexOf("/"))throw new Or(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Qr.P(n));if(!Yr.F(r))throw new Or(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Jo(t,new Yr(r))}if(n instanceof sd)return Jo(t,n.w_);throw new Or(xr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+li(n)+".")}function av(t,e){if(!Array.isArray(t)||0===t.length)throw new Or(xr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Or(xr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(0<=t.indexOf(null))throw new Or(xr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter((function(t){return Number.isNaN(t)})).length)throw new Or(xr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function cv(t,e,n){if(!n.isEqual(e))throw new Or(xr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function hv(t){if(Gu(t)&&0===t.rn.length)throw new Or(xr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var fv,lv=(gv.prototype.where=function(t,e,n){ei("Query.where",arguments,3),pi("Query.where",3,n);var r,i,o=ci("Query.where",["<","<=","==","!=",">=",">","array-contains","in","array-contains-any","not-in"],2,e),s=xd("Query.where",t),u=function(t,e,n,r,i,o,s){var u;if(i.p()){if("array-contains"===o||"array-contains-any"===o)throw new Or(xr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){av(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(uv(r,t,f))}u={arrayValue:{values:a}}}else u=uv(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||av(s,o),u=_d(n,"Query.where",s,"in"===o||"not-in"===o);var l=ra.create(i,o,u);return function(t,e){if(e.un()){var n=zu(t);if(null!==n&&!n.isEqual(e.field))throw new Or(xr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Bu(t);null!==r&&cv(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new Or(xr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Or(xr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(this.xf,0,this.firestore.Ef,this.firestore.d_,s,o,n);return new gv((i=(r=this.xf).filters.concat([u]),new Pu(r.path,r.collectionGroup,r.rn.slice(),i,r.limit,r.on,r.startAt,r.endAt)),this.firestore,this.m_)},gv.prototype.orderBy=function(t,e){var n;if(ri("Query.orderBy",arguments,1,2),oi("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Or(xr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r,i,o=xd("Query.orderBy",t),s=function(t,e,n){if(null!==t.startAt)throw new Or(xr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Or(xr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i,o,s=new Ra(e,n);return i=s,null!==Bu(r=t)||null!==(o=zu(r))&&cv(0,o,i.field),s}(this.xf,o,n);return new gv((i=(r=this.xf).rn.concat([s]),new Pu(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.on,r.startAt,r.endAt)),this.firestore,this.m_)},gv.prototype.limit=function(t){return ei("Query.limit",arguments,1),ii("Query.limit","number",1,t),yi("Query.limit",1,t),new gv(Wu(this.xf,t,"F"),this.firestore,this.m_)},gv.prototype.limitToLast=function(t){return ei("Query.limitToLast",arguments,1),ii("Query.limitToLast","number",1,t),yi("Query.limitToLast",1,t),new gv(Wu(this.xf,t,"L"),this.firestore,this.m_)},gv.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ni("Query.startAt",arguments,1);var r=this.kf("Query.startAt",t,e,!0);return new gv(Yu(this.xf,r),this.firestore,this.m_)},gv.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ni("Query.startAfter",arguments,1);var r=this.kf("Query.startAfter",t,e,!1);return new gv(Yu(this.xf,r),this.firestore,this.m_)},gv.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ni("Query.endBefore",arguments,1);var r=this.kf("Query.endBefore",t,e,!0);return new gv(Xu(this.xf,r),this.firestore,this.m_)},gv.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ni("Query.endAt",arguments,1);var r=this.kf("Query.endAt",t,e,!1);return new gv(Xu(this.xf,r),this.firestore,this.m_)},gv.prototype.isEqual=function(t){if(!(t instanceof gv))throw vi("isEqual","Query",1,t);return this.firestore===t.firestore&&$u(this.xf,t.xf)&&this.m_===t.m_},gv.prototype.withConverter=function(t){return new gv(this.xf,this.firestore,t)},gv.prototype.kf=function(t,e,n,r){if(pi(t,1,e),e instanceof Xd)return ei(t,c([e],n),1),function(e,n,r,i){if(!r)throw new Or(xr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");for(var o=[],s=0,u=Qu(e);s<u.length;s++){var a=u[s];if(a.field.p())o.push(Jo(n,r.key));else{var c=r.field(a.field);if(qo(c))throw new Or(xr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.R();throw new Or(xr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Ta(o,i)}(this.xf,this.firestore.d_,e.Nf,r);var i=[e].concat(n);return function(t,e,n,r,i,o){var s=t.rn;if(i.length>s.length)throw new Or(xr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.p()){if("string"!=typeof c)throw new Or(xr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Hu(t)&&-1!==c.indexOf("/"))throw new Or(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Qr.P(c));if(!Yr.F(h))throw new Or(xr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new Yr(h);u.push(Jo(e,f))}else{var l=_d(n,r,c);u.push(l)}}return new Ta(u,o)}(this.xf,this.firestore.d_,this.firestore.Ef,t,i,r)},gv.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ri("Query.onSnapshot",arguments,1,4);var s,u={},a=0;"object"!=typeof i[a]||Fd(i[a])||(di("Query.onSnapshot",u=i[a],["includeMetadataChanges"]),ui("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),Fd(i[a])?(s=i[a],i[a]=null===(t=s.next)||void 0===t?void 0:t.bind(s),i[a+1]=null===(e=s.error)||void 0===e?void 0:e.bind(s),i[a+2]=null===(n=s.complete)||void 0===n?void 0:n.bind(s)):(ii("Query.onSnapshot","function",a,i[a]),oi("Query.onSnapshot","function",a+1,i[a+1]),oi("Query.onSnapshot","function",a+2,i[a+2]));var c={next:function(t){i[a]&&i[a](new pv(r.firestore,r.xf,t,r.m_))},error:i[a+1],complete:i[a+2]};return hv(this.xf),this.firestore._f().listen(this.xf,u,c)},gv.prototype.get=function(t){var e=this;ri("Query.get",arguments,0,1),bv("Query.get",t),hv(this.xf);var n=this.firestore._f();return(t&&"cache"===t.source?n.G_(this.xf):n.z_(this.xf,t)).then((function(t){return new pv(e.firestore,e.xf,t,e.m_)}))},gv),pv=(Object.defineProperty(yv.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(yv.prototype,"empty",{get:function(){return this.Of.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(yv.prototype,"size",{get:function(){return this.Of.docs.size},enumerable:!1,configurable:!0}),yv.prototype.forEach=function(t,e){var n=this;ri("QuerySnapshot.forEach",arguments,1,2),ii("QuerySnapshot.forEach","function",1,t),this.Of.docs.forEach((function(r){t.call(e,n.qf(r,n.metadata.fromCache,n.Of.Qt.has(r.key)))}))},Object.defineProperty(yv.prototype,"query",{get:function(){return new lv(this.Mf,this.pf,this.m_)},enumerable:!1,configurable:!0}),yv.prototype.docChanges=function(t){t&&(di("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ui("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Of.jt)throw new Or(xr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Lf&&this.Bf===e||(this.Lf=function(t,e,n){if(t.Ut.m()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Qt.has(e.doc.key));return e.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Ut;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.Qt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Mr()}}(e.type),doc:r,oldIndex:o,newIndex:s}}))}(this.Of,e,this.qf.bind(this)),this.Bf=e),this.Lf},yv.prototype.isEqual=function(t){if(!(t instanceof yv))throw vi("isEqual","QuerySnapshot",1,t);return this.pf===t.pf&&$u(this.Mf,t.Mf)&&this.Of.isEqual(t.Of)&&this.m_===t.m_},yv.prototype.qf=function(t,e,n){return new $d(this.pf,t.key,t,e,n,this.m_)},yv),dv=(s(vv,fv=lv),Object.defineProperty(vv.prototype,"id",{get:function(){return this.xf.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(vv.prototype,"parent",{get:function(){var t=this.xf.path.h();return t.m()?null:new Wd(new Yr(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(vv.prototype,"path",{get:function(){return this.xf.path.R()},enumerable:!1,configurable:!0}),vv.prototype.doc=function(t){ri("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=wi.k()),ii("CollectionReference.doc","non-empty string",1,t);var e=Qr.P(t);return Wd.gf(this.xf.path.child(e),this.firestore,this.m_)},vv.prototype.add=function(t){ei("CollectionReference.add",arguments,1);var e=this.m_?this.m_.toFirestore(t):t;ii("CollectionReference.add","object",1,e);var n=this.doc();return new Wd(n.w_,this.firestore,null).set(e).then((function(){return n}))},vv.prototype.withConverter=function(t){return new vv(this.Uf,this.firestore,t)},vv);function vv(t,e,n){var r=this;if(((r=fv.call(this,qu(t),e,n)||this).Uf=t).length%2!=1)throw new Or(xr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.R()+" has "+t.length);return r}function yv(t,e,n,r){this.pf=t,this.Mf=e,this.Of=n,this.m_=r,this.Lf=null,this.Bf=null,this.metadata=new Yd(n.hasPendingWrites,n.fromCache)}function gv(t,e,n){this.xf=t,this.firestore=e,this.m_=n}function mv(t,e){if(void 0===e)return{merge:!1};if(di(t,e,["merge","mergeFields"]),ui(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+li(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Or(xr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+li(n[i]))}(t,"mergeFields",n,(function(t){return"string"==typeof t||t instanceof Vp})),void 0!==e.mergeFields&&void 0!==e.merge)throw new Or(xr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function wv(t,e){return void 0===e?{}:(di(t,e,["serverTimestamps"]),ai(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function bv(t,e){oi(t,"object",1,e),e&&(di(t,e,["source"]),ai(t,0,"source",e.source,["default","server","cache"]))}function Iv(t,e,n){if(e instanceof sd){if(e.firestore!==n)throw new Or(xr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw vi(t,"DocumentReference",1,e)}function Ev(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Tv,_v,Av=(s(Sv,Tv=id),Sv.serverTimestamp=function(){ti("FieldValue.serverTimestamp",arguments);var t=new Zp("serverTimestamp");return t.s_="FieldValue.serverTimestamp",new Sv(t)},Sv.delete=function(){ti("FieldValue.delete",arguments);var t=new qp("deleteField");return t.s_="FieldValue.delete",new Sv(t)},Sv.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ni("FieldValue.arrayUnion",arguments,1);var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ni("arrayUnion()",arguments,1),new td("arrayUnion",t)}.apply(void 0,t);return n.s_="FieldValue.arrayUnion",new Sv(n)},Sv.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ni("FieldValue.arrayRemove",arguments,1);var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ni("arrayRemove()",arguments,1),new ed("arrayRemove",t)}.apply(void 0,t);return n.s_="FieldValue.arrayRemove",new Sv(n)},Sv.increment=function(t){ii("FieldValue.increment","number",1,t),ei("FieldValue.increment",arguments,1);var e=new nd("increment",t);return e.s_="FieldValue.increment",new Sv(e)},Sv.prototype.isEqual=function(t){return this.f_.isEqual(t.f_)},Sv),Nv={Firestore:Hd,GeoPoint:rd,Timestamp:Pi,Blob:ki,Transaction:Qd,WriteBatch:Kd,DocumentReference:Wd,DocumentSnapshot:Xd,Query:lv,QueryDocumentSnapshot:$d,QuerySnapshot:pv,CollectionReference:dv,FieldPath:Vp,FieldValue:Av,setLogLevel:Hd.setLogLevel,CACHE_SIZE_UNLIMITED:Bd};function Sv(){return null!==Tv&&Tv.apply(this,arguments)||this}(_v=i.default).INTERNAL.registerComponent(new Nr("firestore",(function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=new Cp,i=new Lp(r),new Hd(e,n,i,r);var e,n,r,i}),"PUBLIC").setServiceProps(Object.assign({},Nv))),_v.registerVersion("@firebase/firestore","1.17.2")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}));